!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("SimpleKeyboard",[],t):"object"==typeof exports?exports.SimpleKeyboard=t():e.SimpleKeyboard=t()}(this,function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i(i.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t);var s,r,l,c=function(){function e(t){var i=t.getOptions,n=t.getCaretPosition,o=t.getCaretPositionEnd,a=t.dispatch;!function(t,i){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.getOptions=i,this.getCaretPosition=n,this.getCaretPositionEnd=o,this.dispatch=a,e.bindMethods(e,this)}var t,i,s;return t=e,s=[{key:"bindMethods",value:function(e,t){var i,o=function(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,l=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return r=e.done,e},e:function(e){l=!0,s=e},f:function(){try{r||null==i["return"]||i["return"]()}finally{if(l)throw s}}}}(Object.getOwnPropertyNames(e.prototype));try{for(o.s();!(i=o.n()).done;){var a=i.value;"constructor"===a||"bindMethods"===a||(t[a]=t[a].bind(t))}}catch(e){o.e(e)}finally{o.f()}}}],(i=[{key:"getButtonClass",value:function(e){var t=e.includes("{")&&e.includes("}")&&"{//}"!==e?"functionBtn":"standardBtn",i=e.replace("{","").replace("}",""),n="";return"standardBtn"!==t&&(n=" hg-button-".concat(i)),"hg-".concat(t).concat(n)}},{key:"getDefaultDiplay",value:function(){return{"{bksp}":"backspace","{backspace}":"backspace","{enter}":"< enter","{shift}":"shift","{shiftleft}":"shift","{shiftright}":"shift","{alt}":"alt","{s}":"shift","{tab}":"tab","{lock}":"caps","{capslock}":"caps","{accept}":"Submit","{space}":" ","{//}":" ","{esc}":"esc","{escape}":"esc","{f1}":"f1","{f2}":"f2","{f3}":"f3","{f4}":"f4","{f5}":"f5","{f6}":"f6","{f7}":"f7","{f8}":"f8","{f9}":"f9","{f10}":"f10","{f11}":"f11","{f12}":"f12","{numpaddivide}":"/","{numlock}":"lock","{arrowup}":"↑","{arrowleft}":"←","{arrowdown}":"↓","{arrowright}":"→","{prtscr}":"print","{scrolllock}":"scroll","{pause}":"pause","{insert}":"ins","{home}":"home","{pageup}":"up","{delete}":"del","{end}":"end","{pagedown}":"down","{numpadmultiply}":"*","{numpadsubtract}":"-","{numpadadd}":"+","{numpadenter}":"enter","{period}":".","{numpaddecimal}":".","{numpad0}":"0","{numpad1}":"1","{numpad2}":"2","{numpad3}":"3","{numpad4}":"4","{numpad5}":"5","{numpad6}":"6","{numpad7}":"7","{numpad8}":"8","{numpad9}":"9"}}},{key:"getButtonDisplayName",value:function(e,t,i){return(t=i?Object.assign({},this.getDefaultDiplay(),t):t||this.getDefaultDiplay())[e]||e}},{key:"getUpdatedInput",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=this.getOptions(),s=[i,n,o],r=t;return("{bksp}"===e||"{backspace}"===e)&&r.length>0?r=this.removeAt.apply(this,[r].concat(s)):"{space}"===e?r=this.addStringAt.apply(this,[r," "].concat(s)):"{tab}"!==e||"boolean"==typeof a.tabCharOnTab&&!1===a.tabCharOnTab?"{enter}"!==e&&"{numpadenter}"!==e||!a.newLineOnEnter?e.includes("numpad")&&Number.isInteger(Number(e[e.length-2]))?r=this.addStringAt.apply(this,[r,e[e.length-2]].concat(s)):"{numpaddivide}"===e?r=this.addStringAt.apply(this,[r,"/"].concat(s)):"{numpadmultiply}"===e?r=this.addStringAt.apply(this,[r,"*"].concat(s)):"{numpadsubtract}"===e?r=this.addStringAt.apply(this,[r,"-"].concat(s)):"{numpadadd}"===e?r=this.addStringAt.apply(this,[r,"+"].concat(s)):"{numpaddecimal}"===e?r=this.addStringAt.apply(this,[r,"."].concat(s)):"{"===e||"}"===e?r=this.addStringAt.apply(this,[r,e].concat(s)):e.includes("{")||e.includes("}")||(r=this.addStringAt.apply(this,[r,e].concat(s))):r=this.addStringAt.apply(this,[r,"\n"].concat(s)):r=this.addStringAt.apply(this,[r,"\t"].concat(s)),r}},{key:"updateCaretPos",value:function(e,t){var i=this.updateCaretPosAction(e,t);this.dispatch(function(e){e.setCaretPosition(i)})}},{key:"updateCaretPosAction",value:function(e,t){var i=this.getOptions(),n=this.getCaretPosition();return t?n>0&&(n-=e):n+=e,i.debug&&console.log("Caret at:",n,"(".concat(this.keyboardDOMClass,")")),n}},{key:"addStringAt",value:function(e,t){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n||0===n?(i=[e.slice(0,n),t,e.slice(o)].join(""),this.isMaxLengthReached()||a&&this.updateCaretPos(t.length)):i=e+t,i}},{key:"removeAt",value:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0===i&&0===n)return e;if(i===n){var a=/([\uD800-\uDBFF][\uDC00-\uDFFF])/g;i&&i>=0?e.substring(i-2,i).match(a)?(t=e.substr(0,i-2)+e.substr(i),o&&this.updateCaretPos(2,!0)):(t=e.substr(0,i-1)+e.substr(i),o&&this.updateCaretPos(1,!0)):e.slice(-2).match(a)?(t=e.slice(0,-2),o&&this.updateCaretPos(2,!0)):(t=e.slice(0,-1),o&&this.updateCaretPos(1,!0))}else t=e.slice(0,i)+e.slice(n),o&&this.dispatch(function(e){e.setCaretPosition(i)});return t}},{key:"handleMaxLength",value:function(e,t){var i=this.getOptions(),n=i.maxLength,a=e[i.inputName],s=t.length-1>=n;if(t.length<=a.length)return!1;if(Number.isInteger(n))return i.debug&&console.log("maxLength (num) reached:",s),s?(this.maxLengthReached=!0,!0):(this.maxLengthReached=!1,!1);if("object"===o(n)){var r=t.length-1>=n[i.inputName];return i.debug&&console.log("maxLength (obj) reached:",r),r?(this.maxLengthReached=!0,!0):(this.maxLengthReached=!1,!1)}}},{key:"isMaxLengthReached",value:function(){return Boolean(this.maxLengthReached)}},{key:"isTouchDevice",value:function(){return"ontouchstart"in window||navigator.maxTouchPoints}},{key:"pointerEventsSupported",value:function(){return window.PointerEvent}},{key:"camelCase",value:function(e){return!!e&&e.toLowerCase().trim().split(/[.\-_\s]/g).reduce(function(e,t){return t.length?e+t[0].toUpperCase()+t.slice(1):e})}}])&&a(t.prototype,i),s&&a(t,s),e}();l=function(){},(r="noop")in(s=c)?Object.defineProperty(s,r,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[r]=l;var d=c;function u(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=function(){function e(t){var i=t.dispatch,n=t.getOptions;!function(t,i){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.dispatch=i,this.getOptions=n,d.bindMethods(e,this)}var t,i;return t=e,(i=[{key:"handleHighlightKeyDown",value:function(e){var t=this.getOptions(),i=this.getSimpleKeyboardLayoutKey(e);this.dispatch(function(e){var n=e.getButtonElement(i)||e.getButtonElement("{".concat(i,"}"));n&&(n.style.backgroundColor=t.physicalKeyboardHighlightBgColor||"#dadce4",n.style.color=t.physicalKeyboardHighlightTextColor||"black",t.physicalKeyboardHighlightPress&&(n.onpointerdown||n.onmousedown||n.ontouchstart||d.noop)())})}},{key:"handleHighlightKeyUp",value:function(e){var t=this.getOptions(),i=this.getSimpleKeyboardLayoutKey(e);this.dispatch(function(e){var n=e.getButtonElement(i)||e.getButtonElement("{".concat(i,"}"));n&&n.removeAttribute&&(n.removeAttribute("style"),t.physicalKeyboardHighlightPress&&(n.onpointerup||n.onmouseup||n.ontouchend||d.noop)())})}},{key:"getSimpleKeyboardLayoutKey",value:function(e){var t;return((t=e.code.includes("Numpad")||e.code.includes("Shift")||e.code.includes("Space")||e.code.includes("Backspace")||e.code.includes("Control")||e.code.includes("Alt")||e.code.includes("Meta")?e.code:e.key)&&t!==t.toUpperCase()||"F"===e.code[0]&&Number.isInteger(Number(e.code[1]))&&e.code.length<=3)&&(t=t?t.toLowerCase():t),t}}])&&u(t.prototype,i),e}();function h(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?f(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function g(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var m=function(){function e(){var t=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),v(this,"handleParams",function(e){var t,i,n;if("string"==typeof e[0])t=e[0].split(".").join(""),i=document.querySelector(".".concat(t)),n=e[1];else if(e[0]instanceof HTMLDivElement){if(!e[0].className)throw console.warn("Any DOM element passed as parameter must have a class."),new Error("KEYBOARD_DOM_CLASS_ERROR");t=e[0].className.split(" ")[0],i=e[0],n=e[1]}else t="simple-keyboard",i=document.querySelector(".".concat(t)),n=e[0];return{keyboardDOMClass:t,keyboardDOM:i,options:n}}),v(this,"getOptions",function(){return t.options}),v(this,"getCaretPosition",function(){return t.caretPosition}),v(this,"getCaretPositionEnd",function(){return t.caretPositionEnd}),v(this,"registerModule",function(e,i){t.modules[e]||(t.modules[e]={}),i(t.modules[e])}),v(this,"getKeyboardClassString",function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return[t.keyboardDOMClass].concat(i).filter(function(e){return!!e}).join(" ")});for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];var a=this.handleParams(n),s=a.keyboardDOMClass,r=a.keyboardDOM,l=a.options,c=void 0===l?{}:l;if(this.utilities=new d({getOptions:this.getOptions,getCaretPosition:this.getCaretPosition,getCaretPositionEnd:this.getCaretPositionEnd,dispatch:this.dispatch}),this.caretPosition=null,this.caretPositionEnd=null,this.keyboardDOM=r,this.options=c,this.options.layoutName=this.options.layoutName||"default",this.options.theme=this.options.theme||"hg-theme-default",this.options.inputName=this.options.inputName||"default",this.options.preventMouseDownDefault=this.options.preventMouseDownDefault||!1,this.keyboardPluginClasses="",d.bindMethods(e,this),this.input={},this.input[this.options.inputName]="",this.keyboardDOMClass=s,this.buttonElements={},window.SimpleKeyboardInstances||(window.SimpleKeyboardInstances={}),this.currentInstanceName=this.utilities.camelCase(this.keyboardDOMClass),window.SimpleKeyboardInstances[this.currentInstanceName]=this,this.allKeyboardInstances=window.SimpleKeyboardInstances,this.keyboardInstanceNames=Object.keys(window.SimpleKeyboardInstances),this.isFirstKeyboardInstance=this.keyboardInstanceNames[0]===this.currentInstanceName,this.physicalKeyboard=new p({dispatch:this.dispatch,getOptions:this.getOptions}),!this.keyboardDOM)throw console.warn('".'.concat(s,'" was not found in the DOM.')),new Error("KEYBOARD_DOM_ERROR");this.render(),this.modules={},this.loadModules()}var t,i;return t=e,(i=[{key:"setCaretPosition",value:function(e,t){this.caretPosition=e,this.caretPositionEnd=t||e}},{key:"handleButtonClicked",value:function(e){var t=this.options.debug;if("{//}"===e)return!1;"function"==typeof this.options.onKeyPress&&this.options.onKeyPress(e),this.input[this.options.inputName]||(this.input[this.options.inputName]="");var i=this.utilities.getUpdatedInput(e,this.input[this.options.inputName],this.caretPosition,this.caretPositionEnd);if(this.input[this.options.inputName]!==i&&(!this.options.inputPattern||this.options.inputPattern&&this.inputPatternIsValid(i))){if(this.options.maxLength&&this.utilities.handleMaxLength(this.input,i))return!1;this.input[this.options.inputName]=this.utilities.getUpdatedInput(e,this.input[this.options.inputName],this.caretPosition,this.caretPositionEnd,!0),t&&console.log("Input changed:",this.getAllInputs()),this.options.debug&&console.log("Caret at: ",this.getCaretPosition(),this.getCaretPositionEnd(),"(".concat(this.keyboardDOMClass,")")),this.options.syncInstanceInputs&&this.syncInstanceInputs(),"function"==typeof this.options.onChange&&this.options.onChange(this.getInput(this.options.inputName,!0)),"function"==typeof this.options.onChangeAll&&this.options.onChangeAll(this.getAllInputs())}t&&console.log("Key pressed:",e)}},{key:"handleButtonMouseDown",value:function(e,t){var i=this;t&&(this.options.preventMouseDownDefault&&t.preventDefault(),this.options.stopMouseDownPropagation&&t.stopPropagation(),t.target.classList.add(this.activeButtonClass)),this.holdInteractionTimeout&&clearTimeout(this.holdInteractionTimeout),this.holdTimeout&&clearTimeout(this.holdTimeout),this.isMouseHold=!0,this.options.disableButtonHold||(this.holdTimeout=setTimeout(function(){(i.isMouseHold&&(!e.includes("{")&&!e.includes("}")||"{delete}"===e||"{backspace}"===e||"{bksp}"===e||"{space}"===e||"{tab}"===e)||"{arrowright}"===e||"{arrowleft}"===e||"{arrowup}"===e||"{arrowdown}"===e)&&(i.options.debug&&console.log("Button held:",e),i.handleButtonHold(e,t)),clearTimeout(i.holdTimeout)},500))}},{key:"handleButtonMouseUp",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i&&(this.options.preventMouseUpDefault&&i.preventDefault(),this.options.stopMouseUpPropagation&&i.stopPropagation()),this.recurseButtons(function(t){t.classList.remove(e.activeButtonClass)}),this.isMouseHold=!1,this.holdInteractionTimeout&&clearTimeout(this.holdInteractionTimeout),t&&"function"==typeof this.options.onKeyReleased&&this.options.onKeyReleased(t)}},{key:"handleKeyboardContainerMouseDown",value:function(e){this.options.preventMouseDownDefault&&e.preventDefault()}},{key:"handleButtonHold",value:function(e){var t=this;this.holdInteractionTimeout&&clearTimeout(this.holdInteractionTimeout),this.holdInteractionTimeout=setTimeout(function(){t.isMouseHold?(t.handleButtonClicked(e),t.handleButtonHold(e)):clearTimeout(t.holdInteractionTimeout)},100)}},{key:"syncInstanceInputs",value:function(){var e=this;this.dispatch(function(t){t.replaceInput(e.input),t.setCaretPosition(e.caretPosition,e.caretPositionEnd)})}},{key:"clearInput",value:function(e){e=e||this.options.inputName,this.input[e]="",this.setCaretPosition(0),this.options.syncInstanceInputs&&this.syncInstanceInputs()}},{key:"getInput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e=e||this.options.inputName,this.options.syncInstanceInputs&&!t&&this.syncInstanceInputs(),this.options.rtl?"‫"+this.input[e].replace("‫","").replace("‬","")+"‬":this.input[e]}},{key:"getAllInputs",value:function(){var e=this,t={};return Object.keys(this.input).forEach(function(i){t[i]=e.getInput(i,!0)}),t}},{key:"setInput",value:function(e,t){t=t||this.options.inputName,this.input[t]=e,this.options.syncInstanceInputs&&this.syncInstanceInputs()}},{key:"replaceInput",value:function(e){this.input=e}},{key:"setOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.changedOptions(e);this.options=Object.assign(this.options,e),t.length&&(this.options.debug&&console.log("changedOptions",t),this.onSetOptions(e),this.render())}},{key:"changedOptions",value:function(e){var t=this;return Object.keys(e).filter(function(i){return JSON.stringify(e[i])!==JSON.stringify(t.options[i])})}},{key:"onSetOptions",value:function(e){e.inputName&&(this.options.debug&&console.log("inputName changed. caretPosition reset."),this.setCaretPosition(null))}},{key:"clear",value:function(){this.keyboardDOM.innerHTML="",this.keyboardDOM.className=this.keyboardDOMClass,this.buttonElements={}}},{key:"dispatch",value:function(e){if(!window.SimpleKeyboardInstances)throw console.warn("SimpleKeyboardInstances is not defined. Dispatch cannot be called."),new Error("INSTANCES_VAR_ERROR");return Object.keys(window.SimpleKeyboardInstances).forEach(function(t){e(window.SimpleKeyboardInstances[t],t)})}},{key:"addButtonTheme",value:function(e,t){var i=this;if(!t||!e)return!1;e.split(" ").forEach(function(n){t.split(" ").forEach(function(t){i.options.buttonTheme||(i.options.buttonTheme=[]);var o=!1;i.options.buttonTheme.map(function(e){if(e["class"].split(" ").includes(t)){o=!0;var i=e.buttons.split(" ");i.includes(n)||(o=!0,i.push(n),e.buttons=i.join(" "))}return e}),o||i.options.buttonTheme.push({"class":t,buttons:e})})}),this.render()}},{key:"removeButtonTheme",value:function(e,t){var i=this;if(!e&&!t)return this.options.buttonTheme=[],this.render(),!1;e&&Array.isArray(this.options.buttonTheme)&&this.options.buttonTheme.length&&(e.split(" ").forEach(function(e){i.options.buttonTheme.map(function(n,o){if(t&&t.includes(n["class"])||!t){var a=n.buttons.split(" ").filter(function(t){return t!==e});a.length?n.buttons=a.join(" "):(i.options.buttonTheme.splice(o,1),n=null)}return n})}),this.render())}},{key:"getButtonElement",value:function(e){var t,i=this.buttonElements[e];return i&&(t=i.length>1?i:i[0]),t}},{key:"inputPatternIsValid",value:function(e){var t,i=this.options.inputPattern;if((t=i instanceof RegExp?i:i[this.options.inputName])&&e){var n=t.test(e);return this.options.debug&&console.log('inputPattern ("'.concat(t,'"): ').concat(n?"passed":"did not pass!")),n}return!0}},{key:"setEventListeners",value:function(){!this.isFirstKeyboardInstance&&this.allKeyboardInstances||(this.options.debug&&console.log("Caret handling started (".concat(this.keyboardDOMClass,")")),document.addEventListener("keyup",this.handleKeyUp),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("touchend",this.handleTouchEnd))}},{key:"handleKeyUp",value:function(e){this.caretEventHandler(e),this.options.physicalKeyboardHighlight&&this.physicalKeyboard.handleHighlightKeyUp(e)}},{key:"handleKeyDown",value:function(e){this.options.physicalKeyboardHighlight&&this.physicalKeyboard.handleHighlightKeyDown(e)}},{key:"handleMouseUp",value:function(e){this.caretEventHandler(e)}},{key:"handleTouchEnd",value:function(e){this.caretEventHandler(e)}},{key:"caretEventHandler",value:function(e){var t;e.target.tagName&&(t=e.target.tagName.toLowerCase()),this.dispatch(function(i){var n=e.target===i.keyboardDOM||e.target&&i.keyboardDOM.contains(e.target);i.isMouseHold&&(i.isMouseHold=!1),("textarea"===t||"input"===t)&&"selectionStart"in e.target&&"selectionEnd"in e.target&&!i.options.disableCaretPositioning?(i.setCaretPosition(e.target.selectionStart,e.target.selectionEnd),i.options.debug&&console.log("Caret at: ",i.getCaretPosition(),i.getCaretPositionEnd(),e&&e.target.tagName.toLowerCase(),"(".concat(i.keyboardDOMClass,")"))):!i.options.disableCaretPositioning&&n||i.setCaretPosition(null)})}},{key:"recurseButtons",value:function(e){var t=this;e&&Object.keys(this.buttonElements).forEach(function(i){return t.buttonElements[i].forEach(e)})}},{key:"destroy",value:function(){this.options.debug&&console.log("Destroying simple-keyboard instance: ".concat(this.currentInstanceName)),document.removeEventListener("keyup",this.handleKeyUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("touchend",this.handleTouchEnd),document.onpointerup=null,document.ontouchend=null,document.ontouchcancel=null,document.onmouseup=null;var e=function(e){e.onpointerdown=null,e.onpointerup=null,e.onpointercancel=null,e.ontouchstart=null,e.ontouchend=null,e.ontouchcancel=null,e.onclick=null,e.onmousedown=null,e.onmouseup=null,e.remove(),e=null};this.recurseButtons(e),this.recurseButtons=null,e=null,this.keyboardDOM.onpointerdown=null,this.keyboardDOM.ontouchstart=null,this.keyboardDOM.onmousedown=null,this.clear(),window.SimpleKeyboardInstances[this.currentInstanceName]=null,delete window.SimpleKeyboardInstances[this.currentInstanceName],this.initialized=!1}},{key:"getButtonThemeClasses",value:function(e){var t=this.options.buttonTheme,i=[];return Array.isArray(t)&&t.forEach(function(t){if(t["class"]&&"string"==typeof t["class"]&&t.buttons&&"string"==typeof t.buttons){var n=t["class"].split(" ");t.buttons.split(" ").includes(e)&&(i=[].concat(h(i),h(n)))}else console.warn('Incorrect "buttonTheme". Please check the documentation.',t)}),i}},{key:"setDOMButtonAttributes",value:function(e,t){var i=this.options.buttonAttributes;Array.isArray(i)&&i.forEach(function(i){i.attribute&&"string"==typeof i.attribute&&i.value&&"string"==typeof i.value&&i.buttons&&"string"==typeof i.buttons?i.buttons.split(" ").includes(e)&&t(i.attribute,i.value):console.warn('Incorrect "buttonAttributes". Please check the documentation.',i)})}},{key:"onTouchDeviceDetected",value:function(){this.processAutoTouchEvents(),this.disableContextualWindow()}},{key:"disableContextualWindow",value:function(){window.oncontextmenu=function(e){if(e.target.classList.contains("hg-button"))return e.preventDefault(),e.stopPropagation(),!1}}},{key:"processAutoTouchEvents",value:function(){this.options.autoUseTouchEvents&&(this.options.useTouchEvents=!0,this.options.debug&&console.log("autoUseTouchEvents: Touch device detected, useTouchEvents enabled."))}},{key:"onInit",value:function(){this.options.debug&&console.log("".concat(this.keyboardDOMClass," Initialized")),this.setEventListeners(),"function"==typeof this.options.onInit&&this.options.onInit()}},{key:"beforeFirstRender",value:function(){this.utilities.isTouchDevice()&&this.onTouchDeviceDetected(),"function"==typeof this.options.beforeFirstRender&&this.options.beforeFirstRender(),this.isFirstKeyboardInstance&&this.utilities.pointerEventsSupported()&&!this.options.useTouchEvents&&!this.options.useMouseEvents&&this.options.debug&&console.log("Using PointerEvents as it is supported by this browser"),this.options.useTouchEvents&&this.options.debug&&console.log("useTouchEvents has been enabled. Only touch events will be used.")}},{key:"beforeRender",value:function(){"function"==typeof this.options.beforeRender&&this.options.beforeRender()}},{key:"onRender",value:function(){"function"==typeof this.options.onRender&&this.options.onRender()}},{key:"onModulesLoaded",value:function(){"function"==typeof this.options.onModulesLoaded&&this.options.onModulesLoaded(this)}},{key:"loadModules",value:function(){var e=this;Array.isArray(this.options.modules)&&(this.options.modules.forEach(function(t){(new t).init(e)}),this.keyboardPluginClasses="modules-loaded",this.render(),this.onModulesLoaded())}},{key:"getModuleProp",value:function(e,t){return!!this.modules[e]&&this.modules[e][t]}},{key:"getModulesList",value:function(){return Object.keys(this.modules)}},{key:"parseRowDOMContainers",value:function(e,t,i,n){var o=this,a=Array.from(e.children),s=0;return a.length&&i.forEach(function(i,r){var l=n[r];if(!(l&&l>i))return!1;var c=i-s,d=l-s,u=document.createElement("div");u.className+="hg-button-container";var p="".concat(o.options.layoutName,"-r").concat(t,"c").concat(r);u.setAttribute("data-skUID",p);var h=a.splice(c,d-c+1);s=d-c,h.forEach(function(e){return u.appendChild(e)}),a.splice(c,0,u),e.innerHTML="",a.forEach(function(t){return e.appendChild(t)}),o.options.debug&&console.log("rowDOMContainer",h,c,d,s+1)}),e}},{key:"render",value:function(){var e=this;this.clear(),this.initialized||this.beforeFirstRender(),this.beforeRender();var t="hg-layout-".concat(this.options.layoutName),i=this.options.layout||{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","{lock} a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}",".com @ {space}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'{lock} A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}",".com @ {space}"]},n=this.options.useTouchEvents||!1,o=n?"hg-touch-events":"",a=this.options.useMouseEvents||!1,s=this.options.disableRowButtonContainers;this.keyboardDOM.className=this.getKeyboardClassString(this.options.theme,t,this.keyboardPluginClasses,o),i[this.options.layoutName].forEach(function(t,i){var o=t.split(" "),r=document.createElement("div");r.className+="hg-row";var l=[],c=[];o.forEach(function(t,o){var d=!s&&"string"==typeof t&&t.length>1&&0===t.indexOf("["),u=!s&&"string"==typeof t&&t.length>1&&t.indexOf("]")===t.length-1;d&&(l.push(o),t=t.replace(/\[/g,"")),u&&(c.push(o),t=t.replace(/\]/g,""));var p=e.utilities.getButtonClass(t),h=e.utilities.getButtonDisplayName(t,e.options.display,e.options.mergeDisplay),f=e.options.useButtonTag?"button":"div",g=document.createElement(f);g.className+="hg-button ".concat(p),e.setDOMButtonAttributes(t,function(e,t){g.setAttribute(e,t)}),e.activeButtonClass="hg-activeButton",!e.utilities.pointerEventsSupported()||n||a?n?(g.ontouchstart=function(i){e.handleButtonClicked(t),e.handleButtonMouseDown(t,i)},g.ontouchend=function(i){e.handleButtonMouseUp(t,i)},g.ontouchcancel=function(i){e.handleButtonMouseUp(t,i)}):(g.onclick=function(){e.isMouseHold=!1,e.handleButtonClicked(t)},g.onmousedown=function(i){e.handleButtonMouseDown(t,i)},g.onmouseup=function(i){e.handleButtonMouseUp(t,i)}):(g.onpointerdown=function(i){e.handleButtonClicked(t),e.handleButtonMouseDown(t,i)},g.onpointerup=function(i){e.handleButtonMouseUp(t,i)},g.onpointercancel=function(i){e.handleButtonMouseUp(t,i)}),g.setAttribute("data-skBtn",t);var v="".concat(e.options.layoutName,"-r").concat(i,"b").concat(o);g.setAttribute("data-skBtnUID",v);var m=document.createElement("span");m.innerHTML=h,g.appendChild(m),e.buttonElements[t]||(e.buttonElements[t]=[]),e.buttonElements[t].push(g),r.appendChild(g)}),r=e.parseRowDOMContainers(r,i,l,c),e.keyboardDOM.appendChild(r)}),this.onRender(),this.initialized||(this.initialized=!0,!this.utilities.pointerEventsSupported()||n||a?n?(document.ontouchend=function(){return e.handleButtonMouseUp()},document.ontouchcancel=function(){return e.handleButtonMouseUp()},this.keyboardDOM.ontouchstart=function(t){return e.handleKeyboardContainerMouseDown(t)}):n||(document.onmouseup=function(){return e.handleButtonMouseUp()},this.keyboardDOM.onmousedown=function(t){return e.handleKeyboardContainerMouseDown(t)}):(document.onpointerup=function(){return e.handleButtonMouseUp()},this.keyboardDOM.onpointerdown=function(t){return e.handleKeyboardContainerMouseDown(t)}),this.onInit())}}])&&g(t.prototype,i),e}();t["default"]=m}])}),$(function(){var e,t,n,o,a=navigator.userAgent.toLowerCase(),s={agent:a,body:$("body"),cache:{sideselect:{}},is_android:a.indexOf("android")>-1||a.indexOf("iphone")>-1||a.indexOf("staros")>-1,is_browser:a.indexOf("windows nt")>-1||a.indexOf("macintosh")>-1,android_app:"undefined"!=typeof androidApp,is_touch:!1,domain_web:"http://web.vokino.tv",domain_url:"http://api.vokino.tv/v2",main_url:"http://api.vokino.tv/v2/main",search_url:"http://api.vokino.tv/v2/list?name=",templates:{},timers:{},intervals:{},torrserver:[],torr_uapi:[],video_formats:["asf","wmv","divx","avi","mp4","m4v","mov","3gp","3g2","mkv","ts","trp","tp","mts","mpg","mpeg","dat","vob","rm","rmvb","m2ts"],create:["State","Controller","Platform","Console","Account","Kinopub","Settings","Convert","History","Loader","Detect","Layer","Reguest","Keybord","SpatialNavigator","Hover","Background","Template","Menu","Interface","Player","Upload","Search","Splash","Drop","Noti","Modal","Filter","Socket","AD"]},r={};(a.indexOf("webos")>-1||a.indexOf("web0s")>-1||a.indexOf("tizen")>-1)&&$(".b-head__fullscreen,.e-player__fullscreen").remove(),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert first argument to object");for(var i=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var a=Object.keys(Object(o)),s=0,r=a.length;s<r;s++){var l=a[s],c=Object.getOwnPropertyDescriptor(o,l);void 0!==c&&c.enumerable&&(i[l]=o[l])}}return i}}),Array.from||(Array.from=(e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},n=Math.pow(2,53)-1,o=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),n)},function(e){var i=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var n,a=arguments.length>1?arguments[1]:void 0;if(void 0!==a){if(!t(a))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(n=arguments[2])}for(var s,r=o(i.length),l=t(this)?Object(new this(r)):new Array(r),c=0;c<r;)s=i[c],l[c]=a?void 0===n?a(s,c):a.call(n,s,c):s,c+=1;return l.length=r,l})),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n=arguments[1],o=0;o<i;){var a=t[o];if(e.call(n,a,o,t))return a;o++}},configurable:!0,writable:!0}),jQuery.fn.focusTextToEnd=function(){this.focus();var e=this.val();return this.val("").val(e),this},jQuery.fn.putCursorAtEnd=function(){return this.each(function(){var e=this;setTimeout(function(){e.selectionStart=e.selectionEnd=1e4},0)})},String.prototype.toHHMMSS=function(){var e=parseInt(this,10),t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),n=e-3600*t-60*i;return t<10&&(t="0"+t),i<10&&(i="0"+i),n<10&&(n="0"+n),t+":"+i+":"+n},String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)});function l(e){var t,i={time:500},n=0,o=this;e&&d.extend(i,e,!0),this.ontap=function(){},this.onclick=function(){},this.trigger=function(){clearTimeout(t),Date.now()-n<i.time?this.ontap():t=setTimeout(function(){o.onclick()},i.time),n=Date.now()}}window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)});var c={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,i,n,o,a,s,r,l="",d=0;for(e=c._utf8_encode(e);d<e.length;)o=(t=e.charCodeAt(d++))>>2,a=(3&t)<<4|(i=e.charCodeAt(d++))>>4,s=(15&i)<<2|(n=e.charCodeAt(d++))>>6,r=63&n,isNaN(i)?s=r=64:isNaN(n)&&(r=64),l=l+this._keyStr.charAt(o)+this._keyStr.charAt(a)+this._keyStr.charAt(s)+this._keyStr.charAt(r);return l},decode:function(e){var t,i,n,o,a,s,r="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=this._keyStr.indexOf(e.charAt(l++))<<2|(o=this._keyStr.indexOf(e.charAt(l++)))>>4,i=(15&o)<<4|(a=this._keyStr.indexOf(e.charAt(l++)))>>2,n=(3&a)<<6|(s=this._keyStr.indexOf(e.charAt(l++))),r+=String.fromCharCode(t),64!=a&&(r+=String.fromCharCode(i)),64!=s&&(r+=String.fromCharCode(n));return r=c._utf8_decode(r)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},_utf8_decode:function(e){for(var t="",i=0,n=c1=c2=0;i<e.length;)(n=e.charCodeAt(i))<128?(t+=String.fromCharCode(n),i++):n>191&&n<224?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&n)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),i+=3);return t}},d=new function(){this.toObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)?e:e={}},this.toArray=function(e){if("[object Object]"===Object.prototype.toString.call(e)){var t=[];for(var i in e)t.push(e[i]);return t}return"string"==typeof e||null==e?[]:e},this.decodeJson=function(e,t){var i=t||{};if(e)try{i=JSON.parse(e)}catch(e){}return i},this.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},this.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},this.getRecursive=function(e,t){for(var i,n=0;n<t.length;n++)i=n?i[t[n]]:e[t[n]];return i},this.setRecursive=function(e,t,i){var n;if(t.length)if(1==t.length)e[t[0]]=i;else{this.createPath(e,t);for(var o=0;o<t.length;o++)o==t.length-1?n[t[o]]=i:n=o?n[t[o]]:e[t[o]]}},this.getSplit=function(e,t){return void 0!==e&&"string"==typeof e?e.split(t):[]},this.createPath=function(e,t){if(t.length>=2){for(var i,n={},o=0;o<t.length-1;o++)o?(null==i[t[o]]&&(i[t[o]]={}),i=i[t[o]]):(null==n[t[o]]&&(n[t[o]]={}),i=n[t[o]]);this.extend(e,n)}},this.extend=function(e,t,i){for(var n in t)"object"==typeof t[n]?(null==e[n]&&(e[n]="[object Array]"==Object.prototype.toString.call(t[n])?[]:{}),this.extend(e[n],t[n],i)):(null==e[n]||i)&&(e[n]=t[n])},this.getKeys=function(e,t){var i=t||[];for(var n in e)i.push(n);return i},this.getValues=function(e,t){var i=t||[];for(var n in e)i.push(e[n]);return i},this.getRandom=function(e){return e[Math.floor(Math.random()*e.length)]},this.walk=function(e,t,i){for(var n=this.toArray(e),o=0;o<n.length;o++)n[o][t]&&n[o][t](i)},this.walkReverse=function(e,t,i){for(var n=this.toArray(e),o=n.length-1;o>=0;o--)n[o]&&n[o][t]&&n[o][t](i)},this.traverse=function(e,t){for(var i=this.toArray(e),n=i.length-1;n>=0;n--)t(i[n])},this.remove=function(e,t){var i=e.indexOf(t);i>=0&&e.splice(i,1)},this.clone=function(e){return JSON.parse(JSON.stringify(e))},this.insert=function(e,t,i){e.splice(t,0,i)},this.shuffle=function(e){for(var t=e.length-1;t>0;t--){var i=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[i],e[i]=n}return e},this.flip=function(e){var t,i={};for(t in e)e.hasOwnProperty(t)&&(i[e[t]]=t);return i},this.last=function(e){return e.slice(-1)[0]},this.unique=function(e){return Array.from(new Set(e))},this.getRandomSubarray=function(e,t){for(var i,n,o=e.slice(0),a=e.length;a--;)i=o[n=Math.floor((a+1)*Math.random())],o[n]=o[a],o[a]=i;return o.slice(0,t)},this.sortBy=function(e,t){var i=[],n={};for(var o in e)i.push([o,void 0!==t?e[o][t]:e[o]]);i.sort(function(e,t){return e[1]-t[1]});for(var a=0;a<i.length;a++)n[i[a][0]]=e[i[a][0]];return n},this.reverse=function(e){var t=this.getKeys(e);t.reverse();for(var i={},n=0;n<t.length;n++)i[t[n]]=e[t[n]];return i},this.removeDublicate=function(e,t){for(var i in e)void 0!==t[i]&&t[i]==e[i]&&delete t[i]},this.isEqual=function(e,t){var i=!0;if(this.isObject(e)){var n=this.toArray(e),o=this.toArray(t);if(n.length==o.length)for(var a in e)null!=t[a]&&e[a]===t[a]||(i=!1);else i=!1}else if(e.length==t.length)for(a=0;a<e.length;a++)e[a]!==t[a]&&(i=!1);else i=!1;return i},this.insertAfter=function(e,t,i,n){var o={};for(var a in e)o[a]=e[a],a==t&&(o[i]=n);return o},this.filterEmpty=function(e){return e.filter(function(e){return e})},this.ignore=function(e,t){return e.filter(function(e){for(var i=0;i<t.length;i++)if(0==e.indexOf(t[i]))return!1;return!0})}};function u(){}Object.assign(u.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(void 0!==i){var n=i.indexOf(t);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=t.slice(0),n=0,o=i.length;n<o;n++)i[n].call(this,e)}}}});var h=new function(){var e=document.createElement("canvas"),t=e.getContext("2d");this.substr=function(e,t){return(e=e||"").length>t?e.substr(0,t)+"...":e},this.stars=function(e,g){-1==e.indexOf(".")&&(e+=".0");-1==g.indexOf(".")&&(g+=".0");var t=e,m=g,o=s.Template.get("stars",{bal:t,bal_kp:m});return o.find(".e-stars__flex .imdb").append("<style>.imdb .e-stars__progress:after {width:"+t*10+"%} </style>"),o.find(".e-stars__flex .kp").append("<style>.kp .e-stars__progress:after {width:"+m*10+"%} </style>"),o},this.poster=function(e,t){return e.bg_poster&&e.bg_poster.pattern?e.bg_poster.pattern.replace("{quality}",t||e.bg_poster.qualitys[1]).replace("{id}",e.bg_poster.ids[0]):e.poster},this.bg=function(e){var t={api:e.bg_poster&&e.bg_poster.tmdbapi?e.bg_poster.tmdbapi:"",bg:e.bg_poster&&e.bg_poster.backdrop?e.bg_poster.backdrop:"",poster:e.poster};return encodeURI(JSON.stringify(t))},this.imgToBase=function(i){return e.width=i.width,e.height=i.height,t.drawImage(i,0,0),e.toDataURL()},this.intersect=function(e,t){return e.right=e.left+e.width,e.bottom=e.top+e.height,t.right=t.left+t.width,t.bottom=t.top+t.height,!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},this.visibility=function(e){var t=e.offset();return this.intersect({left:t.left,top:t.top,width:e.width(),height:e.height()},{left:0,top:0,width:window.innerWidth,height:window.innerHeight})},this.secondsToTime=function(e){var t=parseInt(e,10),i=Math.floor(t/3600),n=Math.floor((t-3600*i)/60),o=t-3600*i-60*n;return i<10&&(i="0"+i),n<10&&(n="0"+n),o<10&&(o="0"+o),i+":"+n+":"+o},this.slideDown=function(e,t){s.Settings.get("animation")?e.stop().slideDown(300,function(){t&&t()}):(e.show(),t&&t())},this.slideUp=function(e,t){s.Settings.get("animation")?e.stop().slideUp(300,function(){t&&t()}):(e.hide(),t&&t())},this.bytesToSize=function(e){if(0==e)return"0 Bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},this.animIn=function(e){s.Settings.get("animation")?e.show().removeClass("anim-out").addClass("anim-in"):e.removeClass("anim-out").show()},this.animOut=function(e,t){s.Settings.get("animation")?(e.removeClass("anim-in").addClass("anim-out"),setTimeout(function(){e.hide(),t&&t()},300)):(e.hide(),t&&t())},this.scrollUpdate=function(e,t,i){var n=e.parents(".scrollbar-inner");if(n.length){var o=e.offset().top,a=n.offset().top+(t?n.height()/2:0),parent=e.parent();if(o>a||o<a){var r=a-o,l=n.scrollTop()-r;i?n.stop().animate({scrollTop:l},200):n.scrollTop(l),s.Hover.drawInstantly()}}},this.humanizeSize=function(e){if(!e)return"";var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]},this.uid=function(e){for(var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i=e||8,n="",o=0;o<i;o++)n+=t.charAt(Math.floor(Math.random()*t.length));return n},this.validateEmail=function(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},this.capitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},this.getQualityFromUrl=function(e,t){for(var i=["4k","2160","1080","720","480","360"],n="---",o=0;o<i.length;o++){var a=i[o];if(-1!==e.indexOf(a)){n=a+"p";break}}return t?"---"!=n&&n:n},this.password=function(e){e+="";for(var t="",i=0;i<e.length;i++)t+="*";return t},this.quality=function(e){return"---"==(e+="")?e:(/\d/.test(e)&&"p"!==e[e.length-1]&&(e=parseInt(e)+"p"),e)},this.hashCode=function(e){var t=0;if(0==e.length)return t;for(i=0;i<e.length;i++)char=e.charCodeAt(i),t=(t<<5)-t+char,t&=t;return Math.abs(t)+""},this.timeNow=function(){return(Date.now()/1e3+"").toHHMMSS()},this.fileTimeline=function(e,t,i){if(!i||t.current)if($(".tp",e).hide(),e.data("timeline",!1),t)if(e.removeClass("notviewed").addClass("viewed"),e.data("timeline",t),t.webplayer){$(".t-2",e).show();var n=Math.round(t.current/t.time*100)+"%";$(".t-view",e).text((t.current+"").toHHMMSS()),$(".t-total",e).text((t.time+"").toHHMMSS()),$(".t-percent",e).text(n),$(".progress",e).css({width:n})}else t.current?$(".t-1",e).show():$(".t-0",e).show();else $(".t-0",e).show(),e.addClass("notviewed").removeClass("viewed")},this.updateAllTimeline=function(e,t){$('[idh="'+e+'"]').each(function(){h.fileTimeline($(this),t)})},this.setWath=function(e,t){e?(s.Reguest.silent(s.domain_url+"/timeline/watch?ident="+t+"&current=60&time=60&webplayer=true"),$.notify("标记为已查看",{className:"white"})):(s.Reguest.silent(s.domain_url+"/timeline/unwatch?ident="+t),$.notify("标记为未查看",{className:"white"})),this.updateAllTimeline(t,!!e&&{current:60,time:60,webplayer:0})},this.getColors=function(e){for(var t=e.data,i=[],n=0,o=t.length;n<o;n+=4)i.push([t[n],t[n+1],t[n+2]]);return i},this.getPalleteColor=function(){var e=["264653","2a9d8f","e9c46a","f4a261","e76f51","16697a","489fb5","82c0cc","ddc9b4","bcac9b","ded9e2","f7af9d"];return"#"+e[Math.round(Math.random()*(e.length-1))]},this.getRandomColor=function(e){function t(e){var t=255-e,i=(0|Math.random()*t+e).toString(16);return 1==i.length?"0"+i:i}return"#"+t(e)+t(e)+t(e)},this.detectIsOldBrowser=function(){var e=!1,t=["-webkit-box","-webkit-flex","-moz-box","-ms-flexbox","flex"],i=document.createElement("b");try{i.style.height="100vh";for(var n=0;n<t.length;n++)i.style.display=t[n];e=t.indexOf(i.style.display)>=0&&"100vh"==i.style.height}catch(i){e=!1}if(!e)return!0},this.checkCssWork=function(e,t){var i=!1,n=document.createElement("b");try{for(var o=0;o<t.length;o++)n.style[e]=t[o];i=t.indexOf(n.style[e])>=0}catch(n){i=!1}return i},this.calcBitrate=function(byteSize,minutes){if(!minutes)return 0;var sec=minutes*60;var bitSize=byteSize*8;return(bitSize/Math.pow(1e3,2)/sec).toFixed(2)},this.isTbit=function(){return!1},this.scrollIsStart=function(e){if(e.length&&0==Math.round(e.scrollTop()))return!0},this.scrollIsEnd=function(e){if(e.length&&Math.round(e.scrollTop()+e.innerHeight())>=e[0].scrollHeight)return!0},this.isCardsLine=function(e){if($(e.target).parents(".cards-line").length||$(e.target).hasClass("cards-line"))return!0},this.fixBodyScroll=function(){$("body html").scrollTop(0)},this.inIframe=function(){try{return window.self!==window.top}catch(e){return!0}},this.serverConnected=function(){var e=s.Settings.get("server_use");return s["server_connected_"+e]},this.serverUsed=function(){var e=s.Settings.get("server_use");return s.Settings.get(e)},this.addUrlParams=function(e,t){return e+(/\?/.test(e)?"&":"?")+t},this.breakText=function(e){return e.split(" ").map(function(e){return e.length>20?"<span>"+e+"</span>":e}).join(" ")},this.deviceName=function(){var e=navigator.userAgent;try{var t=navigator.userAgent.match(/\((.*?)\)/g);if(t.length)for(var i=0;i<t.length;i++){var n=t[i];if(-1==n.toLowerCase().indexOf("khtml")){e=n.replace(/[()]/g,"");break}}}catch(e){}return e},this.chunkString=function(e,t){for(var i,n=Math.ceil(e.length/t),o=new Array(n),a=0;a<n;a++)i=a*t,o[a]=e.substring(i,i+t);return o},this.stringToHslColor=function(e,t,i){for(var n=0,o=0;o<e.length;o++)n=e.charCodeAt(o)+((n<<5)-n);return"hsl("+n%360+", "+t+"%, "+i+"%)"},this.cache=function(e,t,i,n){if(!n){var o=d.decodeJson(f.get(e),i);if(d.isObject(i)){var a=d.getKeys(o);a.length>t&&delete o[a[0]],this.cache(e,t,i,o)}else o.length>t&&(o.shift(),this.cache(e,t,i,o));return o}f.set(e,JSON.stringify(n))},this.parseUrl=function(e,t,i){if(androidApp.wait_parse)return i();var n,o=function(){clearInterval(n),i("")};try{androidApp.version?androidApp.parseUrl(e.method||"GET",e.url,JSON.stringify(e.headers||{}),e.post||"",e.need_download||!1):androidApp.parseUrl(e.method||"GET",e.url,JSON.stringify(e.headers||{}),e.post||"");var a=Date.now();n=setInterval(function(){var e="";try{e=androidApp.getResultData()}catch(t){e="error"}"error"==e?o():e?(clearInterval(n),t(e)):Date.now()-a>4e4&&o()},200)}catch(e){o()}},this.helper=function(e,t){s["show_helper_"+e]||(s["show_helper_"+e]=!0,$.notify(t,{className:"white",position:"right bottom"}))},this.copyToClipboard=function(e){var t=document.createElement("textarea");t.innerHTML=e,document.body.appendChild(t),t.select();var i=document.execCommand("copy");return document.body.removeChild(t),i},this.rusToLatin=function(e){var t={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"e","ж":"j","з":"z","и":"i","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"shch","ы":"y","э":"e","ю":"u","я":"ya"},i=[];e=e.replace(/[ъь]+/g,"").replace(/й/g,"i");for(var n=0;n<e.length;++n)i.push(t[e[n]]||null==t[e[n].toLowerCase()]&&e[n]||t[e[n].toLowerCase()].toUpperCase());return i.join("")},this.nameToLatin=function(e){var t=this.rusToLatin(e);return this.substr(t.replace(/[^a-zA-Z]+/g,"_"),30)}},f=new function(){var e=window.localStorage;this.get=function(t){return e.getItem(t)},this.set=function(t,i){e.setItem(t,i)}},g={cards:['<div class="b-cards ">','<div class="b-cards__head">','<div class="b-cards__name">{title}</div>',"</div>",'<div class="b-cards__body b-swipe">','<div class="b-swipe__wrap">',"</div>","</div>",'<div class="b-cards__foot">',"</div>","</div>"].join(""),cards_slide:'<div class="b-cards__slide b-swipe__item"></div>',cards_load:['<div class="b-cards__slide b-swipe__item">','<div class="e-card e-card--load loaded">','<div class="e-card__acens" data-hover-background="#fff">','<div class="e-card__img"></div>',"</div>",'<div class="e-card__name"></div>','<div class="e-card__date"></div>',"</div>","</div>"].join(""),cards_empty:['<div class="b-cards__slide b-swipe__item">','<div class="e-card e-card--empty">','<div class="e-card__acens" data-hover-noselect="true">','<div class="e-card__img"></div>',"</div>",'<div class="e-card__right">','<div class="e-card__name">糟糕...列表为空!</div>','<div class="e-card__descr">可能出现问题或列表确实为空。</div>',"</div>","</div>","</div>"].join(""),swipe_vertival:['<div class="b-swipe b-swipe--vertical">','<div class="b-swipe__wrap">',"</div>","</div>"].join(""),swipe_horizontal:['<div class="b-swipe">','<div class="b-swipe__wrap">',"</div>","</div>"].join(""),swipe_slide:'<div class="b-swipe__item"></div>',cards_descr:['<div class="b-cards-desc ">','<div class="b-cards-desc__head">','<div class="b-cards-desc__title">{name}</div>','<div class="b-cards-desc__line">','<div class="e-line "><span class="e-line__date">{released}</span><span class="e-line__tags">{country}</span><span class="e-line__tags">{genre}</span></div>',"</div>","</div>",'<div class="b-cards-desc__body">','<div class="b-cards-desc__text">{about}</div>',"<div>",' <div class="e-create ">','<div class="e-create__name">导演</div>','<div class="e-create__value">{director}</div>',"</div>","</div>","</div>","</div>"].join(""),stars:['<div class="e-stars">','<img src="'+s.domain_web+'/img/imdb.svg" style="height:1.5em;width:3em;"><div class="e-stars__flex imdb" style="margin-right: .5em"><div class="e-stars__total">{bal}</div>','<div class="e-stars__progress imdb"></div></div>','<img src="'+s.domain_web+'/img/kinopoisk.png" style="height:1.5em;width:1.5em;"><div class="e-stars__flex kp" ><div class="e-stars__total">{bal_kp}</div>','<div class="e-stars__progress kp"></div></div>',"</div>"].join(""),card:['<div class="e-card">','<div class="e-card__acens selector" data-area="content" data-hover-background="transparent" data-hover-noselect="true"><img class="e-card__img" src="'+s.domain_web+'/img/icons/img-load.svg" data-src="{poster}" alt=""></div>','<div class="id_{id} e-card__progress"></div>','<div class="e-card__name">{name_short}</div>',' <div class="e-card__date">{released}</div>',"</div>"].join(""),menu_item:['<div class="e-menu__item selector" data-area="menu" data-ico="{ico}" data-url="{playlist_url}">','<div class="e-menu__ico"><img src="'+s.domain_web+'/img/icons/menu/{ico}.svg" alt=""></div>','<div class="e-menu__name">{title}</div>',"</div>"].join(""),full_start:['<div class="b-start">','<div class="b-start__left layer__side"><img class="b-start__img" src="{poster}" alt=""></div>','<div class="b-start__body">','<div class="b-start__title">{name}</div>','<div class="b-start__ratings">',"</div>",'<div class="b-start__oenal">','<div class="e-line "><span class="e-line__date">{released}</span><span class="e-line__tags">{country}</span><span class="e-line__tags">{genre}</span></div>',"</div>",'<div class="b-start__tmw">','<div class="b-start__time">{duration}</div>','<div class="b-start__wathed hide"></div>',"</div>",'<div class="b-start__udica">','<div class="btn btn-action selector play" data-area="content" data-hover-background="transparent"><i>{@icon_play}</i><span>在线</span></div>','<div class="btn btn-action selector torrents" data-area="content" data-hover-background="transparent"><i>{@icon_magnet}</i><span>种子</span></div>','<div class="btn btn-action selector trailer" data-area="content" data-hover-background="transparent"><i>{@icon_wath}</i><span>预告片</span></div>','<div class="btn btn-action selector bookmark" data-area="content" data-hover-background="transparent"><i>{@icon_bookmark}</i><span>书签</span></div>',"</div>","</div>","</div>"].join(""),full_descr:['<div class="b-descr scrollbar-inner">','<div class="b-descr__text selector" data-hover-background="transparent"><div class="b-descr__title">描述</div>{about}</div>',"</div>"].join(""),full_descr_tags:['<div class="b-descr__line">','<div class="b-descr__title">{title}</div>','<div class="b-descr__tags"></div>',"</div>"].join(""),full_files:['<div class="b-files ">','<div class="layer__side b-files__left">','<div class="b-side scrollbar-inner scrollbar-invisible">','<div id="files-sort-side">',"</div>","</div>","</div>",'<div class="b-files__body scrollbar-inner">','<div id="files-list-side">',"</div>","</div>","</div>"].join(""),scroll:['<div class="scroll">','<div class="scroll__content">','<div class="scroll__body"></div>',"</div>","</div>"].join(""),full_director:['<div class="e-create  e-create--desc">','<div class="e-create__name">{name}</div>','<div class="e-create__value">{value}</div>',"</div>"].join(""),swipe_creaters:['<div class="b-swipe__item b-creaters__item">','<img class="e-name__photo" src="'+s.domain_web+'/img/icons/user.svg" alt="">','<div class="e-name selector" data-hover-noselect="true">{value}</div>',"</div>"].join(""),side_box:['<div class="b-side__box">','<div class="b-side__name">{title}</div>','<div class="b-side__list">',"</div>","</div>"].join(""),side_item:'<div class="b-side__item selector" data-area="content">{title}</div>',select:'<div class="elem-select selector">{name}</div>',file:['<div class="e-file selector" data-area="content" data-hover-background="transparent" data-hover-noselect="true">','<div class="e-file__ico"></div>','<div class="e-file__body">','<div class="e-file__name">{title}</div>','<div class="e-file__line">','<ul class="e-file__meta">','<li><img src="'+s.domain_web+'/img/icons/share-link.svg" alt=""><span><b class="m">{sid}</b></span></li>','<li><img src="'+s.domain_web+'/img/icons/save-button.svg" alt=""><span><b class="m">{pir}</b></span></li>','<li><img src="'+s.domain_web+'/img/icons/speed.svg" alt=""><span><b>{bitrate}</b></span></li>','<li><img src="'+s.domain_web+'/img/icons/calendar.svg" alt=""><span> <b>{date}</b></span></li>','<li><img src="'+s.domain_web+'/img/icons/box.svg" alt=""><span> <b>{trackerName}</b></span></li>',"</ul>",'<div class="e-file__size">{sizeName}</div>',"</div>",'<div class="e-file__content">','<ul class="e-file__details">',"<li>","<div>语音</div>","<div>{voice}</div>","</li>","<li>","<div>视频</div>","<div>{video}</div>","</li>","<li>","<div>字幕</div>","<div>{subtitle}</div>","</li>","<li>","<div>音频</div>","<div>{audio}</div>","</li>","</ul>","</div>","</div>","</div>"].join(""),file_preload:['<div class="e-file selector" data-area="content" data-hover-background="transparent" data-hover-noselect="true">',"</div>"].join(""),file_torrent:['<div class="e-file__ico"></div>','<div class="e-file__body">','<div class="e-file__name">{title}</div>','<div class="e-file__line">','<ul class="e-file__meta">','<li><img src="'+s.domain_web+'/img/icons/share-link.svg" alt=""><span><b class="m">{sid}</b></span></li>','<li><img src="'+s.domain_web+'/img/icons/save-button.svg" alt=""><span><b class="m">{pir}</b></span></li>','<li><img src="'+s.domain_web+'/img/icons/speed.svg" alt=""><span><b>{bitrate}</b></span></li>','<li><img src="'+s.domain_web+'/img/icons/calendar.svg" alt=""><span> <b>{date}</b></span></li>','<li><img src="'+s.domain_web+'/img/icons/box.svg" alt=""><span> <b>{trackerName}</b></span></li>',"</ul>",'<div class="e-file__size">{sizeName}</div>',"</div>",'<div class="e-file__content">','<ul class="e-file__details">',"<li>","<div>语音</div>","<div>{voice}</div>","</li>","<li>","<div>视频</div>","<div>{video}</div>","</li>","<li>","<div>字幕</div>","<div>{subtitle}</div>","</li>","<li>","<div>音频</div>","<div>{audio}</div>","</li>","</ul>","</div>","</div>"].join(""),file_video:['<div class="e-file selector" data-area="content" data-hover-background="transparent" data-hover-noselect="true">','<div class="e-file__ico"></div>','<div class="e-file__body">','<div class="e-file__name">{title}</div>','<div class="e-file__line">','<ul class="e-file__meta">','<li class="tp t-0">未查看</li>','<li class="tp t-1">在 3rd 方播放器中查看</li>','<li class="tp t-2">已查看 <b class="t-view">00:00:00</b> / <b class="t-percent">0%</b><span class="t-from"> из <b class="t-total"></b></span></li>','<li class="tp t-2"><div class="e-file__timeline"><div class="progress"></div></div></li>',"</ul>",'<div class="e-file__size">{quality_full}</div>',"</div>","</div>","</div>"].join(""),file_category:['<div class="b-side__name">{title}</div>'].join(""),playlist_file:['<div class="b-playlist__item selector torrent" data-format="{format}" data-id="{id}" data-hover-background="transparent" data-hover-noselect="true">','<div class="b-playlist__name">{name}</div>','<div class="b-playlist__size">{size}</div>',"</div>"].join(""),playlist_item:['<div class="b-playlist__item selector" data-hover-background="transparent" data-hover-noselect="true">','<div class="b-playlist__name">{title}</div>',"</div>"].join(""),noti_card:['<div class="b-playlist__item selector" data-hover-background="transparent" data-hover-noselect="true">','<div class="b-playlist__card_left">','<div class="b-playlist__card_img"><img src="{poster}"></div>',"</div>",'<div class="b-playlist__card_info">','<div class="b-playlist__card_head">','<div class="b-playlist__card_title">{name}</div>','<div class="b-playlist__card_time">{date}</div>',"</div>",'<div class="b-playlist__card_about">','<div class="b-playlist__card_text">',"新电视剧!","<br><br>","季 - <b>{season}</b>","<br>","剧集 - <b>{episode}</b>","</div>","</div>","</div>","</div>"].join(""),noti_info:['<div class="b-playlist__item selector" data-hover-background="transparent" data-hover-noselect="true">','<div class="b-playlist__card_info">','<div class="b-playlist__card_head">','<div class="b-playlist__card_title">{title}</div>','<div class="b-playlist__card_time">{date}</div>',"</div>",'<div class="b-playlist__card_descr">{text}</div>',"</div>","</div>"].join(""),torrent_faq:['<div class="torrent_faq">','<div class="torrent_faq_text">',"要查看种子，您需要一个应用程序 Torserve, 它允许您在线观看种子","<br><br>","您将找到有关如何安装的信息 Torserve, 扫描二维码，或在专区 <b>FAQ</b> 在网站上 <b>vokino.tv</b>","</div>",'<div class="torrent_faq_qr">','<svg width="100%" height="20em" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"  viewBox="0 0 500 500"><defs><rect id="block" width="15" height="15" fill="#000000" fill-opacity="1"/></defs><rect x="0" y="0" width="500" height="500" fill="#ffffff" fill-opacity="1"/><use x="2" y="2" xlink:href="#block"/><use x="17" y="2" xlink:href="#block"/><use x="32" y="2" xlink:href="#block"/><use x="47" y="2" xlink:href="#block"/><use x="62" y="2" xlink:href="#block"/><use x="77" y="2" xlink:href="#block"/><use x="92" y="2" xlink:href="#block"/><use x="122" y="2" xlink:href="#block"/><use x="167" y="2" xlink:href="#block"/><use x="182" y="2" xlink:href="#block"/><use x="227" y="2" xlink:href="#block"/><use x="242" y="2" xlink:href="#block"/><use x="257" y="2" xlink:href="#block"/><use x="317" y="2" xlink:href="#block"/><use x="347" y="2" xlink:href="#block"/><use x="362" y="2" xlink:href="#block"/><use x="392" y="2" xlink:href="#block"/><use x="407" y="2" xlink:href="#block"/><use x="422" y="2" xlink:href="#block"/><use x="437" y="2" xlink:href="#block"/><use x="452" y="2" xlink:href="#block"/><use x="467" y="2" xlink:href="#block"/><use x="482" y="2" xlink:href="#block"/><use x="2" y="17" xlink:href="#block"/><use x="92" y="17" xlink:href="#block"/><use x="122" y="17" xlink:href="#block"/><use x="167" y="17" xlink:href="#block"/><use x="227" y="17" xlink:href="#block"/><use x="257" y="17" xlink:href="#block"/><use x="272" y="17" xlink:href="#block"/><use x="347" y="17" xlink:href="#block"/><use x="392" y="17" xlink:href="#block"/><use x="482" y="17" xlink:href="#block"/><use x="2" y="32" xlink:href="#block"/><use x="32" y="32" xlink:href="#block"/><use x="47" y="32" xlink:href="#block"/><use x="62" y="32" xlink:href="#block"/><use x="92" y="32" xlink:href="#block"/><use x="122" y="32" xlink:href="#block"/><use x="152" y="32" xlink:href="#block"/><use x="197" y="32" xlink:href="#block"/><use x="227" y="32" xlink:href="#block"/><use x="242" y="32" xlink:href="#block"/><use x="257" y="32" xlink:href="#block"/><use x="272" y="32" xlink:href="#block"/><use x="287" y="32" xlink:href="#block"/><use x="347" y="32" xlink:href="#block"/><use x="362" y="32" xlink:href="#block"/><use x="392" y="32" xlink:href="#block"/><use x="422" y="32" xlink:href="#block"/><use x="437" y="32" xlink:href="#block"/><use x="452" y="32" xlink:href="#block"/><use x="482" y="32" xlink:href="#block"/><use x="2" y="47" xlink:href="#block"/><use x="32" y="47" xlink:href="#block"/><use x="47" y="47" xlink:href="#block"/><use x="62" y="47" xlink:href="#block"/><use x="92" y="47" xlink:href="#block"/><use x="137" y="47" xlink:href="#block"/><use x="152" y="47" xlink:href="#block"/><use x="167" y="47" xlink:href="#block"/><use x="182" y="47" xlink:href="#block"/><use x="227" y="47" xlink:href="#block"/><use x="242" y="47" xlink:href="#block"/><use x="257" y="47" xlink:href="#block"/><use x="287" y="47" xlink:href="#block"/><use x="332" y="47" xlink:href="#block"/><use x="362" y="47" xlink:href="#block"/><use x="392" y="47" xlink:href="#block"/><use x="422" y="47" xlink:href="#block"/><use x="437" y="47" xlink:href="#block"/><use x="452" y="47" xlink:href="#block"/><use x="482" y="47" xlink:href="#block"/><use x="2" y="62" xlink:href="#block"/><use x="32" y="62" xlink:href="#block"/><use x="47" y="62" xlink:href="#block"/><use x="62" y="62" xlink:href="#block"/><use x="92" y="62" xlink:href="#block"/><use x="152" y="62" xlink:href="#block"/><use x="167" y="62" xlink:href="#block"/><use x="182" y="62" xlink:href="#block"/><use x="197" y="62" xlink:href="#block"/><use x="227" y="62" xlink:href="#block"/><use x="242" y="62" xlink:href="#block"/><use x="287" y="62" xlink:href="#block"/><use x="302" y="62" xlink:href="#block"/><use x="317" y="62" xlink:href="#block"/><use x="347" y="62" xlink:href="#block"/><use x="392" y="62" xlink:href="#block"/><use x="422" y="62" xlink:href="#block"/><use x="437" y="62" xlink:href="#block"/><use x="452" y="62" xlink:href="#block"/><use x="482" y="62" xlink:href="#block"/><use x="2" y="77" xlink:href="#block"/><use x="92" y="77" xlink:href="#block"/><use x="122" y="77" xlink:href="#block"/><use x="137" y="77" xlink:href="#block"/><use x="152" y="77" xlink:href="#block"/><use x="182" y="77" xlink:href="#block"/><use x="197" y="77" xlink:href="#block"/><use x="257" y="77" xlink:href="#block"/><use x="272" y="77" xlink:href="#block"/><use x="302" y="77" xlink:href="#block"/><use x="332" y="77" xlink:href="#block"/><use x="392" y="77" xlink:href="#block"/><use x="482" y="77" xlink:href="#block"/><use x="2" y="92" xlink:href="#block"/><use x="17" y="92" xlink:href="#block"/><use x="32" y="92" xlink:href="#block"/><use x="47" y="92" xlink:href="#block"/><use x="62" y="92" xlink:href="#block"/><use x="77" y="92" xlink:href="#block"/><use x="92" y="92" xlink:href="#block"/><use x="122" y="92" xlink:href="#block"/><use x="152" y="92" xlink:href="#block"/><use x="182" y="92" xlink:href="#block"/><use x="212" y="92" xlink:href="#block"/><use x="242" y="92" xlink:href="#block"/><use x="272" y="92" xlink:href="#block"/><use x="302" y="92" xlink:href="#block"/><use x="332" y="92" xlink:href="#block"/><use x="362" y="92" xlink:href="#block"/><use x="392" y="92" xlink:href="#block"/><use x="407" y="92" xlink:href="#block"/><use x="422" y="92" xlink:href="#block"/><use x="437" y="92" xlink:href="#block"/><use x="452" y="92" xlink:href="#block"/><use x="467" y="92" xlink:href="#block"/><use x="482" y="92" xlink:href="#block"/><use x="122" y="107" xlink:href="#block"/><use x="167" y="107" xlink:href="#block"/><use x="197" y="107" xlink:href="#block"/><use x="227" y="107" xlink:href="#block"/><use x="272" y="107" xlink:href="#block"/><use x="302" y="107" xlink:href="#block"/><use x="317" y="107" xlink:href="#block"/><use x="347" y="107" xlink:href="#block"/><use x="362" y="107" xlink:href="#block"/><use x="32" y="122" xlink:href="#block"/><use x="47" y="122" xlink:href="#block"/><use x="62" y="122" xlink:href="#block"/><use x="92" y="122" xlink:href="#block"/><use x="122" y="122" xlink:href="#block"/><use x="137" y="122" xlink:href="#block"/><use x="212" y="122" xlink:href="#block"/><use x="317" y="122" xlink:href="#block"/><use x="362" y="122" xlink:href="#block"/><use x="377" y="122" xlink:href="#block"/><use x="392" y="122" xlink:href="#block"/><use x="407" y="122" xlink:href="#block"/><use x="452" y="122" xlink:href="#block"/><use x="467" y="122" xlink:href="#block"/><use x="482" y="122" xlink:href="#block"/><use x="2" y="137" xlink:href="#block"/><use x="17" y="137" xlink:href="#block"/><use x="107" y="137" xlink:href="#block"/><use x="152" y="137" xlink:href="#block"/><use x="182" y="137" xlink:href="#block"/><use x="227" y="137" xlink:href="#block"/><use x="242" y="137" xlink:href="#block"/><use x="257" y="137" xlink:href="#block"/><use x="287" y="137" xlink:href="#block"/><use x="317" y="137" xlink:href="#block"/><use x="332" y="137" xlink:href="#block"/><use x="347" y="137" xlink:href="#block"/><use x="452" y="137" xlink:href="#block"/><use x="482" y="137" xlink:href="#block"/><use x="2" y="152" xlink:href="#block"/><use x="17" y="152" xlink:href="#block"/><use x="32" y="152" xlink:href="#block"/><use x="47" y="152" xlink:href="#block"/><use x="62" y="152" xlink:href="#block"/><use x="77" y="152" xlink:href="#block"/><use x="92" y="152" xlink:href="#block"/><use x="122" y="152" xlink:href="#block"/><use x="167" y="152" xlink:href="#block"/><use x="182" y="152" xlink:href="#block"/><use x="197" y="152" xlink:href="#block"/><use x="212" y="152" xlink:href="#block"/><use x="227" y="152" xlink:href="#block"/><use x="287" y="152" xlink:href="#block"/><use x="317" y="152" xlink:href="#block"/><use x="362" y="152" xlink:href="#block"/><use x="377" y="152" xlink:href="#block"/><use x="422" y="152" xlink:href="#block"/><use x="467" y="152" xlink:href="#block"/><use x="17" y="167" xlink:href="#block"/><use x="32" y="167" xlink:href="#block"/><use x="77" y="167" xlink:href="#block"/><use x="107" y="167" xlink:href="#block"/><use x="122" y="167" xlink:href="#block"/><use x="152" y="167" xlink:href="#block"/><use x="212" y="167" xlink:href="#block"/><use x="227" y="167" xlink:href="#block"/><use x="242" y="167" xlink:href="#block"/><use x="272" y="167" xlink:href="#block"/><use x="317" y="167" xlink:href="#block"/><use x="347" y="167" xlink:href="#block"/><use x="392" y="167" xlink:href="#block"/><use x="437" y="167" xlink:href="#block"/><use x="467" y="167" xlink:href="#block"/><use x="482" y="167" xlink:href="#block"/><use x="62" y="182" xlink:href="#block"/><use x="92" y="182" xlink:href="#block"/><use x="107" y="182" xlink:href="#block"/><use x="137" y="182" xlink:href="#block"/><use x="167" y="182" xlink:href="#block"/><use x="197" y="182" xlink:href="#block"/><use x="212" y="182" xlink:href="#block"/><use x="257" y="182" xlink:href="#block"/><use x="272" y="182" xlink:href="#block"/><use x="302" y="182" xlink:href="#block"/><use x="317" y="182" xlink:href="#block"/><use x="392" y="182" xlink:href="#block"/><use x="407" y="182" xlink:href="#block"/><use x="437" y="182" xlink:href="#block"/><use x="467" y="182" xlink:href="#block"/><use x="17" y="197" xlink:href="#block"/><use x="152" y="197" xlink:href="#block"/><use x="182" y="197" xlink:href="#block"/><use x="197" y="197" xlink:href="#block"/><use x="212" y="197" xlink:href="#block"/><use x="227" y="197" xlink:href="#block"/><use x="242" y="197" xlink:href="#block"/><use x="272" y="197" xlink:href="#block"/><use x="317" y="197" xlink:href="#block"/><use x="347" y="197" xlink:href="#block"/><use x="377" y="197" xlink:href="#block"/><use x="437" y="197" xlink:href="#block"/><use x="452" y="197" xlink:href="#block"/><use x="17" y="212" xlink:href="#block"/><use x="32" y="212" xlink:href="#block"/><use x="92" y="212" xlink:href="#block"/><use x="107" y="212" xlink:href="#block"/><use x="122" y="212" xlink:href="#block"/><use x="167" y="212" xlink:href="#block"/><use x="182" y="212" xlink:href="#block"/><use x="197" y="212" xlink:href="#block"/><use x="227" y="212" xlink:href="#block"/><use x="242" y="212" xlink:href="#block"/><use x="257" y="212" xlink:href="#block"/><use x="272" y="212" xlink:href="#block"/><use x="287" y="212" xlink:href="#block"/><use x="302" y="212" xlink:href="#block"/><use x="347" y="212" xlink:href="#block"/><use x="362" y="212" xlink:href="#block"/><use x="377" y="212" xlink:href="#block"/><use x="407" y="212" xlink:href="#block"/><use x="422" y="212" xlink:href="#block"/><use x="467" y="212" xlink:href="#block"/><use x="2" y="227" xlink:href="#block"/><use x="17" y="227" xlink:href="#block"/><use x="212" y="227" xlink:href="#block"/><use x="272" y="227" xlink:href="#block"/><use x="287" y="227" xlink:href="#block"/><use x="347" y="227" xlink:href="#block"/><use x="377" y="227" xlink:href="#block"/><use x="392" y="227" xlink:href="#block"/><use x="452" y="227" xlink:href="#block"/><use x="482" y="227" xlink:href="#block"/><use x="17" y="242" xlink:href="#block"/><use x="47" y="242" xlink:href="#block"/><use x="62" y="242" xlink:href="#block"/><use x="77" y="242" xlink:href="#block"/><use x="92" y="242" xlink:href="#block"/><use x="122" y="242" xlink:href="#block"/><use x="137" y="242" xlink:href="#block"/><use x="167" y="242" xlink:href="#block"/><use x="182" y="242" xlink:href="#block"/><use x="227" y="242" xlink:href="#block"/><use x="242" y="242" xlink:href="#block"/><use x="302" y="242" xlink:href="#block"/><use x="332" y="242" xlink:href="#block"/><use x="362" y="242" xlink:href="#block"/><use x="482" y="242" xlink:href="#block"/><use x="2" y="257" xlink:href="#block"/><use x="17" y="257" xlink:href="#block"/><use x="62" y="257" xlink:href="#block"/><use x="77" y="257" xlink:href="#block"/><use x="122" y="257" xlink:href="#block"/><use x="137" y="257" xlink:href="#block"/><use x="167" y="257" xlink:href="#block"/><use x="272" y="257" xlink:href="#block"/><use x="287" y="257" xlink:href="#block"/><use x="302" y="257" xlink:href="#block"/><use x="317" y="257" xlink:href="#block"/><use x="332" y="257" xlink:href="#block"/><use x="362" y="257" xlink:href="#block"/><use x="377" y="257" xlink:href="#block"/><use x="407" y="257" xlink:href="#block"/><use x="452" y="257" xlink:href="#block"/><use x="467" y="257" xlink:href="#block"/><use x="482" y="257" xlink:href="#block"/><use x="32" y="272" xlink:href="#block"/><use x="47" y="272" xlink:href="#block"/><use x="92" y="272" xlink:href="#block"/><use x="152" y="272" xlink:href="#block"/><use x="167" y="272" xlink:href="#block"/><use x="197" y="272" xlink:href="#block"/><use x="212" y="272" xlink:href="#block"/><use x="332" y="272" xlink:href="#block"/><use x="377" y="272" xlink:href="#block"/><use x="407" y="272" xlink:href="#block"/><use x="422" y="272" xlink:href="#block"/><use x="437" y="272" xlink:href="#block"/><use x="452" y="272" xlink:href="#block"/><use x="467" y="272" xlink:href="#block"/><use x="482" y="272" xlink:href="#block"/><use x="17" y="287" xlink:href="#block"/><use x="32" y="287" xlink:href="#block"/><use x="47" y="287" xlink:href="#block"/><use x="62" y="287" xlink:href="#block"/><use x="107" y="287" xlink:href="#block"/><use x="122" y="287" xlink:href="#block"/><use x="167" y="287" xlink:href="#block"/><use x="212" y="287" xlink:href="#block"/><use x="242" y="287" xlink:href="#block"/><use x="287" y="287" xlink:href="#block"/><use x="302" y="287" xlink:href="#block"/><use x="317" y="287" xlink:href="#block"/><use x="332" y="287" xlink:href="#block"/><use x="347" y="287" xlink:href="#block"/><use x="377" y="287" xlink:href="#block"/><use x="392" y="287" xlink:href="#block"/><use x="437" y="287" xlink:href="#block"/><use x="467" y="287" xlink:href="#block"/><use x="2" y="302" xlink:href="#block"/><use x="17" y="302" xlink:href="#block"/><use x="32" y="302" xlink:href="#block"/><use x="77" y="302" xlink:href="#block"/><use x="92" y="302" xlink:href="#block"/><use x="182" y="302" xlink:href="#block"/><use x="272" y="302" xlink:href="#block"/><use x="317" y="302" xlink:href="#block"/><use x="332" y="302" xlink:href="#block"/><use x="392" y="302" xlink:href="#block"/><use x="422" y="302" xlink:href="#block"/><use x="437" y="302" xlink:href="#block"/><use x="467" y="302" xlink:href="#block"/><use x="2" y="317" xlink:href="#block"/><use x="32" y="317" xlink:href="#block"/><use x="47" y="317" xlink:href="#block"/><use x="77" y="317" xlink:href="#block"/><use x="107" y="317" xlink:href="#block"/><use x="167" y="317" xlink:href="#block"/><use x="182" y="317" xlink:href="#block"/><use x="197" y="317" xlink:href="#block"/><use x="212" y="317" xlink:href="#block"/><use x="227" y="317" xlink:href="#block"/><use x="287" y="317" xlink:href="#block"/><use x="317" y="317" xlink:href="#block"/><use x="347" y="317" xlink:href="#block"/><use x="377" y="317" xlink:href="#block"/><use x="407" y="317" xlink:href="#block"/><use x="422" y="317" xlink:href="#block"/><use x="437" y="317" xlink:href="#block"/><use x="452" y="317" xlink:href="#block"/><use x="482" y="317" xlink:href="#block"/><use x="2" y="332" xlink:href="#block"/><use x="62" y="332" xlink:href="#block"/><use x="77" y="332" xlink:href="#block"/><use x="92" y="332" xlink:href="#block"/><use x="107" y="332" xlink:href="#block"/><use x="122" y="332" xlink:href="#block"/><use x="152" y="332" xlink:href="#block"/><use x="167" y="332" xlink:href="#block"/><use x="257" y="332" xlink:href="#block"/><use x="272" y="332" xlink:href="#block"/><use x="287" y="332" xlink:href="#block"/><use x="302" y="332" xlink:href="#block"/><use x="332" y="332" xlink:href="#block"/><use x="347" y="332" xlink:href="#block"/><use x="377" y="332" xlink:href="#block"/><use x="407" y="332" xlink:href="#block"/><use x="422" y="332" xlink:href="#block"/><use x="467" y="332" xlink:href="#block"/><use x="2" y="347" xlink:href="#block"/><use x="122" y="347" xlink:href="#block"/><use x="182" y="347" xlink:href="#block"/><use x="227" y="347" xlink:href="#block"/><use x="242" y="347" xlink:href="#block"/><use x="257" y="347" xlink:href="#block"/><use x="287" y="347" xlink:href="#block"/><use x="317" y="347" xlink:href="#block"/><use x="332" y="347" xlink:href="#block"/><use x="377" y="347" xlink:href="#block"/><use x="392" y="347" xlink:href="#block"/><use x="437" y="347" xlink:href="#block"/><use x="467" y="347" xlink:href="#block"/><use x="482" y="347" xlink:href="#block"/><use x="2" y="362" xlink:href="#block"/><use x="32" y="362" xlink:href="#block"/><use x="47" y="362" xlink:href="#block"/><use x="92" y="362" xlink:href="#block"/><use x="137" y="362" xlink:href="#block"/><use x="167" y="362" xlink:href="#block"/><use x="227" y="362" xlink:href="#block"/><use x="272" y="362" xlink:href="#block"/><use x="317" y="362" xlink:href="#block"/><use x="362" y="362" xlink:href="#block"/><use x="377" y="362" xlink:href="#block"/><use x="392" y="362" xlink:href="#block"/><use x="407" y="362" xlink:href="#block"/><use x="422" y="362" xlink:href="#block"/><use x="437" y="362" xlink:href="#block"/><use x="467" y="362" xlink:href="#block"/><use x="122" y="377" xlink:href="#block"/><use x="137" y="377" xlink:href="#block"/><use x="152" y="377" xlink:href="#block"/><use x="167" y="377" xlink:href="#block"/><use x="182" y="377" xlink:href="#block"/><use x="197" y="377" xlink:href="#block"/><use x="212" y="377" xlink:href="#block"/><use x="257" y="377" xlink:href="#block"/><use x="302" y="377" xlink:href="#block"/><use x="332" y="377" xlink:href="#block"/><use x="347" y="377" xlink:href="#block"/><use x="362" y="377" xlink:href="#block"/><use x="422" y="377" xlink:href="#block"/><use x="437" y="377" xlink:href="#block"/><use x="452" y="377" xlink:href="#block"/><use x="467" y="377" xlink:href="#block"/><use x="482" y="377" xlink:href="#block"/><use x="2" y="392" xlink:href="#block"/><use x="17" y="392" xlink:href="#block"/><use x="32" y="392" xlink:href="#block"/><use x="47" y="392" xlink:href="#block"/><use x="62" y="392" xlink:href="#block"/><use x="77" y="392" xlink:href="#block"/><use x="92" y="392" xlink:href="#block"/><use x="137" y="392" xlink:href="#block"/><use x="197" y="392" xlink:href="#block"/><use x="212" y="392" xlink:href="#block"/><use x="242" y="392" xlink:href="#block"/><use x="272" y="392" xlink:href="#block"/><use x="287" y="392" xlink:href="#block"/><use x="302" y="392" xlink:href="#block"/><use x="332" y="392" xlink:href="#block"/><use x="347" y="392" xlink:href="#block"/><use x="362" y="392" xlink:href="#block"/><use x="392" y="392" xlink:href="#block"/><use x="422" y="392" xlink:href="#block"/><use x="467" y="392" xlink:href="#block"/><use x="482" y="392" xlink:href="#block"/><use x="2" y="407" xlink:href="#block"/><use x="92" y="407" xlink:href="#block"/><use x="182" y="407" xlink:href="#block"/><use x="212" y="407" xlink:href="#block"/><use x="227" y="407" xlink:href="#block"/><use x="242" y="407" xlink:href="#block"/><use x="257" y="407" xlink:href="#block"/><use x="362" y="407" xlink:href="#block"/><use x="422" y="407" xlink:href="#block"/><use x="437" y="407" xlink:href="#block"/><use x="452" y="407" xlink:href="#block"/><use x="482" y="407" xlink:href="#block"/><use x="2" y="422" xlink:href="#block"/><use x="32" y="422" xlink:href="#block"/><use x="47" y="422" xlink:href="#block"/><use x="62" y="422" xlink:href="#block"/><use x="92" y="422" xlink:href="#block"/><use x="122" y="422" xlink:href="#block"/><use x="197" y="422" xlink:href="#block"/><use x="212" y="422" xlink:href="#block"/><use x="227" y="422" xlink:href="#block"/><use x="257" y="422" xlink:href="#block"/><use x="317" y="422" xlink:href="#block"/><use x="332" y="422" xlink:href="#block"/><use x="362" y="422" xlink:href="#block"/><use x="377" y="422" xlink:href="#block"/><use x="392" y="422" xlink:href="#block"/><use x="407" y="422" xlink:href="#block"/><use x="422" y="422" xlink:href="#block"/><use x="2" y="437" xlink:href="#block"/><use x="32" y="437" xlink:href="#block"/><use x="47" y="437" xlink:href="#block"/><use x="62" y="437" xlink:href="#block"/><use x="92" y="437" xlink:href="#block"/><use x="122" y="437" xlink:href="#block"/><use x="137" y="437" xlink:href="#block"/><use x="242" y="437" xlink:href="#block"/><use x="377" y="437" xlink:href="#block"/><use x="407" y="437" xlink:href="#block"/><use x="437" y="437" xlink:href="#block"/><use x="452" y="437" xlink:href="#block"/><use x="467" y="437" xlink:href="#block"/><use x="2" y="452" xlink:href="#block"/><use x="32" y="452" xlink:href="#block"/><use x="47" y="452" xlink:href="#block"/><use x="62" y="452" xlink:href="#block"/><use x="92" y="452" xlink:href="#block"/><use x="122" y="452" xlink:href="#block"/><use x="137" y="452" xlink:href="#block"/><use x="167" y="452" xlink:href="#block"/><use x="182" y="452" xlink:href="#block"/><use x="197" y="452" xlink:href="#block"/><use x="212" y="452" xlink:href="#block"/><use x="287" y="452" xlink:href="#block"/><use x="302" y="452" xlink:href="#block"/><use x="332" y="452" xlink:href="#block"/><use x="362" y="452" xlink:href="#block"/><use x="407" y="452" xlink:href="#block"/><use x="422" y="452" xlink:href="#block"/><use x="2" y="467" xlink:href="#block"/><use x="92" y="467" xlink:href="#block"/><use x="137" y="467" xlink:href="#block"/><use x="152" y="467" xlink:href="#block"/><use x="167" y="467" xlink:href="#block"/><use x="182" y="467" xlink:href="#block"/><use x="197" y="467" xlink:href="#block"/><use x="212" y="467" xlink:href="#block"/><use x="227" y="467" xlink:href="#block"/><use x="242" y="467" xlink:href="#block"/><use x="257" y="467" xlink:href="#block"/><use x="287" y="467" xlink:href="#block"/><use x="332" y="467" xlink:href="#block"/><use x="377" y="467" xlink:href="#block"/><use x="407" y="467" xlink:href="#block"/><use x="422" y="467" xlink:href="#block"/><use x="437" y="467" xlink:href="#block"/><use x="467" y="467" xlink:href="#block"/><use x="482" y="467" xlink:href="#block"/><use x="2" y="482" xlink:href="#block"/><use x="17" y="482" xlink:href="#block"/><use x="32" y="482" xlink:href="#block"/><use x="47" y="482" xlink:href="#block"/><use x="62" y="482" xlink:href="#block"/><use x="77" y="482" xlink:href="#block"/><use x="92" y="482" xlink:href="#block"/><use x="137" y="482" xlink:href="#block"/><use x="182" y="482" xlink:href="#block"/><use x="197" y="482" xlink:href="#block"/><use x="257" y="482" xlink:href="#block"/><use x="272" y="482" xlink:href="#block"/><use x="287" y="482" xlink:href="#block"/><use x="302" y="482" xlink:href="#block"/><use x="317" y="482" xlink:href="#block"/><use x="347" y="482" xlink:href="#block"/><use x="392" y="482" xlink:href="#block"/><use x="437" y="482" xlink:href="#block"/><use x="467" y="482" xlink:href="#block"/></svg>',"</div>","</div>"].join(""),noauth_faq:['<div class="torrent_faq">','<div class="torrent_faq_text">',"要查看内容，您必须注册或登录。这可以通过单击应用程序顶部面板或您的帐户中的圆圈图标来完成 <b>vokino.tv</b>","<br><br>","您可以找到更多信息通过扫描二维码，或在板块 <b>FAQ</b> 在线 <b>vokino.tv</b>","</div>",'<div class="torrent_faq_qr">','<svg width="100%" height="20em" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="500px" height="500px" viewBox="0 0 500 500"><defs><rect id="block" width="17" height="17" fill="#000000" fill-opacity="1"/></defs><rect x="0" y="0" width="500" height="500" fill="#ffffff" fill-opacity="1"/><use x="3" y="3" xlink:href="#block"/><use x="20" y="3" xlink:href="#block"/><use x="37" y="3" xlink:href="#block"/><use x="54" y="3" xlink:href="#block"/><use x="71" y="3" xlink:href="#block"/><use x="88" y="3" xlink:href="#block"/><use x="105" y="3" xlink:href="#block"/><use x="139" y="3" xlink:href="#block"/><use x="190" y="3" xlink:href="#block"/><use x="207" y="3" xlink:href="#block"/><use x="258" y="3" xlink:href="#block"/><use x="309" y="3" xlink:href="#block"/><use x="377" y="3" xlink:href="#block"/><use x="394" y="3" xlink:href="#block"/><use x="411" y="3" xlink:href="#block"/><use x="428" y="3" xlink:href="#block"/><use x="445" y="3" xlink:href="#block"/><use x="462" y="3" xlink:href="#block"/><use x="479" y="3" xlink:href="#block"/><use x="3" y="20" xlink:href="#block"/><use x="105" y="20" xlink:href="#block"/><use x="156" y="20" xlink:href="#block"/><use x="173" y="20" xlink:href="#block"/><use x="190" y="20" xlink:href="#block"/><use x="207" y="20" xlink:href="#block"/><use x="224" y="20" xlink:href="#block"/><use x="309" y="20" xlink:href="#block"/><use x="377" y="20" xlink:href="#block"/><use x="479" y="20" xlink:href="#block"/><use x="3" y="37" xlink:href="#block"/><use x="37" y="37" xlink:href="#block"/><use x="54" y="37" xlink:href="#block"/><use x="71" y="37" xlink:href="#block"/><use x="105" y="37" xlink:href="#block"/><use x="207" y="37" xlink:href="#block"/><use x="241" y="37" xlink:href="#block"/><use x="258" y="37" xlink:href="#block"/><use x="275" y="37" xlink:href="#block"/><use x="292" y="37" xlink:href="#block"/><use x="309" y="37" xlink:href="#block"/><use x="326" y="37" xlink:href="#block"/><use x="377" y="37" xlink:href="#block"/><use x="411" y="37" xlink:href="#block"/><use x="428" y="37" xlink:href="#block"/><use x="445" y="37" xlink:href="#block"/><use x="479" y="37" xlink:href="#block"/><use x="3" y="54" xlink:href="#block"/><use x="37" y="54" xlink:href="#block"/><use x="54" y="54" xlink:href="#block"/><use x="71" y="54" xlink:href="#block"/><use x="105" y="54" xlink:href="#block"/><use x="139" y="54" xlink:href="#block"/><use x="156" y="54" xlink:href="#block"/><use x="190" y="54" xlink:href="#block"/><use x="207" y="54" xlink:href="#block"/><use x="258" y="54" xlink:href="#block"/><use x="275" y="54" xlink:href="#block"/><use x="343" y="54" xlink:href="#block"/><use x="377" y="54" xlink:href="#block"/><use x="411" y="54" xlink:href="#block"/><use x="428" y="54" xlink:href="#block"/><use x="445" y="54" xlink:href="#block"/><use x="479" y="54" xlink:href="#block"/><use x="3" y="71" xlink:href="#block"/><use x="37" y="71" xlink:href="#block"/><use x="54" y="71" xlink:href="#block"/><use x="71" y="71" xlink:href="#block"/><use x="105" y="71" xlink:href="#block"/><use x="156" y="71" xlink:href="#block"/><use x="190" y="71" xlink:href="#block"/><use x="207" y="71" xlink:href="#block"/><use x="241" y="71" xlink:href="#block"/><use x="275" y="71" xlink:href="#block"/><use x="326" y="71" xlink:href="#block"/><use x="377" y="71" xlink:href="#block"/><use x="411" y="71" xlink:href="#block"/><use x="428" y="71" xlink:href="#block"/><use x="445" y="71" xlink:href="#block"/><use x="479" y="71" xlink:href="#block"/><use x="3" y="88" xlink:href="#block"/><use x="105" y="88" xlink:href="#block"/><use x="207" y="88" xlink:href="#block"/><use x="241" y="88" xlink:href="#block"/><use x="275" y="88" xlink:href="#block"/><use x="292" y="88" xlink:href="#block"/><use x="377" y="88" xlink:href="#block"/><use x="479" y="88" xlink:href="#block"/><use x="3" y="105" xlink:href="#block"/><use x="20" y="105" xlink:href="#block"/><use x="37" y="105" xlink:href="#block"/><use x="54" y="105" xlink:href="#block"/><use x="71" y="105" xlink:href="#block"/><use x="88" y="105" xlink:href="#block"/><use x="105" y="105" xlink:href="#block"/><use x="139" y="105" xlink:href="#block"/><use x="173" y="105" xlink:href="#block"/><use x="207" y="105" xlink:href="#block"/><use x="241" y="105" xlink:href="#block"/><use x="275" y="105" xlink:href="#block"/><use x="309" y="105" xlink:href="#block"/><use x="343" y="105" xlink:href="#block"/><use x="377" y="105" xlink:href="#block"/><use x="394" y="105" xlink:href="#block"/><use x="411" y="105" xlink:href="#block"/><use x="428" y="105" xlink:href="#block"/><use x="445" y="105" xlink:href="#block"/><use x="462" y="105" xlink:href="#block"/><use x="479" y="105" xlink:href="#block"/><use x="156" y="122" xlink:href="#block"/><use x="173" y="122" xlink:href="#block"/><use x="207" y="122" xlink:href="#block"/><use x="224" y="122" xlink:href="#block"/><use x="241" y="122" xlink:href="#block"/><use x="258" y="122" xlink:href="#block"/><use x="292" y="122" xlink:href="#block"/><use x="309" y="122" xlink:href="#block"/><use x="343" y="122" xlink:href="#block"/><use x="37" y="139" xlink:href="#block"/><use x="71" y="139" xlink:href="#block"/><use x="88" y="139" xlink:href="#block"/><use x="105" y="139" xlink:href="#block"/><use x="139" y="139" xlink:href="#block"/><use x="173" y="139" xlink:href="#block"/><use x="241" y="139" xlink:href="#block"/><use x="258" y="139" xlink:href="#block"/><use x="275" y="139" xlink:href="#block"/><use x="309" y="139" xlink:href="#block"/><use x="343" y="139" xlink:href="#block"/><use x="360" y="139" xlink:href="#block"/><use x="428" y="139" xlink:href="#block"/><use x="479" y="139" xlink:href="#block"/><use x="3" y="156" xlink:href="#block"/><use x="20" y="156" xlink:href="#block"/><use x="37" y="156" xlink:href="#block"/><use x="54" y="156" xlink:href="#block"/><use x="139" y="156" xlink:href="#block"/><use x="156" y="156" xlink:href="#block"/><use x="190" y="156" xlink:href="#block"/><use x="207" y="156" xlink:href="#block"/><use x="224" y="156" xlink:href="#block"/><use x="258" y="156" xlink:href="#block"/><use x="275" y="156" xlink:href="#block"/><use x="292" y="156" xlink:href="#block"/><use x="309" y="156" xlink:href="#block"/><use x="326" y="156" xlink:href="#block"/><use x="377" y="156" xlink:href="#block"/><use x="411" y="156" xlink:href="#block"/><use x="462" y="156" xlink:href="#block"/><use x="37" y="173" xlink:href="#block"/><use x="71" y="173" xlink:href="#block"/><use x="105" y="173" xlink:href="#block"/><use x="122" y="173" xlink:href="#block"/><use x="190" y="173" xlink:href="#block"/><use x="258" y="173" xlink:href="#block"/><use x="292" y="173" xlink:href="#block"/><use x="309" y="173" xlink:href="#block"/><use x="343" y="173" xlink:href="#block"/><use x="377" y="173" xlink:href="#block"/><use x="462" y="173" xlink:href="#block"/><use x="479" y="173" xlink:href="#block"/><use x="20" y="190" xlink:href="#block"/><use x="37" y="190" xlink:href="#block"/><use x="71" y="190" xlink:href="#block"/><use x="156" y="190" xlink:href="#block"/><use x="173" y="190" xlink:href="#block"/><use x="258" y="190" xlink:href="#block"/><use x="275" y="190" xlink:href="#block"/><use x="292" y="190" xlink:href="#block"/><use x="309" y="190" xlink:href="#block"/><use x="326" y="190" xlink:href="#block"/><use x="377" y="190" xlink:href="#block"/><use x="394" y="190" xlink:href="#block"/><use x="445" y="190" xlink:href="#block"/><use x="54" y="207" xlink:href="#block"/><use x="71" y="207" xlink:href="#block"/><use x="105" y="207" xlink:href="#block"/><use x="207" y="207" xlink:href="#block"/><use x="241" y="207" xlink:href="#block"/><use x="258" y="207" xlink:href="#block"/><use x="292" y="207" xlink:href="#block"/><use x="309" y="207" xlink:href="#block"/><use x="343" y="207" xlink:href="#block"/><use x="411" y="207" xlink:href="#block"/><use x="428" y="207" xlink:href="#block"/><use x="479" y="207" xlink:href="#block"/><use x="20" y="224" xlink:href="#block"/><use x="88" y="224" xlink:href="#block"/><use x="173" y="224" xlink:href="#block"/><use x="190" y="224" xlink:href="#block"/><use x="207" y="224" xlink:href="#block"/><use x="224" y="224" xlink:href="#block"/><use x="292" y="224" xlink:href="#block"/><use x="343" y="224" xlink:href="#block"/><use x="360" y="224" xlink:href="#block"/><use x="377" y="224" xlink:href="#block"/><use x="394" y="224" xlink:href="#block"/><use x="462" y="224" xlink:href="#block"/><use x="479" y="224" xlink:href="#block"/><use x="3" y="241" xlink:href="#block"/><use x="88" y="241" xlink:href="#block"/><use x="105" y="241" xlink:href="#block"/><use x="139" y="241" xlink:href="#block"/><use x="173" y="241" xlink:href="#block"/><use x="207" y="241" xlink:href="#block"/><use x="241" y="241" xlink:href="#block"/><use x="258" y="241" xlink:href="#block"/><use x="275" y="241" xlink:href="#block"/><use x="292" y="241" xlink:href="#block"/><use x="360" y="241" xlink:href="#block"/><use x="377" y="241" xlink:href="#block"/><use x="394" y="241" xlink:href="#block"/><use x="462" y="241" xlink:href="#block"/><use x="3" y="258" xlink:href="#block"/><use x="54" y="258" xlink:href="#block"/><use x="71" y="258" xlink:href="#block"/><use x="122" y="258" xlink:href="#block"/><use x="139" y="258" xlink:href="#block"/><use x="173" y="258" xlink:href="#block"/><use x="207" y="258" xlink:href="#block"/><use x="241" y="258" xlink:href="#block"/><use x="258" y="258" xlink:href="#block"/><use x="275" y="258" xlink:href="#block"/><use x="292" y="258" xlink:href="#block"/><use x="309" y="258" xlink:href="#block"/><use x="343" y="258" xlink:href="#block"/><use x="360" y="258" xlink:href="#block"/><use x="377" y="258" xlink:href="#block"/><use x="428" y="258" xlink:href="#block"/><use x="445" y="258" xlink:href="#block"/><use x="462" y="258" xlink:href="#block"/><use x="479" y="258" xlink:href="#block"/><use x="20" y="275" xlink:href="#block"/><use x="54" y="275" xlink:href="#block"/><use x="105" y="275" xlink:href="#block"/><use x="173" y="275" xlink:href="#block"/><use x="190" y="275" xlink:href="#block"/><use x="207" y="275" xlink:href="#block"/><use x="241" y="275" xlink:href="#block"/><use x="258" y="275" xlink:href="#block"/><use x="275" y="275" xlink:href="#block"/><use x="292" y="275" xlink:href="#block"/><use x="309" y="275" xlink:href="#block"/><use x="360" y="275" xlink:href="#block"/><use x="377" y="275" xlink:href="#block"/><use x="445" y="275" xlink:href="#block"/><use x="462" y="275" xlink:href="#block"/><use x="479" y="275" xlink:href="#block"/><use x="37" y="292" xlink:href="#block"/><use x="88" y="292" xlink:href="#block"/><use x="139" y="292" xlink:href="#block"/><use x="156" y="292" xlink:href="#block"/><use x="173" y="292" xlink:href="#block"/><use x="258" y="292" xlink:href="#block"/><use x="292" y="292" xlink:href="#block"/><use x="326" y="292" xlink:href="#block"/><use x="360" y="292" xlink:href="#block"/><use x="377" y="292" xlink:href="#block"/><use x="428" y="292" xlink:href="#block"/><use x="462" y="292" xlink:href="#block"/><use x="3" y="309" xlink:href="#block"/><use x="37" y="309" xlink:href="#block"/><use x="54" y="309" xlink:href="#block"/><use x="71" y="309" xlink:href="#block"/><use x="88" y="309" xlink:href="#block"/><use x="105" y="309" xlink:href="#block"/><use x="156" y="309" xlink:href="#block"/><use x="173" y="309" xlink:href="#block"/><use x="190" y="309" xlink:href="#block"/><use x="224" y="309" xlink:href="#block"/><use x="241" y="309" xlink:href="#block"/><use x="275" y="309" xlink:href="#block"/><use x="309" y="309" xlink:href="#block"/><use x="377" y="309" xlink:href="#block"/><use x="394" y="309" xlink:href="#block"/><use x="462" y="309" xlink:href="#block"/><use x="479" y="309" xlink:href="#block"/><use x="20" y="326" xlink:href="#block"/><use x="37" y="326" xlink:href="#block"/><use x="54" y="326" xlink:href="#block"/><use x="71" y="326" xlink:href="#block"/><use x="122" y="326" xlink:href="#block"/><use x="173" y="326" xlink:href="#block"/><use x="292" y="326" xlink:href="#block"/><use x="309" y="326" xlink:href="#block"/><use x="343" y="326" xlink:href="#block"/><use x="360" y="326" xlink:href="#block"/><use x="377" y="326" xlink:href="#block"/><use x="445" y="326" xlink:href="#block"/><use x="462" y="326" xlink:href="#block"/><use x="479" y="326" xlink:href="#block"/><use x="3" y="343" xlink:href="#block"/><use x="37" y="343" xlink:href="#block"/><use x="54" y="343" xlink:href="#block"/><use x="88" y="343" xlink:href="#block"/><use x="105" y="343" xlink:href="#block"/><use x="139" y="343" xlink:href="#block"/><use x="156" y="343" xlink:href="#block"/><use x="173" y="343" xlink:href="#block"/><use x="207" y="343" xlink:href="#block"/><use x="258" y="343" xlink:href="#block"/><use x="292" y="343" xlink:href="#block"/><use x="343" y="343" xlink:href="#block"/><use x="360" y="343" xlink:href="#block"/><use x="377" y="343" xlink:href="#block"/><use x="394" y="343" xlink:href="#block"/><use x="411" y="343" xlink:href="#block"/><use x="139" y="360" xlink:href="#block"/><use x="156" y="360" xlink:href="#block"/><use x="173" y="360" xlink:href="#block"/><use x="241" y="360" xlink:href="#block"/><use x="343" y="360" xlink:href="#block"/><use x="411" y="360" xlink:href="#block"/><use x="3" y="377" xlink:href="#block"/><use x="20" y="377" xlink:href="#block"/><use x="37" y="377" xlink:href="#block"/><use x="54" y="377" xlink:href="#block"/><use x="71" y="377" xlink:href="#block"/><use x="88" y="377" xlink:href="#block"/><use x="105" y="377" xlink:href="#block"/><use x="173" y="377" xlink:href="#block"/><use x="224" y="377" xlink:href="#block"/><use x="241" y="377" xlink:href="#block"/><use x="258" y="377" xlink:href="#block"/><use x="275" y="377" xlink:href="#block"/><use x="292" y="377" xlink:href="#block"/><use x="309" y="377" xlink:href="#block"/><use x="326" y="377" xlink:href="#block"/><use x="343" y="377" xlink:href="#block"/><use x="377" y="377" xlink:href="#block"/><use x="411" y="377" xlink:href="#block"/><use x="428" y="377" xlink:href="#block"/><use x="3" y="394" xlink:href="#block"/><use x="105" y="394" xlink:href="#block"/><use x="139" y="394" xlink:href="#block"/><use x="173" y="394" xlink:href="#block"/><use x="207" y="394" xlink:href="#block"/><use x="224" y="394" xlink:href="#block"/><use x="292" y="394" xlink:href="#block"/><use x="343" y="394" xlink:href="#block"/><use x="411" y="394" xlink:href="#block"/><use x="462" y="394" xlink:href="#block"/><use x="479" y="394" xlink:href="#block"/><use x="3" y="411" xlink:href="#block"/><use x="37" y="411" xlink:href="#block"/><use x="54" y="411" xlink:href="#block"/><use x="71" y="411" xlink:href="#block"/><use x="105" y="411" xlink:href="#block"/><use x="139" y="411" xlink:href="#block"/><use x="207" y="411" xlink:href="#block"/><use x="309" y="411" xlink:href="#block"/><use x="326" y="411" xlink:href="#block"/><use x="343" y="411" xlink:href="#block"/><use x="360" y="411" xlink:href="#block"/><use x="377" y="411" xlink:href="#block"/><use x="394" y="411" xlink:href="#block"/><use x="411" y="411" xlink:href="#block"/><use x="445" y="411" xlink:href="#block"/><use x="462" y="411" xlink:href="#block"/><use x="479" y="411" xlink:href="#block"/><use x="3" y="428" xlink:href="#block"/><use x="37" y="428" xlink:href="#block"/><use x="54" y="428" xlink:href="#block"/><use x="71" y="428" xlink:href="#block"/><use x="105" y="428" xlink:href="#block"/><use x="156" y="428" xlink:href="#block"/><use x="190" y="428" xlink:href="#block"/><use x="224" y="428" xlink:href="#block"/><use x="258" y="428" xlink:href="#block"/><use x="275" y="428" xlink:href="#block"/><use x="309" y="428" xlink:href="#block"/><use x="326" y="428" xlink:href="#block"/><use x="343" y="428" xlink:href="#block"/><use x="377" y="428" xlink:href="#block"/><use x="394" y="428" xlink:href="#block"/><use x="3" y="445" xlink:href="#block"/><use x="37" y="445" xlink:href="#block"/><use x="54" y="445" xlink:href="#block"/><use x="71" y="445" xlink:href="#block"/><use x="105" y="445" xlink:href="#block"/><use x="139" y="445" xlink:href="#block"/><use x="156" y="445" xlink:href="#block"/><use x="190" y="445" xlink:href="#block"/><use x="224" y="445" xlink:href="#block"/><use x="258" y="445" xlink:href="#block"/><use x="275" y="445" xlink:href="#block"/><use x="343" y="445" xlink:href="#block"/><use x="360" y="445" xlink:href="#block"/><use x="394" y="445" xlink:href="#block"/><use x="411" y="445" xlink:href="#block"/><use x="428" y="445" xlink:href="#block"/><use x="479" y="445" xlink:href="#block"/><use x="3" y="462" xlink:href="#block"/><use x="105" y="462" xlink:href="#block"/><use x="156" y="462" xlink:href="#block"/><use x="190" y="462" xlink:href="#block"/><use x="258" y="462" xlink:href="#block"/><use x="309" y="462" xlink:href="#block"/><use x="411" y="462" xlink:href="#block"/><use x="479" y="462" xlink:href="#block"/><use x="3" y="479" xlink:href="#block"/><use x="20" y="479" xlink:href="#block"/><use x="37" y="479" xlink:href="#block"/><use x="54" y="479" xlink:href="#block"/><use x="71" y="479" xlink:href="#block"/><use x="88" y="479" xlink:href="#block"/><use x="105" y="479" xlink:href="#block"/><use x="156" y="479" xlink:href="#block"/><use x="207" y="479" xlink:href="#block"/><use x="224" y="479" xlink:href="#block"/><use x="241" y="479" xlink:href="#block"/><use x="275" y="479" xlink:href="#block"/><use x="292" y="479" xlink:href="#block"/><use x="343" y="479" xlink:href="#block"/><use x="394" y="479" xlink:href="#block"/><use x="411" y="479" xlink:href="#block"/><use x="445" y="479" xlink:href="#block"/><use x="462" y="479" xlink:href="#block"/><use x="479" y="479" xlink:href="#block"/></svg>',"</div>","</div>"].join(""),pagination:['<div class="e-pagination ">','<div class="btn-handle btn selector" data-hover-background="#fff">first</div>','<div class="btn-handle btn selector pg" data-hover-background="#fff">1</div>','<div class="btn-handle btn selector pg" data-hover-background="#fff">2</div>','<div class="btn-handle btn selector pg" data-hover-background="#fff">3</div>','<div class="btn-handle btn selector pg" data-hover-background="#fff">4</div>','<div class="btn-handle btn selector pg" data-hover-background="#fff">5</div>','<div class="btn-handle btn selector" data-hover-background="#fff">next</div>',"</div>"].join(""),btn_sort:'<button class="btn btn-handle btn--sort selector">Sort</button>',empty:['<div class="b-empty">','<div class="b-empty__ico"><img src="'+s.domain_web+'/img/icons/empty.svg" /></div>','<div class="b-empty__body">','<div class="b-empty__title">列表为空</div>','<div class="btn-handle btn selector" data-hover-background="transparent">再次请求</div>',"</div>","</div>"].join(""),player_iframe:["<html>","<head></head>",'<body style="position:relative;width:{width}px;height:{height}px;overflow:hidden;margin:0px;padding:0px;">','<video id="video" width="{width}" height="{height}" style="position:absolute;top:0px;left:0px;width:{width}px;height:{height}px;" poster="'+s.domain_web+'/img/poster.png"></video>',"<script>",'var video = document.getElementById("video");','video.addEventListener("timeupdate", function() {','window.location.hash = "";',"});","<\/script>","<style>video:cue{opacity: 0}</style>","</body>","</html>"].join(""),present:['<div class="b-present selector" data-hover-background="transparent" data-image-opacity="0.4">','<ul class="b-present__entii">',"</ul>",'<div class="b-present__aesen">{name}</div>','<div class="b-present__rating"></div>','<div class="b-present__descr">{about}</div>','<div class="b-present__wath">观看</div>','<div class="b-present__iliis"><img class="b-present__otest" src="{poster}" alt="">','<div class="b-present__uomod">',"<div>",'<div class="b-present__ucrum">退出</div>','<div class="b-present__aeven">{released}</div>',"</div>","<div>",'<div class="b-present__ucrum">国家</div>','<div class="b-present__aeven">{country}</div>',"</div>","<div>",'<div class="b-present__ucrum">导演</div>','<div class="b-present__aeven">{director}</div>',"</div>","</div>","</div>","</div>"].join(""),icon_play:['<?xml version="1.0" encoding="iso-8859-1"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">','<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 142.448 142.448" style="enable-background:new 0 0 142.448 142.448;" xml:space="preserve">',"<g>",'<path fill="currentColor" d="M142.411,68.9C141.216,31.48,110.968,1.233,73.549,0.038c-20.361-0.646-39.41,7.104-53.488,21.639 C6.527,35.65-0.584,54.071,0.038,73.549c1.194,37.419,31.442,67.667,68.861,68.861c0.779,0.025,1.551,0.037,2.325,0.037 c19.454,0,37.624-7.698,51.163-21.676C135.921,106.799,143.033,88.377,142.411,68.9z M111.613,110.336 c-10.688,11.035-25.032,17.112-40.389,17.112c-0.614,0-1.228-0.01-1.847-0.029c-29.532-0.943-53.404-24.815-54.348-54.348 c-0.491-15.382,5.122-29.928,15.806-40.958c10.688-11.035,25.032-17.112,40.389-17.112c0.614,0,1.228,0.01,1.847,0.029 c29.532,0.943,53.404,24.815,54.348,54.348C127.91,84.76,122.296,99.306,111.613,110.336z"/>','<path fill="currentColor" d="M94.585,67.086L63.001,44.44c-3.369-2.416-8.059-0.008-8.059,4.138v45.293 c0,4.146,4.69,6.554,8.059,4.138l31.583-22.647C97.418,73.331,97.418,69.118,94.585,67.086z"/>',"</g>","</svg>"].join(""),icon_bookmark:['<svg width="171" height="171" viewBox="0 0 171 171" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="85.5" cy="85.5" r="78" stroke="currentColor" stroke-width="15"/><path d="M50 14V115L85 84.3939L120 115V14" stroke="currentColor" stroke-width="15" stroke-linejoin="round"/></svg>'].join(""),icon_magnet:['<svg width="171" height="171" viewBox="0 0 171 171" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="85.5" cy="85.5" r="78" stroke="currentColor" stroke-width="15"/><rect x="41" y="51" width="24" height="16" fill="currentColor"/><rect x="82" y="51" width="47" height="16" fill="currentColor"/><rect x="41" y="79" width="88" height="16" fill="currentColor"/><rect x="41" y="105" width="41" height="16" fill="currentColor"/><rect x="99" y="105" width="30" height="16" fill="currentColor"/></svg>'].join(""),icon_wath:['<svg width="171" height="171" viewBox="0 0 171 171" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="85.5" cy="85.5" r="78" stroke="currentColor" stroke-width="15"/><path d="M85 41C60.1724 41 40 61.1724 40 86C40 110.828 60.1724 131 85 131C109.828 131 130 110.828 130 86C130 61.1724 109.828 41 85 41ZM85 71.5C78 71.5 71.3966 78.5 71.3966 86H54C54 70 68 54.5 85 54.5V71.5Z" fill="currentColor"/></svg>'].join(""),icon_check:['<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs" version="1.1" width="512" height="512" x="0" y="0" viewBox="0 0 408.576 408.576" style="enable-background:new 0 0 512 512" xml:space="preserve" class=""><g><g xmlns="http://www.w3.org/2000/svg"><g><path d="M204.288,0C91.648,0,0,91.648,0,204.288s91.648,204.288,204.288,204.288s204.288-91.648,204.288-204.288    S316.928,0,204.288,0z M318.464,150.528l-130.56,129.536c-7.68,7.68-19.968,8.192-28.16,0.512L90.624,217.6    c-8.192-7.68-8.704-20.48-1.536-28.672c7.68-8.192,20.48-8.704,28.672-1.024l54.784,50.176L289.28,121.344    c8.192-8.192,20.992-8.192,29.184,0C326.656,129.536,326.656,142.336,318.464,150.528z" fill="currentColor"/></g></g></g></svg>'].join(""),icon_noview:['<svg width="89" height="89" viewBox="0 0 89 89" fill="none" xmlns="http://www.w3.org/2000/svg"><circle r="40" transform="matrix(1 0 0 -1 44.5 44.5)" stroke="currentColor" stroke-width="9"/><rect width="82.9548" height="11.0451" rx="5.52256" transform="matrix(0.707107 -0.707107 -0.707107 -0.707107 18.171 77.829)" fill="currentColor"/><path d="M37.9113 64.969C39.9882 65.6383 42.2023 65.9999 44.4999 65.9999C56.362 65.9999 65.9999 56.3619 65.9999 44.4999C65.9999 42.2023 65.6383 39.9881 64.969 37.9113L37.9113 64.969Z" fill="currentColor"/><path d="M49.8317 23.6679C48.1264 23.2318 46.3399 22.9999 44.4999 22.9999C32.6379 22.9999 22.9999 32.6378 22.9999 44.4999C22.9999 46.3399 23.2318 48.1264 23.668 49.8317L29.7079 43.7918C30.0961 36.5484 36.3771 29.7208 44.0419 29.4577L49.8317 23.6679Z" fill="currentColor"/></svg>'].join(""),ads:['<div id="ads-content" class="ad">','<video id="ads-player" class="ad__player">',"</video>",'<div id="ads-display" class="ad__display"></div>',"</div>"].join(""),my_torrents_empty:["<div>",'<div class="b-cards__name" style="margin-bottom: 2em;">我的种子</div>','<div class="typo-malit">没有种子? 别担心!<br> 按照下面的说明，你会没事的。<br><br></div>','<p class="typo-uomod typo-white">- 如何通过 TorrServer 添加种子。找到 magnet 链接，然后打开 TorrServer 和单击添加按钮。</p>',"</div>"].join(""),my_bookmarks_empty:["<div>",'<div class="b-cards__name" style="margin-bottom: 2em;">我的书签</div>','<div class="typo-malit">无书签<br><br></div>',"</div>"].join(""),account_menu:["<div>",'<div class="b-playlist__item selector a-auth">','<div class="b-playlist__name" id="auth">登录</div>',"</div>",'<div class="b-playlist__item selector a-reg">','<div id="reg" class="b-playlist__name">注册</div>',"</div>",'<div class="b-playlist__item selector a-out">','<div class="b-playlist__name">注销</div>',"</div>","</div>"].join(""),account_menu_empty:["<div>",'<div class="b-playlist__item selector a-out">','<div class="b-playlist__name">注销</div>',"</div>","</div>"].join(""),account_fields:['<div class="s-account__otior">','<div class="e-setting">','<div class="e-setting__name">Email</div>','<input autocomplete="off" type="text" class="e-setting__value selector" placeholder="输入 email" data-name="email" readonly="" />',"</div>",'<div class="e-setting">','<div class="e-setting__name">密码</div>','<input autocomplete="off" type="password" class="e-setting__value selector" placeholder="输入密码" data-name="password" readonly="" />',"</div>",'<div class="s-account__code hide">','<div class="s-account__code-descr">或者在您的帐户中输入代码</div>','<div class="s-account__code-field">139 678</div>',"</div>","</div>"].join(""),account_auth:["<div>",'<div class="btn-blico selector s-account__otior">登录</div>','<div style="text-align: center">',"<p>忘记密码? 转到 <b>http://vokino.tv/password/reset</b></p>","</div>","</div>"].join(""),account_reg:["<div>",'<div class="btn-blico selector">注册</div>',"</div>"].join(""),account_item:['<div class="b-swipe__item">','<div class="s-account__item">','<div class="s-account__ico">H</div>','<div class="s-account__email">{email}</div>',"</div>","</div>"].join(""),ad_files:['<div class="b-ad b-ad--files selector" data-hover-background="#ffffff">','<div class="b-ad__inner">','<img src="{img}" class="b-ad__img" />','<div class="b-ad__url">点击链接: {url}</div>',"</div>","</div>"].join(""),ad_side:['<div class="b-ad b-ad--side selector" data-hover-background="#ffffff">',"</div>"].join("")};r.SpatialNavigator=function(){this._focus=null,this._previous=null},r.SpatialNavigator.prototype={straightOnly:!0,straightOverlapThreshold:.5,ignoreHiddenElement:!1,rememberSource:!1,navigableFilter:null,silent:!1,_getRect:function(e){var t=null;if(!this._isNavigable(e))return null;if(e.getBoundingClientRect){var i=e.getBoundingClientRect();t={left:i.left,top:i.top,width:i.width,height:i.height}}else{if(void 0===e.left)return null;t={left:parseInt(e.left||0,10),top:parseInt(e.top||0,10),width:parseInt(e.width||0,10),height:parseInt(e.height||0,10)}}return t.element=e,t.right=t.left+t.width,t.bottom=t.top+t.height,t.center={x:t.left+Math.floor(t.width/2),y:t.top+Math.floor(t.height/2)},t.center.left=t.center.right=t.center.x,t.center.top=t.center.bottom=t.center.y,t},_getAllRects:function(e){var t=[];return this._collection.forEach(function(i){if(!e||e!==i){var n=this._getRect(i);n&&t.push(n)}},this),t},_isNavigable:function(e){if(this.ignoreHiddenElement&&e instanceof HTMLElement){var t=window.getComputedStyle(e);if(e.offsetWidth<=0&&e.offsetHeight<=0||"hidden"==t.getPropertyValue("visibility")||"none"==t.getPropertyValue("display")||e.hasAttribute("aria-hidden"))return!1}return!(this.navigableFilter&&!this.navigableFilter(e))},_partition:function(e,t){var i=[[],[],[],[],[],[],[],[],[]],n=this.straightOverlapThreshold;return(n>1||n<0)&&(n=.5),e.forEach(function(e){var o,a,s,r=e.center;o=r.x<t.left?0:r.x<=t.right?1:2,a=r.y<t.top?0:r.y<=t.bottom?1:2,i[s=3*a+o].push(e),-1!==[0,2,6,8].indexOf(s)&&(e.left<=t.right-t.width*n&&(2===s?i[1].push(e):8===s&&i[7].push(e)),e.right>=t.left+t.width*n&&(0===s?i[1].push(e):6===s&&i[7].push(e)),e.top<=t.bottom-t.height*n&&(6===s?i[3].push(e):8===s&&i[5].push(e)),e.bottom>=t.top+t.height*n&&(0===s?i[3].push(e):2===s&&i[5].push(e)))}),i},_getDistanceFunction:function(e){return{nearPlumbLineIsBetter:function(t){var i;return(i=t.center.x<e.center.x?e.center.x-t.right:t.left-e.center.x)<0?0:i},nearHorizonIsBetter:function(t){var i;return(i=t.center.y<e.center.y?e.center.y-t.bottom:t.top-e.center.y)<0?0:i},nearTargetLeftIsBetter:function(t){var i;return(i=t.center.x<e.center.x?e.left-t.right:t.left-e.left)<0?0:i},nearTargetTopIsBetter:function(t){var i;return(i=t.center.y<e.center.y?e.top-t.bottom:t.top-e.top)<0?0:i},topIsBetter:function(e){return e.top},bottomIsBetter:function(e){return-1*e.bottom},leftIsBetter:function(e){return e.left},rightIsBetter:function(e){return-1*e.right}}},_prioritize:function(e,t,i){var n=e.find(function(e){return!!e.group.length});if(!n)return null;if(this.rememberSource&&this._previous&&t==this._previous.destination&&i==this._previous.reverse){var o=this._previous.source,a=n.group.find(function(e){return e.element==o});if(a)return a}return n.group.sort(function(e,t){return n.distance.reduce(function(i,n){return i||n(e)-n(t)},0)}),n.group[0]},setCollection:function(e){this.unfocus(),this._collection=[],e&&this.multiAdd(e)},add:function(e){return!(this._collection.indexOf(e)>=0)&&(this._collection.push(e),!0)},multiAdd:function(e){return Array.from(e).every(this.add,this)},remove:function(e){var t=this._collection.indexOf(e);return!(t<0)&&(this._focus===e&&this.unfocus(),this._collection.splice(t,1),!0)},multiRemove:function(e){return Array.from(e).every(this.remove,this)},focused:function(e){this._focus=e},focus:function(e){if(!e&&this._focus&&this._isNavigable(this._focus)&&(e=this._focus),!this._collection)return!1;if(e){if(this._collection.indexOf(e)<0||!this._isNavigable(e))return!1}else{var t=this._collection.filter(this._isNavigable,this);if(!t.length)return!1;e=t[0]}return this.unfocus(),this._focus=e,this.silent||this.dispatchEvent({type:"focus",elem:this._focus}),!0},unfocus:function(){if(this._focus){var e=this._focus;this._focus=null,this.silent||this.dispatchEvent({type:"unfocus",elem:e})}return!0},getFocusedElement:function(){return this._focus},move:function(e){if(this._focus){var t=this.navigate(this._focus,e);if(!t)return!1;this.rememberSource&&(this._previous={source:this._focus,destination:t,reverse:{left:"right",up:"down",right:"left",down:"up"}[e.toLowerCase()]}),this.unfocus(),this.focus(t)}else this._previous=null,this.focus();return!0},canmove:function(e){if(this._focus){var t=this.navigate(this._focus,e);if(null!==t)return t}return!1},navigate:function(e,t){if(!e||!t||!this._collection)return null;t=t.toLowerCase();var i=this._getAllRects(e),n=this._getRect(e);if(!n||!i.length)return null;var o,a=this._getDistanceFunction(n),s=this._partition(i,n),r=this._partition(s[4],n.center);switch(t){case"left":o=[{group:r[0].concat(r[3]).concat(r[6]),distance:[a.nearPlumbLineIsBetter,a.topIsBetter]},{group:s[3],distance:[a.nearPlumbLineIsBetter,a.topIsBetter]},{group:s[0].concat(s[6]),distance:[a.nearHorizonIsBetter,a.rightIsBetter,a.nearTargetTopIsBetter]}];break;case"right":o=[{group:r[2].concat(r[5]).concat(r[8]),distance:[a.nearPlumbLineIsBetter,a.topIsBetter]},{group:s[5],distance:[a.nearPlumbLineIsBetter,a.topIsBetter]},{group:s[2].concat(s[8]),distance:[a.nearHorizonIsBetter,a.leftIsBetter,a.nearTargetTopIsBetter]}];break;case"up":o=[{group:r[0].concat(r[1]).concat(r[2]),distance:[a.nearHorizonIsBetter,a.leftIsBetter]},{group:s[1],distance:[a.nearHorizonIsBetter,a.leftIsBetter]},{group:s[0].concat(s[2]),distance:[a.nearPlumbLineIsBetter,a.bottomIsBetter,a.nearTargetLeftIsBetter]}];break;case"down":o=[{group:r[6].concat(r[7]).concat(r[8]),distance:[a.nearHorizonIsBetter,a.leftIsBetter]},{group:s[7],distance:[a.nearHorizonIsBetter,a.leftIsBetter]},{group:s[6].concat(s[8]),distance:[a.nearPlumbLineIsBetter,a.topIsBetter,a.nearTargetLeftIsBetter]}];break;default:return null}this.straightOnly&&o.pop();var l=this._prioritize(o,e,t);return l?l.element:null}};r.Account=function(){var e,t=this,i=$("#account"),n=$("#account-items"),o=$("#account-menu"),a=$("#account-view"),l={},c={},u=[];this.save=function(){f.set("login",""),f.set("password",""),f.set("auth_token",s.auth),f.set("accounts",JSON.stringify(c)),f.set("accounts_removed",JSON.stringify(u))},this.initial=function(){c=d.decodeJson(s.Settings.get("accounts")),u=d.decodeJson(s.Settings.get("accounts_removed"),[]),d.extend(c,{enabled:!1,users:[]}),_swipe=new r.Swipe(n,{}),t._emptyAccount(),c.enabled.token&&(s.auth=c.enabled.token),t._setIcon(),t.save()},this.close=function(){h.animOut(i),s.Controller.toggle("head")},this.sync=function(e){for(var i=0;i<e.length;i++){var n=e[i];this._find(n)||this._removed(n.email)||(c.users.push(n),t.save())}},this.synch=function(){s.Socket.send("account",{type:"sync",accounts:c.users})},this.append_code=function(code){code=code.toString();$(".s-account__code-field").text(code.slice(0,3)+" "+code.slice(3));$(".s-account__code").show()},this.socket_auth=function(data){if(data.token){t._createItem(data.email,data.token);s.Controller.toggle("account-menu");t.synch();$.notify("成功远程登录!",{className:"success"})}},this._find=function(e){for(var t=!1,i=0;i<c.users.length;i++){var n=c.users[i];if(n.email==e.email&&n.token==e.token){t=n;break}}return t},this._removed=function(e){for(var t=!1,i=0;i<u.length;i++)if(u[i]==e){t=u[i];break}return t},this._addfields=function(i){var n=s.Template.get("account_fields",{}),a=$("input",n),r=function(e,t){l[e]=t};a.on("hover:enter",function(){a.blur().attr("readonly","readonly");var e=$(this).data("name"),i=$(this),n=s.Controller.active;i.on("change",function(){r(e,i.val())});var o=function(){r(e,i.val()),t._setCollection(i),s.Controller.active=n};s.Keybord.open($(this),{back:o,enter:o})}),a.on("hover:active",function(){a.blur().attr("readonly","readonly"),e=!1}),o.append(n)},this._finish=function(){e&&o.find("input").blur().attr("readonly","readonly"),e=!0},this._createItem=function(e,i){var o={email:e,token:i};c.enabled.need_remove?(c.enabled=o,c.users=[o]):(c.enabled=o,c.users.push(o)),t._buildAccount(),t._setIcon(),t.save(),h.animIn(n)},this._isReady=function(e){for(var t,i=0;i<c.users.length;i++)if(c.users[i].email==e){t=!0;break}return t&&$.notify("您已使用此帐户登录",{className:"info"}),t},this._addBtnAction=function(e){var i=s.Template.get("account_"+e,{});$(".selector",i).on("hover:enter",function(){if(l.email&&l.password){if(t._isReady(l.email))return;if(!h.validateEmail(l.email))return $.notify("Email 无效格式",{className:"error"});var action_link=s.domain_url+"/"+e;action_link=h.addUrlParams(action_link,"email="+encodeURIComponent(l.email));action_link=h.addUrlParams(action_link,"passwd="+encodeURIComponent(l.password));action_link=h.addUrlParams(action_link,"deviceid="+h.hashCode(navigator.userAgent));s.Reguest.silent(action_link,function(e){e.authToken?(t._createItem(l.email,e.authToken),s.Controller.toggle("account-menu"),t.synch()):e.error?$.notify(e.error,{className:"error"}):$.notify("无效电子邮件或密码!",{className:"error"})},function(){$.notify("内部错误联系支持!",{className:"error"})})}else $.notify("请输入电子邮件和密码!",{className:"error"})}).on("hover:active",function(){o.find("input").blur().attr("readonly","readonly")}),o.append(i)},this._setCollection=function(e){s.Hover.update();var t=o.find(".selector").toArray();s.SpatialNavigator.setCollection(t),s.SpatialNavigator.focus((e||t)[0])},this._menu=function(){var is_empty="";s.auth&&(is_empty="_empty");var e=s.Template.get("account_menu"+is_empty,{});$(".a-reg",e).on("hover:enter",function(){s.Controller.toggle("account-reg")}),$(".a-auth",e).on("hover:enter",function(){s.Controller.toggle("account-auth")}),$(".a-out",e).on("hover:enter",function(){t._out()}),o.append(e),t._setCollection()},this._removeAccount=function(e){-1==u.indexOf(e.email)&&u.push(e.email)},this._out=function(){s.Reguest.silent(s.domain_url+"/logout",function(logout){$.notify(logout.success,{className:"success"})});s.auth=false;s.Controller.toggle("account-menu");t.save();c.users.length<=1?(this._removeAccount(c.users[0]),c.users=[]):(this._removeAccount(c.enabled),d.remove(c.users,c.enabled),c.enabled=c.users[c.users.length-1]);t._emptyAccount();t._buildAccount();t._setIcon();t.save();t.synch();h.animIn(n)},this.check_auth=function(){var auth;s.Reguest.silent(s.domain_url+"/check_auth",function(data){auth=data.auth;if(!data.auth)t._out()});return auth},this._up=function(){s.SpatialNavigator.move("up")},this._down=function(){s.SpatialNavigator.move("down")},this._change=function(){c.enabled=c.users[_swipe.position],s.auth=c.enabled.token,t._setIcon(),t.save()},this._right=function(){_swipe.slideNext(),this._change()},this._left=function(){_swipe.slidePrev(),this._change()},this._emptyAccount=function(){var e=s.Settings.get("auth_token")&&s.Settings.get("login"),t={email:s.Settings.get("login")||"未知",token:s.Settings.get("auth_token"),need_remove:!0};(e||0==c.users.length)&&(c.enabled=t,c.users.push(t))},this._setIcon=function(){var e=c.enabled.email,t=h.stringToHslColor(e,50,65);a.css({backgroundColor:t}).find("span").text(e[0].toUpperCase())},this._buildAccount=function(){s.auth=!1;var e=$("> .b-swipe__wrap",n).empty(),t=-1;$.each(c.users,function(i,n){var o=s.Template.get("account_item",n),a=h.stringToHslColor(n.email,50,65);o.find(".s-account__ico").css({background:a}).text(n.email[0].toUpperCase()),n.email==c.enabled.email&&(t=i),e.append(o)}),_swipe.reset(),t>=0&&_swipe.slideTo(t),c.enabled.token&&(s.auth=c.enabled.token)},this._updateItems=function(){setTimeout(function(){_swipe.slideTo(_swipe.position)},s.Settings.get("animation")?300:0)},s.Controller.add("account",{toggle:function(){o.empty(),s.History.fake("account"),h.animIn(i),s.Controller.toggle("account-menu"),t._buildAccount(),t._updateItems()},up:this._up.bind(this),down:this._down.bind(this),left:this._left.bind(this),right:this._right.bind(this),touchLeft:this._left.bind(this),touchRight:this._right.bind(this),back:function(){t.close()}}),s.Controller.add("account-menu",{toggle:function(){o.empty(),s.History.fake("account"),t._menu()},up:this._up.bind(this),down:this._down.bind(this),left:this._left.bind(this),right:this._right.bind(this),touchLeft:this._left.bind(this),touchRight:this._right.bind(this),back:function(){t.close()}}),s.Controller.add("account-auth",{toggle:function(){o.empty();s.History.fake("account");t._addfields("account-auth");s.Socket.send("account",{type:"code"});t._addBtnAction("auth");t._setCollection()},up:this._up.bind(this),down:this._down.bind(this),left:this._left.bind(this),right:this._right.bind(this),touchLeft:this._left.bind(this),touchRight:this._right.bind(this),back:function(){s.Controller.toggle("account-menu")},finish:this._finish.bind(this)}),s.Controller.add("account-reg",{toggle:function(){o.empty(),s.History.fake("account"),t._addfields("account-reg"),t._addBtnAction("reg"),t._setCollection()},up:this._up.bind(this),down:this._down.bind(this),left:this._left.bind(this),right:this._right.bind(this),touchLeft:this._left.bind(this),touchRight:this._right.bind(this),back:function(){s.Controller.toggle("account-menu")},finish:this._finish.bind(this)}),a.on("hover:enter",function(){s.Controller.toggle("account")}),i.on("mousedown",function(e){$(e.target).closest($(".s-account__menu,.s-account__item")).length||t.close()})},r.Platform=function(){var $this=this;this.init=function(){if(typeof webOS!="undefined"){f.set("platform","webos")}else if(typeof webapis!="undefined"&&typeof tizen!="undefined"){f.set("platform","tizen")}else if(typeof androidApp!="undefined"){f.set("platform","android")}else if(typeof process!="undefined"){f.set("platform","desktopapp")}else if(navigator.userAgent.toLowerCase().indexOf("windows nt")>-1){f.set("platform","browser")}else if(navigator.userAgent.toLowerCase().indexOf("maple")>-1){f.set("platform","orsay")}else{f.set("platform","")}f.set("native",f.get("platform")?true:false)},this.get=function(){return f.get("platform")||""},this.is=function(need){return $this.get()==need?true:false},this.any=function(){return $this.is("tizen")||$this.is("webos")||$this.is("android")?true:false},this.tv=function(){return $this.is("tizen")||$this.is("webos")||$this.is("orsay")?true:false},this["native"]=function(){return f.get("platform")?true:false}},r.Settings=function(){var e,t=this,i={interface_size:{80:"80%",90:"90%",100:"100%",120:"120%",140:"140%"},text_size:{less:"Less比",medium:"正常",bigger:"大于"},animation:{"false":"Нет","true":"Да"},background:{"false":"Нет","true":"Да"},background_view:{"false":"Нет","true":"Да"},background_gradient:{"false":"Нет","true":"Да"},interface_vertical:{"false":"内联","true":"垂直"},interface_type:{one:"类型 1",two:"类型 2"},load_last_url:{"true":"最后打开的页面","false":"首页"},bookmarks_type:{"true":"未分类","false":"按类别"},server:"",ace:"",server_use:{server:"TorrServer",ace:"Ace Stream"},screen:{"false":"Нет","true":"Да"},server_auth:{"false":"Нет","true":"Да"},server_login:"",server_pass:"",screen_4k:{"false":"Нет","true":"Да"},listQuery:{0:"选择",1:"在线",2:"Torrent"},defaultQuality:{0:"选择",2160:"2160p",1080:"1080p",720:"720p",480:"480p"},langUA:{0:"隐藏",1:"显示"},sortTorrents:{"false":"按日期",size_desc:"按大小(降序)",size_asc:"按大小(升序)",seed_desc:"基于种子(降序)",seed_asc:"基于种子(升序)"},sortOnline:{"false":"未选择",HDRezka:"HDRezka",Filmix:"Filmix",Collapse:"Collapse",Kinobase:"Kinobase",Bazon:"Bazon",MoonWalk:"MoonWalk",VoKino:"VoKino"},voice_search:{"true":"启用","false":"禁用"},time:["0","+1","+2","+3","+4","+5","+6","+7","+8","+9","+10","-10","-9","-8","-7","-6","-5","-4","-3","-2","-1"],virtual_keyboard:{"false":"内置","true":"虚拟"},player_default:{"true":"内置","false":"第 3 方"},player_new:{"true":"播放器 A","false":"播放器 B"},player:{a:"播放器 A",b:"播放器 B"},player_transformation:{transform:"Transform",calculate:"计算"},player_hls_suport:{"true":"系统","false":"软件"},player_prelod:{"true":"显示","false":"跳过"},player_ratio:"contain",player_subs_size:{less:"Less",medium:"正常",bigger:"更多"},player_continue:{ask:"建议",olw:"询问",now:"立即继续",nov:"不要继续"},player_next:{"true":"运行","false":"不要运行"},player_magnet:{"true":"建议打开","false":"启动播放器"},player_time:{"false":"Нет","true":"Да"},player_volume:1,custom_player:"",view_history_clear:{"true":"清除"},webos_set_input:{"true":"安装"},upload_playlist:{"true":"建议","false":"跳过"},upload_remove_db:{"true":"播放","false":"添加和播放"},devicename:"",enable_parsing:{"true":"Да","false":"Нет"},android_player:{inner:"内置",choice:"选择","default":"默认"},android_player_torrent:{inner:"内置",choice:"选择","default":"默认"},kp_supportSsl:{0:"Нет",1:"Да"},kp_supportHevc:{0:"Нет",1:"Да"},kp_supportHdr:{0:"Нет",1:"Да"},kp_support4k:{0:"Нет",1:"Да"},kp_serverLocation:{1:"德国",2:"俄罗斯"}},n={interface_size:"100",animation:"true",background:"true",background_view:"true",background_gradient:"true",text_size:"medium",listQuery:"0",defaultQuality:"0",langUA:"0",sortTorrents:"false",sortOnline:"false",time:"0",player_default:"true",server:"",server_auth:"false",server_login:"",server_pass:"",ace:"",server_use:"server",player_ratio:"contain",player_prelod:"false",player_hls_suport:"true",player_subs_size:"medium",player_new:"true",player_continue:"ask",player_magnet:"false",player_time:"false",player_volume:1,screen_4k:"false",screen:"true",virtual_keyboard:"false",player:"a",player_transformation:"transform",player_next:"true",view_history_clear:"true",webos_set_input:"true",upload_playlist:"true",upload_remove_db:"true",devicename:h.deviceName(),android_player:"default",android_player_torrent:"default",enable_parsing:"true",interface_vertical:"false",interface_type:"one",load_last_url:"true",bookmarks_type:"true",custom_player:"",voice_search:"false",kp_supportSsl:"0",kp_supportHevc:"0",kp_supportHdr:"0",kp_support4k:"0",kp_serverLocation:"1"};"undefined"!=typeof webapis&&"undefined"!=typeof tizen&&(i.player={a:"播放器 A",b:"播放器 B",tizen:"Tizen"},n.player="tizen"),this.params=i,this.defaults=n;var o=["listQuery","defaultQuality","langUA"];(s.is_android||s.is_browser)&&(n.animation="true",n.background="true",n.server="127.0.0.1:8090",n.ace="127.0.0.1:6878",n.player_default="false",n.voice_search="true"),"undefined"!=typeof process&&(n.android_player="inner",n.android_player_torrent="inner",n.player_magnet="false"),"undefined"!=typeof webOS&&(n.android_player="inner",n.android_player_torrent="inner");var a=$(".s-settings__input"),l=$(".s-settings__field"),c=$(".s-settings__left .selector"),u=$(".s-settings__body-inner > div"),p=$(".s-settings__back"),g=$(".s-settings__body .scrollbar-inner"),v=navigator.userAgent.match(/Tizen (\d)/);if(v&&parseInt(v[1])<3&&(n.player_new="false"),this.get=function(e){var t=f.get(e)||n[e]||"",i=parseInt(t);return!isNaN(i)&&/^\d+$/.test(t)?i:"true"==t||"false"==t?"true"==t:t},this.get_all=function(name){return i[name]},this.getName=function(e){var t=f.get(e)||n[e]||"";return d.isArray(i[e])?t:i[e][t]},this.change=function(e,t){f.set(e,t),this.dispatchEvent({type:"change",name:e,value:t})},this.updateValue=function(e){$('.st-selector[data-name="'+e+'"]').text(this.getName(e))},this.open=function(){s.Hover.update(),l.hide();var t=c.filter(".active"),i=c.index(t),n=u.hide().eq(i).show().find(".selector").toArray(),o=c.toArray().concat(n,p[0]);s.SpatialNavigator.setCollection(o),s.SpatialNavigator.focus(e||o[0]),s.SpatialNavigator.straightOnly=!1,h.animIn($(".s-settings")),e=!1,setTimeout(function(){s.Layer.resize()},s.Settings.get("animation")?300:0)},this.close=function(){h.animOut($(".s-settings"))},this._toggleControll=function(e,o,a){var r=i[o],l=d.isArray(r)?r:d.getKeys(r),c=f.get(o)||n[o],p=l.indexOf(c);e.unbind("hover:enter").on("hover:enter",function(){p+=1,!0&&p>=l.length&&(p=0),p=Math.max(0,Math.min(l.length-1,p)),c=l[p],e.text(d.isArray(r)?c:r[c]),t.change(o,c),a&&a(o,c)}),s.Controller.add("settings_controll",{toggle:function(){h.scrollUpdate(u.find(".selector.hover"),!0)},up:function(){s.SpatialNavigator.move("up")},down:function(){s.SpatialNavigator.move("down")},left:function(){s.Controller.toggle("settings")},right:function(){},back:function(){s.History.fake("settings"),s.Controller.toggle("settings")}}),s.Controller.toggle("settings_controll")},this._toggleInput=function(i,n,o){console.log(i,n,o);e=i[0];var r,c=!1,d=i.data("type");a.attr("type",d||"text"),setTimeout(function(){c=!0},300),s.Controller.add("settings_input",{toggle:function(){s.History.fake("settings_input"),s.SpatialNavigator.setCollection(),l.show(),a.val(t.get(n)),s.Keybord.open(a,{back:function(){s.Controller.toggle("settings")},enter:function(){u(13)}})},up:function(){u(13,!0),s.Controller.toggle("settings")},back:function(){u(13,!0),s.Controller.toggle("settings")},finish:function(){u(13)}}),s.Controller.toggle("settings_input");var u=function(e,l){if(13==e&&c&&!r){l||s.History.back();var u=a.val();a.blur().attr("readonly","true"),i.text(u?"password"==d?h.password(u):u:i.attr("placeholder")),t.change(n,u),r=!0,o&&o()}13==e&&(c=!0)}},this.serverCheckConnect=function(e){this._serverCheckConnect("server",function(t,i){e&&e(t,i)}),this._serverCheckConnect("ace",function(t,i){e&&e(t,i)})},this._serverCheckConnect=function(e,t){var i=(this.get(e)+"").replace(/(^\w+:|^)\/\//,""),n=$("#"+e+"-status-connect").removeClass("error good").text("无连接"),o="server"==e;console.log("Server","start check:",e,i),s["server_connected_"+e]=!1,this.change(e,i);var a=function(){n.addClass("good").text("已连接"),s["server_connected_"+e]=!0,t&&t(!0,e)},r=function(i,o){i&&console.log("Server","error:",e,s.Reguest.errorDecode(i,o)),n.addClass("error").text("连接失败"),t&&t(!1,e),i&&s.Console.add("Server responce error: ["+e+"] "+s.Reguest.errorDecode(i,o))};if(i){var l=o?"http://"+i+"/echo":"http://"+i+"/webui/api/service?method=get_version&format=json&callback=window.aceTest";if(-1!==s.torr_uapi.indexOf(i)&&o)return s.torrserver_ver="1.1",a();var c={url:l,timeout:1e4,dataType:o?"html":"json",success:function(t){if(console.log("Server","responce:",e,t),s.Console.add("Server responce: ["+e+"] "+s.Console.decodeData(t)),o){var i=t.slice(0,3);s.torrserver_ver=i,s.torrserver_new="1.2"==i||"Mat"==i||"SpA"==i,"1.1"===i||s.torrserver_new?a():r()}else t.result?a():r()},error:r};$.ajax(c)}else r()},this.accountCheckConnect=function(e){var i=(this.get("login")+"").trim(),n=(this.get("password")+"").trim(),o=$("#accaunt-status-connect").removeClass("error good").text("请稍候"),a=e?"reg":"auth";if(s.auth=!1,t.change("auth_token",""),i&&n){if(!h.validateEmail(i))return o.addClass("error").text("Email 格式无效");s.Reguest.silent(s.domain_url+"/"+a+"?email="+encodeURIComponent(i)+"&passwd="+encodeURIComponent(n),function(e){e.authToken?(o.addClass("good").text("已登录"),t.change("auth_token",e.authToken),s.auth=!0):e.error?o.addClass("error").text(e.error):o.addClass("error").text("电子邮件或密码无效")},function(){o.addClass("error").text("登录失败")})}else o.addClass("error").text("请输入电子邮件和密码")},this.checkAuthToken=function(){var e=this.get("auth_token"),t=$("#accaunt-status-connect").removeClass("error good").text("请稍候");e?s.Reguest.silent(s.domain_url+"/auth/status",function(e){e.authToken?(t.addClass("good").text("已授权"),s.auth=!0):$.notify("验证授权失败",{className:"error"})}):t.text("未授权")},this.setServerSettings=function(e){var t=!e;if(e&&-1!==o.indexOf(e)&&(t=!0),t)for(var i=0;i<o.length;i++){var n=o[i];s.Reguest.silent(s.domain_url+"/settings/set?"+n+"="+this.get(n))}},this.getServerSettings=function(){t.change("devicename",h.deviceName());s.Reguest.silent(s.domain_url+"/settings/get",function(data){if(data.settings){for(var name in data.settings){t.change(name,data.settings[name]);t.updateValue(name)}}})},this._displayServer=function(){$(".server-use-param-server,.server-use-param-ace").hide(),$(".server-use-param-"+t.get("server_use")).show()},this._setCollect=function(e){var t=c.toArray().concat(e.find(".selector").toArray(),p[0]);s.SpatialNavigator.setCollection(t)},s.Controller.add("settings",{toggle:this.open.bind(this),up:function(){s.SpatialNavigator.move("up")},down:function(){s.SpatialNavigator.move("down")},left:function(){s.SpatialNavigator.move("left")},right:function(){s.SpatialNavigator.move("right")},back:function(){t.close(),s.Controller.toggle("head")}}),c.on("hover:enter",function(){var e=c.index($(this));c.removeClass("active").eq(e).addClass("active"),u.hide().eq(e).show();var t=c.toArray().concat(u.eq(e).find(".selector").toArray(),p[0]);s.SpatialNavigator.setCollection(t),s.SpatialNavigator.focus($(this)[0])}),$(".settings-open").on("hover:enter",function(){s.History.fake("settings"),s.Controller.toggle("settings")}),$(".settings-close").on("hover:enter",function(){s.History.back()}),$(".st-selector").each(function(){var e=$(this),i=e.data("name");e.on("hover:active click",function(){t._toggleControll($(this),i,function(){t.setServerSettings(i),t._displayServer(),"view_history_clear"==i&&s.Reguest.silent(s.domain_url+"/timeline/clear"),"webos_set_input"==i&&s.AVTransport.setInput(),"interface_type"==i&&s.Background.reset()})}).text(t.getName(i))}),$(".st-input").each(function(){var e=$(this),i=e.data("name"),n=e.data("type"),o=t.get(i);e.on("hover:active",function(){}).on("hover:enter",function(){t._toggleInput($(this),i,function(){if("server"==i||"ace"==i){t.serverCheckConnect();var n=s.Settings.get(i);n&&e.text(n)}})}).text(o?"password"==n?h.password(o):o:e.attr("placeholder"))}),$(".setting-go-regi").on("hover:enter",function(){t.accountCheckConnect(!0)}),$(".setting-go-login").on("hover:enter",function(){t.accountCheckConnect()}),t._displayServer(),s.is_android||"undefined"!=typeof process||"undefined"!=typeof webOS||$(".setting-noandoid").remove(),s.is_browser||"undefined"!=typeof androidApp||$(".setting-nobrowser").remove(),new r.Scrollbox(g).wheel(!0),s.is_android){if("undefined"!=typeof androidApp){try{var m=androidApp.getPlayersList();console.log("Settings","get players list:",m),i.android_player={inner:"内置"},i.android_player_torrent={inner:"内置"};for(var _=JSON.parse(m),y=0;y<_.length;y++){var w=_[y];i.android_player[w.first||w.e]=w.second||w.f,i.android_player_torrent[w.first||w.e]=w.second||w.f}t.updateValue("android_player"),t.updateValue("android_player_torrent")}catch(e){}androidApp.parseUrl&&$(".settings-enable-parsing").removeClass("hide")}}else"undefined"!=typeof process?(i.android_player={inner:"内置",vlc:"VLC",custom:"自定义"},i.android_player_torrent={inner:"内置",vlc:"VLC",custom:"自定义"},t.updateValue("android_player"),t.updateValue("android_player_torrent")):"undefined"!=typeof webOS&&(i.android_player={inner:"内置",webos:"webOS"},i.android_player_torrent={inner:"内置",webos:"webOS"},t.updateValue("android_player"),t.updateValue("android_player_torrent"));"undefined"==typeof webOS&&$(".webos_input",u).remove(),"undefined"==typeof process&&$(".webkit-custom-player",u).remove()},r.History=function(){var e,t=this,i=!0,n=0;window.addEventListener("popstate",function(e){s.Splash.reset(),t._tree(-1),e.state&&(t._timer(),console.log("History","popstate:",e.state.url),t.dispatchEvent({type:"back",url:e.state.url,state:e.state}),e.state.started&&(Date.now()-n>1e3&&($.notify("这是开始页面，按两次返回退出",{className:"info"}),t.fake()),n=Date.now()))}),this._timer=function(){i=!1,clearTimeout(e),e=setTimeout(function(){i=!0},100)},this._tree=function(e,t){},this.fake=function(e){(console.log("History","fake:",e),e)?e!==(window.history.state?window.history.state.name:"")&&(window.history.pushState({url:"",name:e,fake:!0},"",""),this._tree(1,e)):(window.history.pushState({url:"",fake:!0},"",""),this._tree(1))},this.fakeClear=function(){window.history.state&&window.history.state.fake&&window.history.back()},this.push=function(e){if(console.log("History","push:",e,i),i){var n=window.history.state;n&&(n.fake||n.url==e)?(window.history.replaceState({url:e},"",""),this._tree(0,e)):(window.history.pushState({url:e},"",""),this._tree(1,e)),t.dispatchEvent({type:"push",url:e})}i=!0},this.back=function(){console.log("History","custom trigger back"),window.history.back(),this._timer()}},r.Upload=function(){var e,t,i=this,n=$("#upload"),o=$("> div",upload),a=$("#upload-files"),c=$(".up-timis",n),d=$("#upload-error-msg"),u={},p="",f=0,g={};this.showMyTorrents=function(){var t=s.Settings.get("server");e="http://"+t,s.Settings.serverCheckConnect(function(e,t){"server"==t&&(e?(i._getMyTorrents(),h.helper("mytorrent","向下箭头到删除种子")):s.Modal.open(s.Template.get("torrent_faq"),"需要 Torserve","content"))})},this._getMyTorrents=function(){var t=JSON.stringify({action:"list"});s.torrserver_new?s.Reguest.silent(e+"/torrents",function(e){e.length?i._buildMyTorrents(e):i._showMyTorrentEmpty()},function(){$.notify("未连接到服务器",{className:"error"})},t):s.Reguest.silent(e+"/torrent/list",function(e){e.length?i._buildMyTorrents(e):i._showMyTorrentEmpty()},function(){$.notify("未连接到服务器",{className:"error"})},t)},this._showMyTorrentEmpty=function(){s.Reguest.dispatchEvent({type:"load:start"}),setTimeout(function(){s.Reguest.dispatchEvent({type:"load:before_complite"}),s.Interface.lastSet(""),s.History.push("");var e=$("#content"),t=s.Template.get("my_torrents_empty",{});e.append(t),s.Hover.update(),s.Reguest.dispatchEvent({type:"load:after_end"}),s.Controller.add("content",{toggle:function(){s.SpatialNavigator.setCollection()},up:function(){s.Controller.toggle("head")},left:function(){s.Controller.toggle("menu")},back:function(){s.Controller.toggle("menu")},touchLeft:function(){s.Controller.trigger("left")}}),s.Controller.toggle("content")},s.Settings.get("animation")?300:0)},this._buildMyTorrents=function(e){s.Reguest.dispatchEvent({type:"load:start"}),setTimeout(function(){s.Reguest.dispatchEvent({type:"load:before_complite"}),s.Interface.lastSet(""),s.History.push("");var t,a=$("#content"),l=s.Template.get("cards",{title:"我的种子"}),c=new r.Swipe(l.find(".b-swipe"),{});$.each(e,function(e,l){var d=s.Template.get("swipe_slide",{}),u=new r.Card({name:l.title||l.Name,torrent:!0,poster:l.poster.replace("image.tmdb.org","proxy.vokino.tv/image"),released:""});u.template.find(".selector").on("hover:enter",function(){p=l.hash||l.Hash;g={name:l.title||l.Name,poster:l.poster.replace("image.tmdb.org","proxy.vokino.tv/image"),nodelete:!0,hash:l.hash||l.Hash,magnet:l.hash||l.Hash,tags:[]};$(".up-title",n).text(l.title);o.hide();if(("undefined"!=typeof androidApp&&s.is_android||s.is_browser)&&s.Settings.get("player_magnet"))s.Player.runNative("magnet:?xt=urn:btih:"+g.magnet);else{s.Controller.toggle("upload");i._getFiles()}o.eq(0).show()}).on("hover:active",function(){t=$(this),c.slideTo(a.find(".selector").index(t))}).attr("data-image","").attr("data-hash",l.hash||l.Hash),d.append(u.template),c.elem_wrap.append(d),u.visibility()}),a.append(l),c.update(),s.Hover.update(),s.Reguest.dispatchEvent({type:"load:after_end"}),s.Controller.add("content",{toggle:function(){s.History.fake("mytorrents");var e=a.find(".selector").toArray();s.SpatialNavigator.setCollection(e),s.SpatialNavigator.focus((t||e)[0])},up:function(){s.Controller.toggle("head")},left:function(){s.SpatialNavigator.canmove("left")?s.SpatialNavigator.move("left"):s.Controller.toggle("menu")},right:function(){s.SpatialNavigator.move("right")},back:function(){s.Controller.toggle("menu")},touchLeft:function(){s.Controller.trigger("left")},touchRight:function(){s.Controller.trigger("right")},wheelUp:function(){s.SpatialNavigator.move("left")},wheelDown:function(){s.Controller.trigger("right")},down:function(){s.Drop.open("删除种子?",[{title:"Да",selected:!0,status:!0},{title:"Нет"}],function(e){if(e.status){i.removeByHash(t.attr("data-hash"));var n=t.parents(".b-swipe__item"),o=n.next();n.remove(),o.length&&(s.Hover.update(),c.update(),t=o.find(".selector"))}},"content")}}),s.Controller.toggle("content")},s.Settings.get("animation")?300:0)},this.addToBase=function(e){if(h.serverConnected()){var i="http://"+s.Settings.get("server");t=JSON.stringify({action:"add",link:e.magnet,Link:e.magnet,title:"[VOKINO] "+e.title,poster:e.poster,save_to_db:!0,DontSave:!1}),s.torrserver_new?s.Reguest.silent(i+"/torrents",!1,!1,t):s.Reguest.silent(i+"/torrent/add",!1,!1,t,{dataType:"html"})}},this._getServer=function(){s.Reguest.need.timeout=15e3;var t=15;c.text("获取服务器列表 ("+t+")"),s.Reguest.silent(s.domain_url+"/tbit/servs",function(t){clearInterval(u.get_ports),t.length?(e="http://"+t[0].node+":5461",i._getFilesTbit()):t.error?i._customError(t.error):i._customError("对不起，服务器过载，请重试稍后")}),u.get_ports=setInterval(function(){t--,c.text("获取服务器列表 ("+t+")"),1==t&&i._customError("获取服务器列表失败")},1e3)},this._getWorkPort=function(t){var n,o=0,a=function(){c.text("服务器搜索: "+(o+1)+" / 6"),s.Reguest.need.timeout=4e3,s.Reguest.clear(),n=t.ports[o],i._getWorkServer("http://"+t.node+":"+n,function(){clearInterval(u.ports),e="http://"+t.node+":"+n,i._getFiles()}),++o>6&&(clearInterval(u.ports),i._customError("获取免费服务器失败"))};u.ports=setInterval(a,4e3),a()},this._getWorkServer=function(e,i){s.torrserver_new?s.Reguest.silent(e+"/torrents",function(e){e.hash&&(p=e.hash,g.hash=e.hash,i())},this._showError,t):s.Reguest.silent(e+"/torrent/add",function(e){e.length>10&&e.length<100&&(p=e,g.hash=e,i())},this._showError,t,{dataType:"html"})},this._getHash=function(t){if("ace"==s.Settings.get("server_use"))return this._getFilesAce();s.Reguest.need.timeout=2e4,s.torrserver_new?s.Reguest.silent(e+"/torrents",function(e){e.hash?(p=e.hash,g.hash=e.hash,i._getFiles()):i._customError("获取失败 HASH")},this._showError,t):s.Reguest.silent(e+"/torrent/add",function(e){e.length>10&&e.length<100?(p=e,g.hash=e,i._getFiles()):i._customError("获取失败 HASH")},this._showError,t,{dataType:"html"})},this._aceConvertFiles=function(e){var t=[];for(var i in e)t.push({path:e[i],id:i,length:0});this._showFiles(t)},this._getFilesAce=function(){f=0,c.text("90"),u.files=setInterval(function(){s.Splash.reset(),++f>=45&&(i._customError("超时"),i._remove()),c.text(90-2*f)},2e3),s.Reguest.clear(),s.Reguest.need.timeout=89e3,s.Reguest.silent(e+"/server/api?method=get_media_files&magnet="+encodeURIComponent(g.magnet),function(e){e.result?(clearInterval(u.files),i._aceConvertFiles(e.result)):i._customError(h.capitalizeFirstLetter(e.error))},i._showError)},this._getFilesTbit=function(){f=0,c.text("90"),u.files=setInterval(function(){f++,s.Splash.reset(),f>=45&&(i._customError("超时"),i._remove()),c.text(90-2*f)},2e3),s.Reguest.clear(),s.Reguest.timeout=9e4,s.Reguest.silent(e+"/api/files?magnet="+encodeURIComponent(g.magnet),function(e){clearInterval(u.files),e.length?i._showFiles(e):e.error&&i._customError(e.error)},i._showError)},this._getFiles=function(){f=0,c.text("90"),u.files=setInterval(function(){f++,s.Splash.reset(),s.Reguest.clear();var t=s.torrserver_new?"torrents":"torrent/stat";s.Reguest.need.timeout=2e3,s.Reguest.silent(e+"/"+t,function(e){e.FileStats&&(clearInterval(u.files),i._showFiles(e.FileStats)),e.file_stats&&(clearInterval(u.files),i._showFiles(e.file_stats))},!1,JSON.stringify({action:"get",hash:p,Hash:p})),f>=45&&(i._customError("超时"),i._remove()),c.text(90-2*f)},2e3)},this._preparation=function(){s.SpatialNavigator.setCollection(),f=0,o.hide(),o.eq(2).show(),c.text("90"),$(".up-size").text("0"),$(".up-speed").text("0.0"),$(".up-pirs").text("0 / 0"),$(".up-buff").text("0% / 0 / 0"),$(".up-progress").width(0),h.isTbit()||s.Reguest.silent(g.url.replace("&play","&preload")),u.preparation=setInterval(function(){s.Splash.reset(),s.Reguest.clear();var t=s.torrserver_new?"torrents":"torrent/stat",n=e+"/"+t;h.isTbit()&&(n=g.stat_url),s.Reguest.silent(n,function(e){var t=e.total_peers||e.TotalPeers||e.available||0,n=e.connected_seeders||e.ConnectedSeeders||e.seeds||0,o=e.download_speed||e.DownloadSpeed||e.speed||0,a=e.torrent_size||e.TorrentSize||0,r=e.preloaded_bytes||e.PreloadedBytes||0,l=e.preload_size||e.PreloadSize||0;$(".up-pirs").text(n+"/"+t),h.isTbit()?$(".up-size").text(h.bytesToSize(a)):s.torrserver_new?$(".up-size").text(h.bytesToSize(e.file_stats&&e.file_stats[g.file_index]?e.file_stats[g.file_index].length:a)):$(".up-size").text(h.bytesToSize(e.FileStats&&e.FileStats[g.file_index]?e.FileStats[g.file_index].Length:a)),$(".up-speed").text(h.bytesToSize(o)+"/s");var c=Math.min(100,100*r/l);r>0&&l>0&&$(".up-buff").text(c.toFixed(2)+"% / "+h.bytesToSize(r)+" / "+h.bytesToSize(l)),$(".up-progress").css({width:c+"%"}),(c>=90||3==e.stat)&&i._play()},!1,JSON.stringify({action:"get",hash:p,Hash:p})),f>=45&&(i._customError("超时"),i._remove()),c.text(90-2*f)},2e3)},this._play=function(){clearInterval(u.preparation),o.hide(),o.eq(1).show(),s.Controller.toggle("upload"),g.server=e,g.from="upload",s.Player.play(g)},this._showError=function(e,t){s.Reguest.clear(),clearInterval(u.preparation),clearInterval(u.files),o.hide(),d.text(s.Reguest.errorDecode(e,t)),o.eq(3).show()},this._customError=function(e){this._showError({responseText:e},"custom")},this._toplay=function(t,n,o){g.url=n,g.format=t.attr("data-format"),g.file_index=t.attr("data-id"),g.ident=t.attr("data-ident"),g.use_old_player=!0,g.from="upload",g.server=e,g.playlist=o,g.torrent_player=!0,g.timeline=t.data("timeline"),g.timeline_call=function(){t.removeClass("notviewed").addClass("viewed")};var a=s.Settings.get("server_use");s.is_android?"server"==a&&s.Settings.get("player_prelod")?i._preparation():s.Player.play(g):("ace"==a&&(g.use_old_player=!1),s.Settings.get("player_prelod")?"ace"==a?s.Player.play(g):i._preparation():s.Player.play(g))},this._showFiles=function(t){o.hide(),a.empty();for(var n,c=[],d=0,u=0;u<t.length;u++){var f=t[u],v=f.Length||f.length||f.size||0,m=h.bytesToSize(v),_=(f.Path||f.path).split(".").pop().toLowerCase(),y=(f.Path||f.path).split("/").pop(),w=f.Id||f.id||0;if(-1!=s.video_formats.indexOf(_)){var b,C=s.Template.get("playlist_file",{id:w,name:y,size:m,format:"video/"+_});if(C.data("name",y),v||C.find(".b-playlist__size").remove(),s.is_touch){var S=$('<div class="b-playlist__copy-link"></div>');S.on("click",function(e){d=Date.now(),x(w)}),C.append(S)}if(a.append(C),"server"==s.Settings.get("server_use"))b=s.torrserver_new?e+"/stream?link="+p+"&index="+w+"&play":e+"/torrent/play?link="+p+"&file="+w,c.push({title:y,stream_url:b,index:u})}}if(1==c.length&&(c=[]),!(n=$(">*",a).length))return this._customError("文件列表为空");new r.Scrollbox(a),o.eq(1).show(),s.Hover.update();s.SpatialNavigator.setCollection(a.find(".selector").toArray()),s.SpatialNavigator.focus(a.find(".selector").toArray()[0]);var x=function(t,n){var o="";"ace"==s.Settings.get("server_use")?(s.Loader.show(),s.Reguest.need.timeout=5e3,s.Reguest.silent(e+"/ace/getstream?magnet="+encodeURIComponent(g.magnet)+"&_idx="+t+"&format=json",function(e){s.Loader.hide(),e.response&&(n?n(o):(h.copyToClipboard(e.response.playback_url),$.notify("复制到剪贴板",{className:"white"})))},i._showError)):(o=s.torrserver_new?e+"/stream?link="+p+"&index="+t+"&play":e+"/torrent/play?link="+p+"&file="+t,n?n(o=e+"/play/"+p+"/"+t):(h.copyToClipboard(o),$.notify("复制到剪贴板",{className:"white"})))};$(".selector",a).on("hover:enter",function(){var t,n=$(this),o=n.attr("idh");g.stat_url=!1,h.isTbit()?(s.Loader.show(),s.Reguest.need.timeout=5e3,t=e+"/api/stream?id="+n.attr("data-id")+"&magnet="+encodeURIComponent(g.magnet),h.isTbit()&&(t+="&preload=true"),s.Reguest.silent(t,function(t){s.Loader.hide(),t.error?$.notify(t.error,{className:"error"}):(g.stat_url=e+"/api/stat?id="+n.attr("data-id")+"&updateLastRequest=true&magnet="+encodeURIComponent(g.magnet),i._toplay(n,t.stream_url,[]))},i._showError)):"ace"==s.Settings.get("server_use")?(s.Loader.show(),s.Reguest.need.timeout=5e3,s.Reguest.silent(e+"/ace/getstream?magnet="+encodeURIComponent(g.magnet)+"&_idx="+n.attr("data-id")+"&format=json",function(e){s.Loader.hide(),e.response?(g.stat_url=e.response.stat_url,i._toplay(n,e.response.playback_url,c)):i._customError(e.error)},i._showError)):(h.isTbit()?(t=e+"/api/stream?id="+n.attr("data-id")+"&redirect=true&magnet="+p,g.stat_url=e+"/api/stat?id="+n.attr("data-id")+"&magnet="+p):t=s.torrserver_new?e+"/stream?link="+p+"&index="+n.attr("data-id")+"&play":e+"/torrent/play?link="+p+"&file="+n.attr("data-id"),g.webos_url=e+"/play/"+p+"/"+n.attr("data-id"),console.log("Upload","playlist:",c),i._toplay(n,t,c))}).on("hover:active",function(){h.scrollUpdate($(this))});var T=!0;if(s.Settings.get("upload_playlist")||1!=n||(T=!1),g.fid){var N="server"==s.Settings.get("server_use"),I=N?"torinfo":"aceInfo";s.Reguest.silent(s.domain_url+"/timeline/"+I+"?id="+g.fid+"&magnet="+encodeURIComponent(g.magnet),function(e){a.find("> div").addClass("notviewed");for(var t=0;t<e.length;t++){var i=e[t],n=N?s.torrserver_new?i.id:i.file:i.id,o=a.find('[data-id="'+(n||0)+'"]');o.length&&(o.attr("data-ident",i.ident).attr("idh",i.ident),i.timeline&&o.removeClass("notviewed").addClass("viewed").data("timeline",i.timeline),c[t]&&(c[t].ident=i.ident)),T||(g.ident=i.ident,g.timeline=i.timeline,s.Settings.get("player_prelod")||(s.is_android?s.Settings.get("player_default")&&Player._ident(g):Player._ident(g)))}})}else a.find("> div").addClass("notviewed");T||s.Controller.enter()},this._remove=function(){if(!g.nodelete&&s.Settings.get("upload_remove_db"))if(h.isTbit())s.Reguest.silent(e+"/api/ViewIsOver?magnet="+encodeURIComponent(g.magnet));else if(p){for(var t,i=s.Settings.get("server"),n=0;n<s.torrserver.length;n++)if(i.indexOf(s.torrserver[n])>=0){t=!0;break}if(!t){var o=s.torrserver_new?"torrents":"torrent/rem";s.Reguest.silent(e+"/"+o,!1,!1,JSON.stringify({action:"rem",hash:p,Hash:p}))}}},this.removeByHash=function(t){var i=s.torrserver_new?"torrents":"torrent/rem";s.Reguest.silent(e+"/"+i,!1,!1,JSON.stringify({action:"rem",hash:t,Hash:t}))},this._checkConnect=function(e){s.Loader.show(),s.Reguest.need.timeout=5,s.Reguest.need.disable_cache=!0,s.Settings.serverCheckConnect(e)},this._beforeStart=function(n){var o=s.Settings.get("server_use"),a=s.Settings.get(o);"server"==o&&s.torr_uapi.indexOf(a)>=0?(n(!0),i._getServer()):(e="http://"+a,"127.0.0.1"==a.substr(0,9)?(s.Loader.show(),s.Reguest.need.timeout=5,s.Reguest.need.disable_cache=!0,s.Settings.serverCheckConnect(function(e,a){a==o&&(s.Loader.hide(),e?(n(!0),i._getHash(t)):s.is_android&&!e?n():$.notify("没有连接到服务器",{className:"error"}))})):(n(!0),i._getHash(t)))},this.start=function(e){if(clearInterval(u.preparation),clearInterval(u.files),!s.Settings.get(s.Settings.get("server_use")))return s.Modal.open(s.Template.get("torrent_faq"),"需要 Torserve","content");g=e,p="";var i=s.Settings.get("upload_remove_db");t=JSON.stringify({action:"add",link:g.magnet,Link:g.magnet,title:g.title,poster:g.poster,save_to_db:!i,DontSave:i}),this._beforeStart(function(e){e?(s.Controller.toggle("upload"),$(".up-title",n).text(g.title),o.eq(0).show()):($("#player-play-native").attr("href",g.magnet),$("#player-play-native")[0].click())})},this.exit=function(){s.Reguest.clear(),clearInterval(u.preparation),clearInterval(u.files),clearInterval(u.ports),clearInterval(u.get_ports),i._remove(),h.animOut(n,function(){o.hide()}),p="",g={}},this.show=function(){n.is(":visible")?"playlist"==$("> div:visible",n).data("step")&&(s.SpatialNavigator.setCollection(a.find(".selector").toArray()),s.SpatialNavigator.focus(a.find(".hover").toArray()[0])):(o.hide(),h.animIn(n))},this.jump=function(e){var t=a.find(".selector.hover");(t=(t=(t=e?t.nextAll().filter(".selector"):t.prevAll().filter(".selector")).slice(0,10)).last()).length&&(s.SpatialNavigator.focus(t[0]),h.scrollUpdate(a.find(".selector.hover")))},s.Controller.add("upload",{toggle:function(){n.is(":visible")||s.History.fake(),s.SpatialNavigator.setCollection(),i.show()},back:function(){i.exit(),s.Controller.toggle("content")},up:function(){s.SpatialNavigator.move("up")},down:function(){s.SpatialNavigator.move("down")},enter:function(){var e=$("> div:visible",n).data("step");"playlist"==e?s.Hover.enter():"upload"==e&&i._play()},wheelUp:function(){s.SpatialNavigator.move("up")},wheelDown:function(){s.SpatialNavigator.move("down")},right:function(){i.jump(!0)},left:function(){i.jump(!1)}}),n.on("click",function(e){$(e.target).closest($(".b-upload__body")).length||(i.exit(),s.Controller.toggle("content"))}),$(".b-upload__continue").on("click",function(){s.Controller.enter()})},r.Convert=function(e){},r.Convert.prototype={main:function(e){e.items=[];for(var t=0;t<e.main.length;t++)e.items.push(e.main[t]);return e},view:function(e){return e.type="full",d.extend(e.details,{director:"",cast:"",duration:"--:--:--"}),e},category:function(e){e.items=[];for(var t=0;t<e.channels.length;t++)e.items.push(e.channels[t]);return e},list:function(e){for(var t={title:e.title||"过滤器",items:[],page:e.page,id:e.id,viewed:e.viewed},i={type:"list",origtype:e.type,items:[t]},n=0;n<e.channels.length;n++)t.items.push(e.channels[n]);return i},casts:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],o={details:n,playlist_url:n.playlist_url};n.about=n.biography||"",n.name=n.title,n.released=n.birthday||"未知",n.country=n.place_of_birth||"未知",n.genre=1==n.gender?"女性":2==n.gender?"男性":"未知",n.iscast=!0,t.push(o)}return t},torrents:function(e){return d.extend(e,{details:{}}),e},compilations:function(e){return s.Settings.get("interface_vertical")&&window.innerWidth>950?this.list(e):e},side:function(e){for(var t=[],i=0;i<e.menu.length;i++){var n,o={title:((n=e.menu[i]).title||"排序").split(":")[0],items:n.submenu};t.push(o)}return t}},r.Interface=function(){var e,t,i=this;this.remove=function(){e&&e.remove()},this.create=function(t,i){var n="Interface"+t[0].toUpperCase()+t.slice(1);s.Settings.get("interface_vertical")&&window.innerWidth>950&&("InterfaceCategory"!=n&&"InterfaceList"!=n&&"InterfaceCompilations"!=n||(n="InterfaceCategoryVertical")),(e=new r[n](i)).initial()},this.load=function(e,n){(t!=e||n)&&(t=e,i.dispatchEvent({type:"startload",url:e}),s.Reguest.get(e,function(t){n&&s.State.clear(),t.type&&(t=s.Convert[t.type](t)),i.create(t.type,t),i.dispatchEvent({type:"load",url:e,panel_type:t.type,data:t})},function(){}))},window.load=function(e,n){(t!=e||n)&&(t=e,i.dispatchEvent({type:"startload",url:e}),s.Reguest.get(e,function(t){n&&s.State.clear(),t.type&&(t=s.Convert[t.type](t)),i.create(t.type,t),i.dispatchEvent({type:"load",url:e,panel_type:t.type,data:t})},function(){}))},this.last=function(){return t},this.lastSet=function(e){t=e},this.loadTizenRecomend=function(){var e=!1;try{var t=tizen.application.getCurrentApplication().getRequestedAppControl();if(t){for(var i=t.appControl.data,n=0;n<i.length;n++)if("PAYLOAD"==i[n].key){var o=JSON.parse(i[n].value[0]).values;o&&(e=!0,s.Interface.load(o))}}else console.log("Tizen","no req app control")}catch(e){}return e}},r.Panel=function(e){this.data=e},r.Panel.prototype={hover:function(){},remove:function(){s.Hover.removeEventListener("hover:active",this.hover)},initial:function(){s.Hover.addEventListener("hover:active",this.hover.bind(this))}},r.InterfaceMain=function(e){r.Panel.call(this,e),this.items=[],this.templates={}},r.InterfaceMain.prototype=Object.assign(Object.create(r.Panel.prototype),{constructor:r.InterfaceMain,position:0,initial:function(){r.Panel.prototype.initial.call(this);var e=this;this.templates.content=s.Template.get("swipe_vertival",{}),this.templates.wrap=$(".b-swipe__wrap",this.templates.content);for(var t=0;t<this.data.items.length;t++)this.line(this.item(this.data.items[t]));this.swipe=new r.Swipe(this.templates.content,{orintation:"vertical",effect:"scaled",navigation:!0}),$("#content").append(this.templates.content),$(".b-swipe__wrap:eq(0) .e-card__acens",this.templates.content).eq(0).addClass("selector-start"),s.Controller.add("content",{toggle:function(){s.History.fake("content"),s.SpatialNavigator.setCollection(),e.items[e.position].toggle()},back:function(){s.Controller.toggle("menu")}}),this.position=s.State.get(s.Interface.last(),{position:0}).position,s.History.fake("content")},toggle:function(){s.Controller.toggle("content")},line:function(e){var t=s.Template.get("swipe_slide");t.append(e.templates.content),this.templates.wrap.append(t),this.items.push(e)},up:function(){this.position>0?(this.position--,this.items[this.position].toggle(),s.State.set(s.Interface.last(),{position:this.position})):s.is_touch||s.Controller.toggle("head")},down:function(){this.position<this.items.length-1&&(this.items[this.position].templates.foot.hide(),this.position++,s.State.set(s.Interface.last(),{position:this.position}),this.items[this.position].toggle(),this.visibility())},enter:function(){var e=this.items[this.position].index;this.swipe.slideTo(e),this.position=e,s.State.set(s.Interface.last(),{position:this.position})},item:function(e){e.is_category=this.is_category,e.from_cache=this.data.from_cache;var t="Cards";this.is_present&&(t="Present");var i=new r[t]($(this),e);return i.index=this.items.length,i.mousenter(),i.addEventListener("card:hover",this.enter.bind(this)),i.addEventListener("move:up",this.up.bind(this)),i.addEventListener("move:down",this.down.bind(this)),i.addEventListener("append:items",this.toggleCardsComplite.bind(this,i)),i.addEventListener("replace:items",this.toggleCardsComplite.bind(this,i)),i},visibility:function(){var e=this;setTimeout(function(){window.innerWidth<950?d.walk(e.items,"visibility"):d.walk(e.items.slice(e.position,e.position+2),"visibility")},s.Settings.get("animation")?300:0)},toggleCardsComplite:function(e){e.index==this.position&&(s.Hover.update(),e.toggle()),this.visibility()},hover:function(e){},remove:function(e){d.walkReverse(this.items,"remove"),this.items=null}}),r.InterfaceCategory=function(e){r.Panel.call(this,e),this.items=[],this.templates={}},r.InterfaceCategory.prototype=Object.assign(Object.create(r.InterfaceMain.prototype),{constructor:r.InterfaceCategory,is_category:!0,up:function(){this.position>0?(this.position--,this.items[this.position].toggle()):s.Controller.toggle("head")},down:function(){this.position<this.items.length-1&&(this.items[this.position].templates.foot.hide(),this.position++,this.items[this.position].toggle())}}),r.InterfaceList=function(e){r.Panel.call(this,e),this.items=[],this.templates={}},r.InterfaceList.prototype=Object.assign(Object.create(r.InterfaceMain.prototype),{constructor:r.InterfaceList,up:function(){s.Controller.toggle("head")},down:function(){}}),r.InterfaceFull=function(e){r.Panel.call(this,e),this.items=[],this.templates={},this.swipes={},this.last={},this.watch,this.need_side=false,this.need_season_only=false},r.InterfaceFull.prototype=Object.assign(Object.create(r.Panel.prototype),{constructor:r.InterfaceFull,_start:function(){var e=this,t=this.data.bookmarks,i=this.data.details;this.templates.start=s.Template.get("full_start",i);if(this.data.lastWatch){var n=d.getKeys(this.data.lastWatch),o=this.data.lastWatch[n[0]];if(n.length&&o){this.templates.start.find(".b-start__wathed").text("S-"+n[0]+" E-"+o).removeClass("hide")}}if(i.rating_imdb)this.templates.start.find(".b-start__ratings").append(h.stars(i.rating_imdb,i.rating_kp));if(this.data.online){$(".play",this.templates.start).on("hover:enter",function(){e.need_season_only=false;if(s.auth){e.showFiles("online");h.helper("online","按住 OK 菜单")}else e.noauth_helper()})}else $(".play",this.templates.start).remove();if(this.data.torrents){$(".torrents",this.templates.start).on("hover:enter",function(){if(s.auth){e.showFiles("torrents");h.helper("torrents","按住 OK 菜单")}else e.noauth_helper()})}else{$(".torrents",this.templates.start).remove()}if(i.trailers){$(".trailer",this.templates.start).on("hover:enter",function(){for(l=0;l<i.trailers.length;l++){i.trailers[l].title=i.trailers[l].name}s.Drop.open("预告片",i.trailers,function(action){new r.YouTube(action.id).play()},"content")})}else{$(".trailer",this.templates.start).remove()}$(".bookmark",this.templates.start).on("hover:enter",function(){if(!s.auth)return e.noauth_helper();s.Reguest.silent(t.watch?t.remove:t.add);t.watch=!t.watch;$.notify(t.watch?"添加":"删除",{className:"white"});$(this).find("span").text(t.watch?"删除":"已收藏")}).find("span").text(t&&t.watch?"隐藏":"已收藏");$(".selector",this.templates.start).on("hover:active",function(){e.last.start=$(this)[0]});this.item(this.templates.start)},noauth_helper:function(){return s.Modal.open(s.Template.get("noauth_faq"),"您需要注册或登录","content")},_descrTags:function(e,t){if(e){var i=this,n=s.Template.get("full_descr_tags",{title:t}),o=n.find(".b-descr__tags");$.each(e,function(e,t){var n=$('<div><div class="selector">'+t.title+"</div></div>");n.find(".selector").on("hover:active",function(){i.last.descr=$(this)}).on("hover:enter",function(){s.Interface.load(t.playlist_url)}),o.append(n)}),this.templates.descr.append(n)}},_descr:function(){var e=this;this.templates.descr=s.Template.get("full_descr",{about:h.substr(this.data.details.about,1e3)}),this._descrTags(this.data.genres,"类型"),this._descrTags(this.data.directors,"导演"),this._descrTags(this.data.countrys,"国家"),this.item(this.templates.descr),new r.Scrollbox(this.templates.descr),this.templates.descr.find(".selector").on("hover:active",function(){h.scrollUpdate(e.templates.descr.find(".selector.hover"),!0)})},_simular:function(){if(this.data.similars){this.simulars=new r.Cards(!1,{items:this.data.similars}),this.simulars.index=1,this.simulars.templates.content.find(".selector").attr("data-image","");var e=this.item(this.simulars.templates.content.addClass("b-cards--offset"),"建议");window.innerWidth<950&&e.addClass("auto-height"),e.data("method","simulars")}},_casts:function(){if(this.data.casts){this.data.casts=s.Convert.casts(this.data.casts),this.casts=new r.Cards(!1,{items:this.data.casts}),this.casts.templates.content.find(".selector").attr("data-image","");var e=this.item(this.casts.templates.content.addClass("b-cards--offset"),"演员");window.innerWidth<950&&e.addClass("auto-height"),e.data("method","casts")}},showFiles:function(e){if(this.simulars&&this.simulars.templates.foot.hide(),this.swipes.content.toLast(),this.watch!==e){s.Loader.show();var online_keys=d.getKeys(this.data.online);var t=this.last.balanser||online_keys[0];if(s.Settings.get("sortOnline")&&t!=this.last.balanser){for(i=0;i<online_keys.length;i++){if(online_keys[i].indexOf(s.Settings.get("sortOnline"))>-1){t=online_keys[i]}}}this._getFiles("torrents"==e?s.Settings.get("sortTorrents")?this.data.torrents.replace("sortings=","sortings="+s.Settings.get("sortTorrents")):this.data.torrents:this.data.online[t],e)}this.toggle_files(),this.watch=e,this.need_side=!0,s.SpatialNavigator.move("right")},_files:function(e){this.templates.files=s.Template.get("full_files",this.data.files),this.templates.side=$(".b-side",this.templates.files),this.templates.list=$(".b-files__body",this.templates.files),this.templates.side_inner=$("#files-sort-side",this.templates.side),this.templates.list_inner=$("#files-list-side",this.templates.list),this.item(this.templates.files)},_videoDetails:function(e,t){var i=this.data.details;return{url:e,poster:i.poster,name:t||i.name,tags:[i.released,i.country]}},_move_left:function(){if(s.SpatialNavigator.canmove("left"))return s.SpatialNavigator.move("left"),!0;s.Controller.toggle("menu")},_move_toup:function(){this.swipes.content.slideTo(0),this._toggle()},_getSide:function(e){s.Reguest.silent(e,this._bindSide.bind(this))},_getFiles:function(e,t){var i=this,n="_bindFiles"+h.capitalizeFirstLetter(t);s.is_android,s.Reguest.silent(e,function(o){if(0==d.getKeys(o).length)if(s.android_app&&androidApp.parseUrl&&-1==e.indexOf("failed=true"))e+="&failed=true",setTimeout(function(){s.Loader.show()},0),i._getFiles(e,t);else{var a=s.Settings.get("animation");a&&i.templates.files.removeClass("load-in").addClass("load-out"),setTimeout(function(){i.templates.list_inner.empty(),a&&i.templates.files.removeClass("load-out").addClass("load-in"),i._emptyList(),i._bindSide({menu:[]}),s.Hover.update(),i.templates.list.scrollTop(0),i.toggle_files()},a?300:0)}else o.type&&"parse"==o.type?(setTimeout(function(){s.Loader.show()},0),o.failed=e+"&failed=true",i._parseResult(o)):i[n](o)})},_parseResult:function(e){var t=this,i=function(){androidApp.wait_parse=!1,clearInterval(s.intervals.parse),t._getFiles(e.failed,"online"),s.Console.add("Parse","failed")};console.log("Parse","start");try{androidApp.version?androidApp.parseUrl(e.method||"GET",e.url,JSON.stringify(e.headers||{}),e.post||"",!1):androidApp.parseUrl(e.method||"GET",e.url,JSON.stringify(e.headers||{}),e.post||""),androidApp.wait_parse=!0;var n=Date.now();s.intervals.parse=setInterval(function(){var o="";try{o=androidApp.getResultData()}catch(e){o="error",console.log("Parse","callback error:",e.message)}console.log("Parse","callback responce:",(o||"").length),"error"==o?i():o?(androidApp.wait_parse=!1,clearInterval(s.intervals.parse),s.Reguest.silent(e.sendto,function(i){"parse"==i.type?(setTimeout(function(){s.Loader.show()},0),i.failed=e.failed,t._parseResult(i)):t._bindFilesOnline(i)},function(){i()},{html:o}),console.log("Parse","send result")):Date.now()-n>4e4&&i()},1e3)}catch(e){i()}},_bindSide:function(e,t){var i=this,n=s.Convert.side(e);i.last.side=!1,i.need_side=!1,i.templates.side_inner.empty();for(var o=!1,a=0;a<n.length;a++)"季"==n[a].title&&(o=!0);if(this.data.online&&"online"==i.watch){var l={title:"来源",items:[]};var online_keys=d.getKeys(this.data.online);var c=this.last.balanser||online_keys[0];if(s.Settings.get("sortOnline")&&c!=this.last.balanser){for(k=0;k<online_keys.length;k++){if(online_keys[k].indexOf(s.Settings.get("sortOnline"))>-1){c=online_keys[k]}}}for(var a in this.data.online)l.items.push({title:a,playlist_url:this.data.online[a],balanser:a}),c==a&&(l.items[l.items.length-1].selected=!0);if(n.unshift(l),t){if(!o){l={title:"季",items:[{title:"所有季",season_select:!0,value:-1,selected:-1==i.need_season_only||-1==s.Settings.get("season_select")}]};var u=i._getLatestViewsSeason(e);for(a=0;a<e.channels.length;a++){var p=e.channels[a];l.items.push({title:p.title,season_select:!0,selected:!1!==i.need_season_only&&i.need_season_only==a,value:a})}!1===i.need_season_only&&s.Settings.get("season_select")>=0&&(l.items[u+1].selected=!0),n.push(l)}var f=s.Settings.get("order");l={title:"订单",items:[{title:"标准",value:"",is_order:!0,selected:""==f},{title:"反转季",value:"seson",is_order:!0,selected:"seson"==f},{title:"反转剧集",value:"serial",is_order:!0,selected:"serial"==f}]},n.push(l)}}var g=s.Reguest.latest();if($.each(n,function(e,t){var n=s.Template.get("side_box",t),o=h.hashCode(t.title),a=(s.cache.sideselect[o],function(e,t){for(var i,n=0;n<e.length;n++){var o=e[n];if(o.hash=h.hashCode(o.title),o.hash==t){i=o;break}o.selected&&(i=o)}return i||(i=e[0]),i}(t.items)),r=s.Template.get("side_item",a);r.attr("data-id",a.hash),r.on("hover:enter",function(){for(var e=0;e<t.items.length;e++)t.items[e].selected=!1;a.selected=!0,s.Drop.open(t.title,t.items,function(e){e.hash,a=e,e.balanser&&(i.last.balanser=e.balanser),r.find(".b-playlist__name").text(e.title),r.attr("data-id",e.hash),i.last.side_id=e.hash,s.Loader.show(),e.balanser&&(i.need_season_only=!1),e.is_order?(s.Settings.change("order",e.value),s.Reguest.again(g)):e.season_select?(s.Settings.change("season_select",e.value),i.need_season_only=e.value,s.Reguest.again(g)):i._getFiles(e.playlist_url,i.watch)})}).on("hover:active",function(){i.last.side=$(this)[0],i.last.side_id=$(this).attr("data-id")}),$(".b-side__list",n).append(r),i.templates.side_inner.append(n)}),"online"==i.watch&&$(">",i.templates.side_inner).last().find(".selector").on("hover:enter",function(){i.last.balanser=$(this).text()}),i.last.side_id){var v=i.templates.side_inner.find('[data-id="'+i.last.side_id+'"]');v.length&&(i.last.side=v[0])}window.innerWidth>950&&new r.Scrollbox(this.templates.side)},_emptyList:function(){var e=s.Template.get("empty",{});e.find(".selector").on("hover:enter",function(){s.Loader.show(),s.Reguest.again()}),this.templates.list_inner.append(e)},_fileTimeline:function(e,t,i){if(!i||t.current)if($(".tp",e).hide(),t)if(e.addClass("viewed"),t.webplayer){$(".t-2",e).show();var n=Math.round(t.current/t.time*100)+"%";$(".t-view",e).text((t.current+"").toHHMMSS()),$(".t-total",e).text((t.time+"").toHHMMSS()),$(".t-percent",e).text(n),$(".progress",e).css({width:n})}else t.current?$(".t-1",e).show():$(".t-0",e).show();else $(".t-0",e).show()},_filesOrder:function(){},_getLatestViewsSeason:function(e){var t=0,i=false,n=function(e,n){n.timeline&&e>=t&&(t=e,i=true)};return $.each(e.channels,function(e,t){if(t.submenu)for(var i=0;i<t.submenu.length;i++)n(e,t.submenu[i]);else n(e,t)}),i||(t="seson"==s.Settings.get("order")?e.channels.length-1:0),t},_bindFilesOnline:function(e,t){d.extend(e,{channels:[],menu:[]});var i=this,n=s.Settings.get("animation"),o,a=e.channels.length&&e.channels[0].submenu;this._bindSide(e,a),e.details||(e.details={}),i.last.file=!1,n&&i.templates.files.removeClass("load-in").addClass("load-out"),setTimeout(function(){i.templates.list_inner.empty(),n&&i.templates.files.removeClass("load-out").addClass("load-in");var t=0,l=[],c=function(n,a){var r;a?(n.quality=n.quality||e.details.quality||"---",r=i.data.details.name+" - "+n.title):(n.quality=n.title||e.details.quality,n.title=i.data.details.name,r=n.title),n.title=n.title.replace(/<[^>]+>/g,""),r=r.replace(/<[^>]+>/g,""),n.quality_name=e.details.quality||"未知",n.quality=h.quality(n.quality);var c=s.Template.get("file_video",n);if(n.extra){c.find(".e-file__body").append('<div class="e-file__content"><ul class="e-file__details"></ul></div>');c.find(".e-file__content").css("display","block");var to_append=c.find(".e-file__details");if(n.extra.size){to_append.append("<li><div>大小</div><div>"+n.extra.size+"</div></li>");i.data.details.runtime&&to_append.append("<li><div>比特率</div><div>"+h.calcBitrate(n.extra.originalsize,i.data.details.runtime)+" Мб/с</div></li>")}}var init_player=function(is_socket){var t=c.data("timeline"),o=i._videoDetails(n.stream_url,r);o.url_proxy=n.proxy_url;o["native"]=n.android_player_choosen?false:s.Settings.get("player_default");o.ident=n.ident;o.timeline=t||n.timeline;n.audioinfo_url&&(o.audioinfo_url=n.audioinfo_url);o.subtitles=n.subtitles;o.window=n.window;o.need_parse=n.inpars;o.vimu_playlist=l;o.android_player_choosen=n.android_player_choosen;s.Player.video(o,!!a&&e.channels)};c.addClass("online-file"),c.attr("idh",n.ident),c.attr("se",t+":"+(n.index+1)),a&&c.append('<div class="e-file__season">S'+t+":E"+(n.index+1)+"</div>"),h.fileTimeline(c,n.timeline),"1"==e.details.camrip&&c.find(".e-file__meta").append('<li class="i"><img src="'+s.domain_web+'/img/icons/camrip.svg" /></li>'),"1"==e.details.ads&&c.find(".e-file__meta").append('<li class="i"><img src="'+s.domain_web+'/img/icons/ads.svg" /></li>'),c.on("hover:active",function(e,t){i.last.file=$(this)[0]}).on("hover:enter",function(){n.android_player_choosen=false;init_player()}).on("hover:long",function(){var e=[{title:"观看",selected:!0,view:!0,vid:!0},{title:"未查看",selected:!0,noview:!0,vid:!0},{title:"复制链接",copy:!0}];if("undefined"!=typeof androidApp){var android_players=s.Settings.params.android_player;for(var player in android_players){if(player!="inner"&&player!="choice"&&player!="default"){e.push({title:'在播放器中启动 "'+android_players[player]+'"',player:player})}}}e.push({title:"取消",cancel:!0});s.Drop.open("动作",e,function(e){if(e.vid)n.ident&&h.setWath(e.view,n.ident);if(e.copy){h.copyToClipboard(n.stream_url),$.notify("复制到剪贴板",{className:"white"})}if(e.player){n.android_player_choosen=e.player;init_player()}if(e.together){n.android_player_choosen="inner";setTimeout(function(){init_player(true)},1e3)}},"files")});i.templates.list_inner.append(c)};if(e.channels.length?(a?-1==i.need_season_only||-1==s.Settings.get("season_select")?("seson"==s.Settings.get("order")&&e.channels[0].submenu&&(e.channels=e.channels.reverse()),l=e.channels):l=!1!==i.need_season_only?[e.channels[i.need_season_only]]:[e.channels[i._getLatestViewsSeason(e)]]:l=e.channels,$.each(l,function(e,n){if(t=n.index+1,n.submenu){"serial"==s.Settings.get("order")&&(n.submenu=n.submenu.reverse()),i.templates.list_inner.append(s.Template.get("file_category",{title:n.title}));for(var o=0;o<n.submenu.length;o++)c(n.submenu[o],!0)}else c(n)})):i._emptyList(),s.Hover.update(),i.templates.list.scrollTop(0),new r.Scrollbox(i.templates.list),i.toggle_files(),i.data.lastWatch){var u=d.getKeys(i.data.lastWatch),p=i.data.lastWatch[u[0]];if(u.length&&p){var f=i.templates.list_inner.find('[se="'+u[0]+":"+p+'"]');f.length&&(s.SpatialNavigator.focus(f[0]),setTimeout(function(){h.scrollUpdate(f,!0)},s.Settings.get("animation")?300:0))}}},n?300:1)},_bindFilesTorrents:function(e){var t=this,i=s.Settings.get("animation");t._bindSide(e),t.last.file=!1,i&&t.templates.files.removeClass("load-in").addClass("load-out");var n=h.isTbit(),o,a=h.cache("torrents_view",100,[]);setTimeout(function(){t.templates.list_inner.empty(),i&&t.templates.files.removeClass("load-out").addClass("load-in"),e.channels.length?$.each(e.channels,function(e,i){var r=s.Template.get("file_preload",{});r.addClass("torrent-file");var l=h.hashCode(i.magnet);t.templates.list_inner.append(r);var c=!1;r.on("scroll:view",function(){if(!c){c=!0;var e=i.createTime.split("T")[0];for(var u in d.extend(i,{voice:"---",subtitle:"---",video:"---",audio:"---",tags:[t.data.details.released||i.relased||"未知",t.data.details.country||"未知"],poster:t.data.details.poster,name:t.data.details.name||i.title,date:e,bitrate:"---",pir:0,sid:0,fid:t.data.details.id}),i.videoInfo)i[u]=h.substr(i.videoInfo[u],80);[i.voice,i.subtitle,i.video,i.audio].join("");!t.data.details.is_tv&&(i.bitrate=h.calcBitrate(i.size,t.data.details.runtime)+" Мб/с");var p=s.Template.get("file_torrent",i);r.append(p),r.addClass("torrent-file"),a.indexOf(l)>-1&&r.addClass("wathed"),r.hasClass("wathed")&&r.append('<div class="e-file__wathed"></div>'),r.on("hover:active",function(e,i){t.last.file=$(this)[0],s.is_touch||t.templates.list_inner.find(".e-file__content").hide(),r.find(".e-file__content").show()}).on("hover:enter",function(){if(!r.hasClass("wathed"))r.append('<div class="e-file__wathed"></div>');r.addClass("wathed");a.push(l);h.cache("torrents_view",100,[],a);(s.is_browser||s.is_android)&&s.Settings.get("player_magnet")?s.Player.runNative(i.magnet):s.is_browser&&!h.serverConnected()?s.Player.runNative(i.magnet):s.Upload.start(i)}).on("hover:long",function(){s.Drop.open(i.name,[{title:"添加到 (我的种子)",selected:!0,status:!0},{title:"取消标记 (打开)",noviewed:!0},{title:"复制播放列表链接 (.m3u)",copy_player:!0},{title:"取消"}],function(e){if(e.status){s.Upload.addToBase({magnet:i.magnet,poster:i.poster,title:i.title});$.notify("已添加",{className:"white"})}else if(e.copy_torrserver){var t="http://"+s.Settings.get("server")+"/playlistall/all.m3u";h.copyToClipboard(t);$.notify("复制到剪贴板",{className:"white"})}else e.copy_player?(h.copyToClipboard("http://"+s.Settings.get("server")+"/playlistall/all.m3u"),$.notify("复制到剪贴板",{className:"white"})):e.noviewed&&(d.remove(a,l),r.find(".e-file__wathed").remove(),r.removeClass("wathed"),h.cache("torrents_view",100,[],a))},"files")});s.is_touch&&r.find(".e-file__content").show();n&&i.flash&&r.append('<div class="e-file__flash"></div>')}})}):t._emptyList(),s.Hover.update(),t.templates.list.scrollTop(0),t.templates.list_inner.find(".e-file__content").show(),t._scrollableFiles(),new r.Scrollbox(t.templates.list),t.toggle_files()},i?300:1)},_scrollableFiles:function(){var e=this;e.templates.list.find(".e-file").slice(0,5).addClass("scrolled").trigger("scroll:view"),e.templates.list.on("scroll",function(){var t=e.templates.list.find(".e-file:not(.scrolled)"),i=e.templates.list.offset().top,n=2*e.templates.list.height();t.each(function(){var e=$(this);e.offset().top<i+n&&e.addClass("scrolled").trigger("scroll:view")})})},_getCollection:function(){return this.items[this.swipes.content.position].find(".selector").toArray()},_toggle:function(){var e=this.swipes.content.position;if(0==e)this.toggle_start();else if(1==e)this.toggle_descr();else if(this.swipes.content.isEnd)this.toggle_files();else{this["toggle_"+this.items[e].data("method")]()}s.History.fake("view")},_toggles:function(){var e=this;s.Controller.add("content",{toggle:function(){e.background(),s.History.fake("view"),0==e.swipes.content.position?(s.SpatialNavigator.setCollection(e._getCollection()),s.SpatialNavigator.focus(e.last.start||e._getCollection()[0])):e._toggle()},left:this._move_left,right:function(){s.SpatialNavigator.move("right")},up:function(){e.swipes.content.isStart?s.Controller.toggle("head"):e.swipes.content.slidePrev()},down:function(){e.swipes.content.slideNext(),e.toggle_descr()},wheelDown:function(){e.swipes.content.slideNext(),e.toggle_descr()},touchDown:function(){s.Controller.trigger("wheelDown")},touchLeft:function(){s.Controller.toggle("menu")},back:e.goback.bind(e)}),s.Controller.add("simulars",{toggle:function(){e.background();var t=$(".selector",e.simulars.templates.wrap).toArray();s.SpatialNavigator.setCollection(t),e.simulars._toLastSelect()||(s.SpatialNavigator.focus((e.simulars.last||t)[0]),e.simulars.visibility()),e.items[1].addClass("noview")},left:function(){s.SpatialNavigator.canmove("left")?(e.simulars.swipe.slidePrev(),s.SpatialNavigator.move("left")):s.Controller.toggle("menu")},right:function(){e.simulars.swipe.slideNext(),s.SpatialNavigator.move("right"),e.simulars.visibility()},up:function(){e.swipes.content.slidePrev(),e._toggle()},down:function(){e.swipes.content.position+1<e.swipes.content.total-1&&(e.swipes.content.slideNext(),e._toggle())},wheelUp:function(t){h.isCardsLine(t)?s.SpatialNavigator.canmove("left")&&(e.simulars.swipe.slidePrev(),s.SpatialNavigator.move("left")):s.Controller.trigger("up")},wheelDown:function(t){h.isCardsLine(t)?(e.simulars.swipe.slideNext(),s.SpatialNavigator.move("right"),e.simulars.visibility()):s.Controller.trigger("down")},touchDown:function(e){s.Controller.trigger("down")},touchUp:function(e){s.Controller.trigger("up")},touchLeft:function(){s.Controller.trigger("left")},touchRight:function(){s.Controller.trigger("right")},touchspeed:!0,back:e.goback.bind(e)}),s.Controller.add("casts",{toggle:function(){e.background();var t=$(".selector",e.casts.templates.wrap).toArray();s.SpatialNavigator.setCollection(t),e.casts._toLastSelect()||(s.SpatialNavigator.focus((e.casts.last||t)[0]),e.casts.visibility()),e.items[1].addClass("noview")},left:function(){s.SpatialNavigator.canmove("left")?(e.casts.swipe.slidePrev(),s.SpatialNavigator.move("left")):s.Controller.toggle("menu")},right:function(){e.casts.swipe.slideNext(),s.SpatialNavigator.move("right"),e.casts.visibility()},wheelUp:function(t){h.isCardsLine(t)?s.SpatialNavigator.canmove("left")&&(e.casts.swipe.slidePrev(),s.SpatialNavigator.move("left")):s.Controller.trigger("up")},wheelDown:function(t){h.isCardsLine(t)?(e.casts.swipe.slideNext(),s.SpatialNavigator.move("right"),e.casts.visibility()):s.Controller.trigger("down")},up:function(){e.swipes.content.slidePrev(),e._toggle()},down:function(){e.swipes.content.position+1<e.swipes.content.total-1&&(e.swipes.content.slideNext(),e._toggle())},touchDown:function(e){s.Controller.trigger("down")},touchUp:function(e){s.Controller.trigger("up")},touchLeft:function(){s.Controller.trigger("left")},touchRight:function(){s.Controller.trigger("right")},touchspeed:!0,back:e.goback.bind(e)}),s.Controller.add("files_side",{toggle:function(){e.background();var t=e.templates.side_inner.find(".selector").toArray();s.SpatialNavigator.setCollection(t),s.SpatialNavigator.focus(e.last.side||t[0]),h.scrollUpdate(e.templates.side.find(".selector.hover"),!0)},toup:this._move_toup.bind(this),left:function(){s.Controller.toggle("menu")},right:function(){e.toggle_files()},up:function(){s.SpatialNavigator.canmove("up")&&(s.SpatialNavigator.move("up"),h.scrollUpdate(e.templates.side.find(".selector.hover"),!0))},down:function(){s.SpatialNavigator.move("down"),h.scrollUpdate(e.templates.side.find(".selector.hover"),!0)},back:e.goback.bind(e)}),s.Controller.add("descr",{toggle:function(){e.background();var t=e._getCollection().splice(1);s.SpatialNavigator.setCollection(t),s.SpatialNavigator.focus((e.last.descr||t)[0]),e.items[1].removeClass("noview")},toup:this._move_toup.bind(this),left:function(){s.SpatialNavigator.canmove("left")?s.SpatialNavigator.move("left"):s.Controller.toggle("menu")},right:function(){s.SpatialNavigator.move("right")},up:function(){s.is_touch?s.Controller.trigger("wheelUp"):s.SpatialNavigator.canmove("up")?s.SpatialNavigator.move("up"):(e.swipes.content.slidePrev(),e._toggle())},down:function(){s.is_touch?s.Controller.trigger("wheelDown"):s.SpatialNavigator.canmove("down")?s.SpatialNavigator.move("down"):(e.casts||e.simulars)&&(e.swipes.content.slideNext(),e.items[1].addClass("noview"),e._toggle())},wheelDown:function(){h.scrollIsEnd(e.templates.descr)&&(e.casts||e.simulars)&&(e.swipes.content.slideNext(),e.items[1].addClass("noview"),e._toggle())},wheelUp:function(){h.scrollIsStart(e.templates.descr)&&(e.swipes.content.slidePrev(),e._toggle())},touchDown:function(){s.Controller.trigger("wheelDown")},touchUp:function(){s.Controller.trigger("wheelUp")},touchLeft:function(){s.Controller.toggle("menu")},back:e.goback.bind(e)}),s.Controller.add("files",{toggle:function(){e.background();var t=e.templates.list_inner.find(".selector").toArray();s.SpatialNavigator.setCollection(t),s.SpatialNavigator.focus(e.last.file||t[0]),e.items[1].addClass("noview")},left:function(){e.toggle_side()},toup:this._move_toup.bind(this),right:function(){var t=e.templates.files.find(".selector.hover");(t=(t=(t=t.nextAll().filter(".selector")).slice(0,3)).last()).length&&(s.SpatialNavigator.focus(t[0]),h.scrollUpdate(e.templates.files.find(".selector.hover"),"online"==e.watch))},up:function(){s.is_touch?h.scrollIsStart(e.templates.list)&&s.History.back():s.SpatialNavigator.canmove("up")?(s.SpatialNavigator.move("up"),h.scrollUpdate(e.templates.files.find(".selector.hover"),"online"==e.watch,"online"==e.watch&&s.Settings.get("animation"))):s.Controller.toggle("head")},down:function(){s.is_touch||(s.SpatialNavigator.move("down"),h.scrollUpdate(e.templates.files.find(".selector.hover"),"online"==e.watch,"online"==e.watch&&s.Settings.get("animation")))},wheelUp:function(){s.SpatialNavigator.canmove("up")?(s.SpatialNavigator.move("up"),h.scrollUpdate(e.templates.files.find(".selector.hover"),"online"==e.watch,"online"==e.watch&&s.Settings.get("animation"))):s.Controller.toggle("head")},wheelDown:function(){s.SpatialNavigator.move("down"),h.scrollUpdate(e.templates.files.find(".selector.hover"),"online"==e.watch,"online"==e.watch&&s.Settings.get("animation"))},touchLeft:function(){s.Controller.toggle("menu")},back:e.goback.bind(e)})},goback:function(){0==this.swipes.content.position?(this.exit||s.History.back(),this.exit=!0):(this.swipes.content.toFirst(),this._toggle())},background:function(){var e=this.swipes.content.position;if(e==0){s.Background.img_opacity=.5;s.Background.draw();s.Background.stop_rotate=false}else if(e==1){s.Background.img_opacity=.3;s.Background.draw();s.Background.stop_rotate=true}else{s.Background.img_opacity=.1;s.Background.draw();s.Background.stop_rotate=true}},swipeMove:function(){this.background();var e=this.swipes.content,t=e.elem_navigation;t.find("> div").last().hide();t.css({opacity:e.isEnd?0:1})},initial:function(){r.Panel.prototype.initial.call(this);this.templates.content=s.Template.get("swipe_vertival",{}).addClass("b-swipe--full-height");this.templates.wrap=$(".b-swipe__wrap",this.templates.content);this._start();this._descr();this._casts();this._simular();this._files();this.swipes.content=new r.Swipe(this.templates.content,{orintation:"vertical",mousewheel:!0,whell_up:"down",whell_down:"up",navigation:!0});this.swipes.content.addEventListener("move",this.swipeMove.bind(this));this.swipeMove();$("#content").append(this.templates.content);s.Background.rotate(this.data.details);this._toggles();s.Controller.toggle("content");setTimeout(this.toggle_start.bind(this),10)},toggle_side:function(){s.Controller.toggle("files_side")},toggle_descr:function(){s.Controller.toggle("descr")},toggle_files:function(){s.Controller.toggle("files")},toggle_start:function(){s.Controller.toggle("content")},toggle_simulars:function(){s.Controller.toggle("simulars")},toggle_casts:function(){s.Controller.toggle("casts")},item:function(e,t){var i=s.Template.get("swipe_slide",{});return t&&i.append('<div class="elem-name">'+t+"</div>"),i.append(e),this.templates.wrap.append(i),this.items.push(i),i},hover:function(e){e.elem.closest(this.swipes.content.elem_items.eq(this.swipes.content.position)).length&&(this.last["sel_"+this.swipes.content.position]=e.elem[0])},remove:function(e){this.items=null}}),r.InterfaceTorrents=function(e){r.Panel.call(this,e),this.templates={},this.items=[],this.last={},this.watch="torrents"},r.InterfaceTorrents.prototype=Object.assign(Object.create(r.InterfaceFull.prototype),{constructor:r.InterfaceTorrents,_toggles:function(){var e=this;s.Controller.add("content",{toggle:function(){s.History.fake("view"),e.toggle_files()},left:this._move_left,right:function(){s.SpatialNavigator.move("right")},up:function(){},down:function(){},back:e.goback.bind(e)}),s.Controller.add("files_side",{toggle:function(){var t=e.templates.side_inner.find(".selector").toArray();s.SpatialNavigator.setCollection(t),s.SpatialNavigator.focus(e.last.side||t[0]),h.scrollUpdate(e.templates.side.find(".selector.hover"),!0)},left:function(){s.Controller.toggle("menu")},right:function(){e.toggle_files()},up:function(){s.SpatialNavigator.canmove("up")?(s.SpatialNavigator.move("up"),h.scrollUpdate(e.templates.side.find(".selector.hover"),!0)):s.Controller.toggle("head")},down:function(){s.SpatialNavigator.move("down"),h.scrollUpdate(e.templates.side.find(".selector.hover"),!0)},back:e.goback.bind(e)}),s.Controller.add("files",{toggle:function(){var t=e.templates.list_inner.find(".selector").toArray();s.SpatialNavigator.setCollection(t),s.SpatialNavigator.focus(e.last.file||t[0])},left:function(){e.toggle_side()},right:function(){var t=e.templates.files.find(".selector.hover");(t=(t=(t=t.nextAll().filter(".selector")).slice(0,3)).last()).length&&(s.SpatialNavigator.focus(t[0]),h.scrollUpdate(e.templates.files.find(".selector.hover"),"online"==e.watch))},up:function(){s.SpatialNavigator.canmove("up")?(s.SpatialNavigator.move("up"),h.scrollUpdate(e.templates.files.find(".selector.hover"),"online"==e.watch)):s.Controller.toggle("head")},down:function(){s.SpatialNavigator.move("down"),h.scrollUpdate(e.templates.files.find(".selector.hover"),"online"==e.watch)},wheelDown:function(){s.SpatialNavigator.move("down"),h.scrollUpdate(e.templates.files.find(".selector.hover"),"online"==e.watch)},wheelUp:function(){s.SpatialNavigator.move("up"),h.scrollUpdate(e.templates.files.find(".selector.hover"),"online"==e.watch)},touchLeft:function(){s.Controller.toggle("menu")},back:e.goback.bind(e)})},hover:function(){},goback:function(){s.Controller.toggle("menu")},initial:function(){r.Panel.prototype.initial.call(this),this.templates.content=s.Template.get("swipe_vertival",{}).addClass("b-swipe--full-height"),this.templates.wrap=$(".b-swipe__wrap",this.templates.content),this._files(),this._toggles(),$("#content").append(this.templates.content),this._bindFilesTorrents(this.data),s.Controller.toggle("content")}}),r.InterfaceMainVertical=function(e){r.Panel.call(this,e),this.items=[],this.templates={}},r.InterfaceMainVertical.prototype=Object.assign(Object.create(r.Panel.prototype),{constructor:r.InterfaceMainVertical,position:0,initial:function(){r.Panel.prototype.initial.call(this);var e=this;this.templates.content=s.Template.get("swipe_vertival",{}),this.templates.wrap=$(".b-swipe__wrap",this.templates.content);for(var t=0;t<this.data.items.length;t++)this.line(this.item(this.data.items[t]));this.swipe=new r.Swipe(this.templates.content,{orintation:"vertical",effect:"scaled",navigation:!0}),$("#content").append(this.templates.content),$(".b-swipe__wrap:eq(0) .e-card__acens",this.templates.content).eq(0).addClass("selector-start"),s.Controller.add("content",{toggle:function(){s.History.fake("content"),s.SpatialNavigator.setCollection(),e.items[e.position].toggle()},back:function(){s.Controller.toggle("menu")}}),this.position=s.State.get(s.Interface.last(),{position:0}).position,s.History.fake("content")},toggle:function(){s.Controller.toggle("content")},line:function(e){var t=s.Template.get("swipe_slide");t.append(e.templates.content),this.templates.wrap.append(t),this.items.push(e)},up:function(){this.position>0?(this.position--,this.items[this.position].toggle(),s.State.set(s.Interface.last(),{position:this.position})):s.is_touch||s.Controller.toggle("head")},down:function(){this.position<this.items.length-1&&(this.items[this.position].templates.foot.hide(),this.position++,s.State.set(s.Interface.last(),{position:this.position}),this.items[this.position].toggle(),this.visibility())},enter:function(){var e=this.items[this.position].index;this.swipe.slideTo(e),this.position=e,s.State.set(s.Interface.last(),{position:this.position})},item:function(e){e.is_category=this.is_category,e.from_cache=this.data.from_cache;var t=new r.Cards($(this),e);return t.index=this.items.length,t.mousenter(),t.addEventListener("card:hover",this.enter.bind(this)),t.addEventListener("move:up",this.up.bind(this)),t.addEventListener("move:down",this.down.bind(this)),t.addEventListener("append:items",this.toggleCardsComplite.bind(this,t)),t.addEventListener("replace:items",this.toggleCardsComplite.bind(this,t)),t},visibility:function(){var e=this;setTimeout(function(){window.innerWidth<950?d.walk(e.items,"visibility"):d.walk(e.items.slice(e.position,e.position+2),"visibility")},s.Settings.get("animation")?300:0)},toggleCardsComplite:function(e){e.index==this.position&&(s.Hover.update(),e.toggle()),this.visibility()},hover:function(e){},remove:function(e){d.walkReverse(this.items,"remove"),this.items=null}}),r.InterfaceCategoryVertical=function(e){r.Panel.call(this,e),this.items=[],this.templates={}},r.InterfaceCategoryVertical.prototype=Object.assign(Object.create(r.Panel.prototype),{constructor:r.InterfaceCategoryVertical,position:0,initial:function(){r.Panel.prototype.initial.call(this);var e=this;this.templates.content=s.Template.get("swipe_vertival",{}),this.templates.wrap=$(".b-swipe__wrap",this.templates.content);var t,i,n="category"==this.data.type,o=n?this.data:this.data.items[0];if(this.page=o.page,$.each(o.items,function(a,l){var c={name:l.title};n&&(c.poster=s.domain_web+"/img/icons/category/"+(l.ico||"no")+".svg",c.nobackground=!0),d.extend(l,{details:c}),a%5==0&&(t=s.Template.get("swipe_slide"),i=s.Template.get("cards",{title:h.substr(o.title,82)}),t.append(i),e.templates.wrap.append(t));var u=new r.Card(l.details),p=$(".b-cards__foot",i),f=$(".b-swipe__wrap",i).addClass("cards-line"),g=s.Template.get("cards_slide",{});g.append(u.template),n&&u.template.addClass("nochang"),$(".selector",u.template).on("hover:active",function(t){if(!n){var i=s.Template.get("cards_descr",l.details);l.details.iscast&&i.find(".e-create").remove(),l.details.rating_imdb&&i.find(".b-cards-desc__line").append(h.stars(l.details.rating_imdb,l.details.rating_kp)),e.last_index=e.templates.wrap.find("> div:eq("+e.swipe.position+") .selector").index($(this)),e.last_item=$(this),s.State.set(s.Interface.last(),{index:e.last_index}),"compilations"!==e.data.origtype&&p.show().empty().append(i)}}).on("hover:enter",function(){s.Interface.load(l.playlist_url)}),f.append(g),u.visibility()}),0==o.items.length){var a=s.Template.get("cards_empty",{});this.templates.wrap.append(a)}this.swipe=new r.Swipe(this.templates.content,{orintation:"vertical",effect:"scaled",navigation:!0}),$("#content").append(this.templates.content),s.Controller.add("content",{toggle:function(){s.History.fake("content");var t=$(".e-card__acens",e.templates.content).toArray();s.SpatialNavigator.setCollection(t);var i=s.State.get(s.Interface.last(),{position:0,index:0});e.swipe.slideTo(i.position),e.last_index=i.index,e.jump()},back:function(){s.Controller.toggle("menu")},right:function(){s.SpatialNavigator.move("right")},left:function(){s.SpatialNavigator.canmove("left")?s.SpatialNavigator.move("left"):s.Controller.toggle("menu")},up:function(){e.up()},down:function(){e.down()},wheelDown:function(){e.down()},wheelUp:function(){e.up()},touchLeft:function(){s.SpatialNavigator.canmove("left")?s.SpatialNavigator.move("left"):s.Controller.toggle("menu")},touchRight:function(){s.SpatialNavigator.move("right")},touchUp:function(t){e.up()},touchDown:function(t){e.down()}}),s.History.fake("content"),setTimeout(function(){e.toggle()},100)},toggle:function(){s.Controller.toggle("content")},jump:function(){s.SpatialNavigator.focus(this.templates.wrap.find("> div:eq("+this.swipe.position+") .selector:eq("+this.last_index+")")[0])},up:function(){this.swipe.position>0?(this.swipe.slidePrev(),s.State.set(s.Interface.last(),{position:this.swipe.position}),this.jump()):0==this.swipe.position&&s.Controller.toggle("head")},down:function(){this.swipe.position<this.swipe.total-1?(this.swipe.slideNext(),s.State.set(s.Interface.last(),{position:this.swipe.position}),this.jump()):this.swipe.position==this.swipe.total-1&&this.page&&this.page.next&&s.Interface.load(this.page.next)},hover:function(e){},remove:function(e){}}),r.Controller=function(){var e=this;this.active,this.active_name="",this.prev_name="",this.controlls={},this.add=function(e,t){this.controlls[e]=t},this.toggle=function(e){this.prev_name=this.active_name,s.SpatialNavigator.straightOnly=!0,this.controlls[e]&&(this.active=this.controlls[e],this.active_name=e,this.active.toggle&&this.active.toggle())},this.reactivate=function(){this.active&&this.active.toggle()},this.once=function(e){this.active_name!==e&&this.toggle(e)},this.move=function(e){this.active&&this.active[e]&&this.active[e]()},this.enter=function(){this.active&&this.active.enter?this.active.enter():s.Hover.enter()},this["long"]=function(){this.active&&this.active["long"]?this.active["long"]():s.Hover["long"]()},this.finish=function(){this.active&&this.active.finish&&this.active.finish()},this.back=function(){this.active&&this.active.back&&this.active.back()},this.trigger=function(e,t){this.active&&this.active[e]&&this.active[e](t)},this.reset=function(){delete this.controlls.content,delete this.controlls.cards,delete this.controlls.files,delete this.controlls.descr,this.active=!1},this.isStopPrevent=function(e){return $(e).closest($(".s-content__menu,.b-files__left")).length};var t=Date.now();window.addEventListener("mousewheel",function(i){var n=Date.now();t+100>n||(t=n,e.isStopPrevent(i.target)||(i.wheelDelta>0||i.detail<0?s.Controller.trigger("wheelUp",i):s.Controller.trigger("wheelDown",i)))});var i,n=!1,o=0,a=0,r=0,l=1;function c(){Date.now()-r>o&&(o+=100/l*100,r=Date.now(),s.Controller.move(i)),Date.now()-a>800&&(n=!1),n&&requestAnimationFrame(c)}$(window).on("touchstart.touch",function(t){if(n=!1,!e.isStopPrevent(t.target)){var d,u,p,h,f,g,v=t.originalEvent.touches&&t.originalEvent.touches[0]||t,m=v.pageX,_=v.pageY,y=Date.now(),w=e.active&&e.active.touchspeed;$(document).on("touchmove.touch",function(e){v=e.originalEvent.targetTouches&&e.originalEvent.targetTouches[0]||e,b();var t=!0;!w||"touchLeft"!=d&&"touchRight"!=d?h=40:t=f-y>120,p>h&&t&&!g&&(g=!0,m=v.pageX,_=v.pageY,s.Controller.move(d))}),$(document).on("touchend.touch",function(){$(document).off(".touch"),Date.now()-y<120&&(!w||"touchLeft"!=d&&"touchRight"!=d||(a=Date.now(),r=Date.now(),n=!0,i=d,o=20,l=p,c()))})}function b(){var e,i,n,o,a,s,r;e=m,i=_,n=v.pageX,o=v.pageY,a=o-i,s=n-e,r=Math.atan2(a,s),(r*=180/Math.PI)<0&&(r=360+r),u=r,p=function(e,t,i,n){var o=e-i,a=t-n;return Math.sqrt(o*o+a*a)}(m,_,v.pageX,v.pageY),h=0,f=Date.now(),h="touchUp"==(d=u>225&&u<315?"touchDown":u>45&&u<135?"touchUp":u>135&&u<225?"touchRight":"touchLeft")||"touchDown"==d?window.innerHeight/(window.innerWidth>575?3:5):window.innerWidth/5,h=40,$(t.target).closest($(".b-filter__slide")).length&&(h=40)}})},r.Player=function(){var e,t,i,n,o=this,a=$("#player"),l=$(".e-player__time",a),c=$(".e-player__right",a),u=$(".e-player__timeline > div:first-child",a),f=$(".e-player__playlist",a),g=$(".e-player__setting",a),v=$("#player-play-native"),m=$(".e-player__continue",a),_=$(".e-player__buffer",a),y=$("#player-displays"),w=$(".e-player__cached",a),b=$(".e-player__subtitles",player),C=$(".e-player__playstop",player),S=$(".e-player__timeline",player),k=$(".e-player__close",player),x=$(".e-player__timepoint",player),T=$(".e-player__fullscreen",player),N=$(".e-player__prev",player),I=$(".e-player__next",player),E=$(".e-player__settings",player),A=$(".e-player__close-setting",player),O=$(".e-player__timenow",player),P=$(".e-player__errors",player),R=$(".e-player__volume",player),L=$(".e-player__broadcast",player),D=$(".player-param-traks",player),M=$(".player-param-none",player),H=$(".player-param-subs",player),j=$(".player-param-ratio",player),U=$(".player-param-level",player),B=!1,z={},F={},q=!1,V=0,K={contain:"适合",fill:"填充",cover:"扩展",s115:"115%",s130:"130%",s130v:"130% 垂直"};a.on("mousemove",function(){"player"==s.Controller.active_name&&(o.togglePanel(!0),o.waitAndHidePanel())}),C.on("click",function(){o.enter()}),S.on("click",function(t){o._startRewind(e.duration*o._timelineGetPoint(t),!0)}).on("mousemove",function(t){var i=o._timelineGetPoint(t);x.css({left:100*i+"%"}).text(((e.duration||0)*i+"").toHHMMSS())}),k.on("click",function(){o.exit()}),a.on("click",function(e){$(e.target).closest(".e-player__layer").length||"player"!=s.Controller.active_name||o.enter()}),T.on("click",function(){o.toggleFullscreen()}),(s.agent.indexOf("webos")>-1||s.agent.indexOf("tizen")>-1)&&T.remove(),L.on("click",function(){z.params.playlist=z.playlist,e.currentTime&&(z.params.timeline?z.params.timeline.current=e.currentTime:z.params.timeline={current:e.currentTime,time:e.duration,webplayer:!0}),s.Socket.play(z.params.likeplay,z.params),o._pause(),o.togglePlay(0)}),N.on("click",function(){o._playNextOrPrev(!1)}),I.on("click",function(){o._playNextOrPrev(!0)}),E.on("click",function(){o.down(!0)}),A.on("click",function(){o._exitSettings(!0)});this.toggleFullscreen=function(e){var t,i=window.document,n=i.documentElement,o=n.requestFullscreen||n.mozRequestFullScreen||n.webkitRequestFullScreen||n.msRequestFullscreen,a=i.exitFullscreen||i.mozCancelFullScreen||i.webkitExitFullscreen||i.msExitFullscreen;void 0===e?i.fullscreenElement||i.mozFullScreenElement||i.webkitFullscreenElement||i.msFullscreenElement?a.call(i):o.call(n):void 0!==(t=e?o.call(n):a.call(i))&&t.then(function(){})["catch"](function(e){})},this.interfaceToggle=function(e){n!==e&&(n=e,k.removeClass("hide"),T.removeClass("hide"),N.removeClass("hide"),I.removeClass("hide"),E.removeClass("hide"),A.removeClass("hide"),L.removeClass("hide"))},this._timelineGetPoint=function(e){var t=S[0].getBoundingClientRect();return Math.max(0,Math.min(t.left+t.width,e.clientX-t.left))/t.width},this._play=function(){var i;try{i=e.play()}catch(e){}t=!0,void 0!==i&&i.then(function(){console.log("Player","start playing")})["catch"](function(e){console.log("Player","play promise error: "+e.message),console.log("Player","play promise error: "+e)})},this._pause=function(){var i;try{i=e.pause()}catch(e){}t=!1,void 0!==i&&i.then(function(){console.log("Player","pause")})["catch"](function(){console.log("Player","pause promise error")}),o.setTime(e.currentTime||0,e.duration||0)},this._createDisplay=function(display_type){var display;y.empty();if(display_type=="iframe"){display=$('<iframe class="e-player__frame"></iframe>')}else if(display_type=="video"){display=$('<video class="e-player__video" poster="'+s.domain_web+'/img/poster.png" crossorigin="anonymous"></video>')}else if(display_type=="tizen"){display=$('<object class="e-player__object" type="application/avplayer"</object>')}else if(display_type=="window"){display=$('<div class="e-player__window"><iframe class="e-player__frame"></iframe></div>')}else return;y.append(display);return display},this._bindEvents=function(){e.addEventListener("waiting",function(){o.toggleLoader(!0)}),e.addEventListener("playing",function(){o.toggleLoader(!1)}),e.addEventListener("ended",function(){o._ended()}),e.addEventListener("error",function(t){var i=(e.error.message||"").toUpperCase();-1==i.indexOf("EMPTY SRC")&&(3==e.error.code?o._showError("解码视频失败"):4==e.error.code?o._showError("视频未找到或损坏"):o._showError("code ["+e.error.code+"] details ["+i+"]"),o._checkNotFound())}),e.addEventListener("tizen_error",function(e){o._showError(e.error)}),e.addEventListener("progress",function(t){var i=e.duration;if(i>0)for(var n=0;n<e.buffered.length;n++)if(e.buffered.start(e.buffered.length-1-n)<e.currentTime){var o=Math.max(0,Math.min(100,e.buffered.end(e.buffered.length-1-n)/i*100))+"%";_.css({width:o});break}}),e.addEventListener("tizen_progress",function(e){_.css({width:e.percent+"%"})}),e.addEventListener("tizen_progress_end",function(e){_.css({width:"0%"})}),e.addEventListener("canplay",function(){o.settings_loaded||o._loadSettings(),o.toggleLoader(!1),o.hide_panel_wait&&o.waitAndHidePanel(),t&&o._play()}),e.addEventListener("timeupdate",function(){if(s.Splash.reset(),e.playerSubs&&e.playerSubs.update(e.currentTime),z.continued_need&&e.duration){e.pause();var n=e.duration-15;e.currentTime=z.continued_need>n?n:z.continued_need,z.continued_need=!1,t=!0,o._play()}i&&o._changeRatioOld(i),!V&&q&&o.setTime(e.currentTime,e.duration||e.currentTime)})},this._checkNotFound=function(){$.ajax({url:z.params.url,type:"HEAD",complete:function(e,t){0!=e.status&&404!=e.status||o._showError("找不到文件")}})},this.waitAndHidePanel=function(){clearTimeout(o.panel_timer),o.hide_panel_wait=!1,o.panel_timer=setTimeout(function(){o.togglePanel(!1)},2500)},this._showError=function(e){P.show().find("span").text(e),clearTimeout(F.error),F.error=setTimeout(function(){P.hide()},6e3)},this._ended=function(){o.setTime(e.currentTime,e.duration||e.currentTime),o._setReadyState(),o._playNextOrPrev(!0)},this._setReadyState=function(){o.togglePlay(!1),o.togglePanel(!0),o.toggleSettings(!1),o.togglePlaylist(!1),o._timelneSend()},this._playNextOrPrev=function(e){if(console.log("Player","play next",z.playlist?"true":"false"),z.playlist,s.Settings.get("player_next")){var t=f.find(".selector"),i=f.find(".active"),n=i.attr("sn"),a=i.attr("ep");(e=t.filter(function(){return $(this).attr("sn")==n&&$(this).attr("ep")==parseInt(a)+(e?1:-1)})).length&&(e.trigger("hover:enter"),o.togglePlay(!0))}},this._sourceBuild=function(t,i){var n=s.Settings.get("player"),a=function(){_display=o._createDisplay("video"),e=_display[0],_display.attr("width",window.innerWidth),_display.attr("height",window.innerHeight),o._bindEvents(),o._sourceReady(t),o._appendSubtitles(),s.is_browser&&(e.volume=s.Settings.get("player_volume")),o._changeRatio(s.Settings.get("player_ratio")),i()};if(z.params.window)_display=o._createDisplay("window"),o.window_player&&(o.window_player.destroy(),o.window_player=!1),o.window_player=new r.WindowPlayer(o,_display),e=_display,o._bindEvents(),o._sourceReady(t),o._appendSubtitles(),o._changeRatio(s.Settings.get("player_ratio")),i();else if("tizen"==n&&"undefined"!=typeof webapis)_display=o._createDisplay("tizen"),o.tizen_player&&(o.tizen_player.destroy(),o.tizen_player=!1),o.tizen_player=new r.AVPlay(o,_display),e=_display,o._bindEvents(),o._sourceReady(t),o._appendSubtitles(),o._changeRatio("contain"),i();else if("b"==n||z.params.use_old_player)a();else{var l='javascript: d = document; d.clear(); d.open(); d.write("'+s.Template.get("player_iframe",{url:t,width:window.innerWidth,height:window.innerHeight},!0).replace(/"/g,'\\"')+'"); d.close();';_display=o._createDisplay("iframe"),_display.attr("src",l),setTimeout(function(){var n;try{e=_display[0].contentWindow.video,o._bindEvents(),n=!0}catch(e){n=!1}n?(o._sourceReady(t),o._appendSubtitles(),s.is_browser&&(e.volume=s.Settings.get("player_volume")),o._changeRatio(s.Settings.get("player_ratio")),i()):a()},300)}},this._clearSource=function(){e.src="",e.load()},this._sourceTryHls=function(t){try{(B=new Hls).loadSource(t),B.attachMedia(e)}catch(i){console.log("Player","HLS play error:",i.message),e.src=t,e.load()}},this._sourceReady=function(t){B&&(B.destroy(),B=!1),/.m3u8/.test(t)?(console.log("Player","is .m3u8"),s.agent.indexOf("maple")>-1&&(t+="|COMPONENT=HLS"),s.Settings.get("player_hls_suport")?e.canPlayType("application/vnd.apple.mpegurl")?(e.src=t,e.load()):Hls.isSupported()?o._sourceTryHls(t):s.agent.indexOf("maple")>-1?(e.src=t,e.load()):$.notify("此视频不支持播放",{className:"error"}):Hls.isSupported()?o._sourceTryHls(t):e.canPlayType("application/vnd.apple.mpegurl")?(e.src=t,e.load()):s.agent.indexOf("maple")>-1?(e.src=t,e.load()):$.notify("此视频不支持播放",{className:"error"})):t&&(e.src=t,e.load()),console.log("Player","set source:",t)},this._source=function(e,t){var i=function(e){o._sourceBuild(e,function(){t&&t()})},n=function(){console.log("Player","parse failed"),i(s.domain_web+"/img/other/nosignal.mp4")},a=function(e){h.parseUrl(e,function(t){console.log("Player","parse responce:",t.length),s.Reguest.silent(e.sendto,function(e){"parse"==e.type?a(e):e.stream_url?i(e.stream_url):n()},n,{html:t})},n)};z.params.need_parse?(console.log("Player","start parse:",e),s.Reguest.silent(e,a,n)):i(e)},this._appendSubtitles=function(){if(z.params.subtitles){if(!o.tizen_player)for(var t=0;t<z.params.subtitles.length;t++){var i=z.params.subtitles[t],n=document.createElement("track");n.setAttribute("label",i[0]),n.setAttribute("kind","captions"),n.setAttribute("srclang",i[0]),n.setAttribute("type","text/str"),n.setAttribute("label",i[0]),n.setAttribute("src",i[1]),e.appendChild(n)}e.playerSubs=new r.PlayerSubs(o,z.params.subtitles),console.log("Player","add subtitles"),Object.defineProperty(e,"subtitlesStr",{set:function(){},get:function(){for(var e=[],t=0;t<z.params.subtitles.length;t++){var i=z.params.subtitles[t];e.push({index:t,language:i[0],label:""})}return e}})}},this._getStatics=function(e){var t="server"==s.Settings.get("server_use"),i=0,n=function(){i=0,s.Reguest.clear();var n=z.params.server+"/"+(s.torrserver_new?"torrents":"torrent/stat");z.params.stat_url&&(n=z.params.stat_url),s.Reguest.need.disable_cache=!0,s.Reguest.silent(n,function(e){var i,n,o;t?(i=e.connected_seeders||e.ConnectedSeeders||e.seeds||0,n=e.total_peers||e.TotalPeers||e.available||0,o=e.download_speed||e.DownloadSpeed||e.speed||0):(i=0,n=e.response.peers,o=1024*e.response.speed_down),$(".pl-connect",a).text((i||0)+" / "+(n||0)),$(".pl-speed",a).text(o?h.bytesToSize(o)+"/s":"0.00"),100==e.progress&&(c.addClass("hide"),w.removeClass("hide"))},!1,JSON.stringify({action:"get",hash:e,Hash:e}))};o.static_timer=setInterval(function(){a.hasClass("show-panel")?n():++i>=10&&n()},2e3)},this._resizeRation=function(t){var i=e.videoWidth,n=e.videoHeight,o=1,r=1.01,l=1.01;if(0!=i&&0!=n&&null!=i){$(".sixx",a).length||$(".e-player__tags",a).append('<li class="sixx">'+i+"x"+n+"</li>"),console.log("Player","ratio confirm change:",t,i+"",n+"");var c=function(e,t){o=Math.min(window.innerWidth/i,window.innerHeight/n),r=e,l=t};if("contain"==t?o=Math.min(window.innerWidth/i,window.innerHeight/n):"fill"==t?(o=Math.min(window.innerWidth/i,window.innerHeight/n),r=window.innerWidth/(i*o),l=window.innerHeight/(n*o)):"s115"==t?c(1.15,1.15):"s130"==t?c(1.34,1.34):"s130v"==t?c(1.01,1.34):(o=Math.min(window.innerWidth/i,window.innerHeight/n),i*=o,n*=o,o=Math.max(window.innerWidth/i,window.innerHeight/n),r=o,l=o),r=r.toFixed(2),l=l.toFixed(2),s.Settings.get("player_transformation")=="calculate"||s.is_old)var d=i*o,u=n*o,p={width:Math.round(d*r)+"px",height:Math.round(u*l)+"px",marginLeft:Math.round(window.innerWidth/2-d*r/2)+"px",marginTop:Math.round(window.innerHeight/2-u*l/2)+"px"};else p={width:Math.round(window.innerWidth)+"px",height:Math.round(window.innerHeight)+"px",transform:"scaleX("+r+") scaleY("+l+")"};return $(e).css(p),console.log("Player","size:",p),!0}},this._changeRatioOld=function(e){this._resizeRation(e)&&(i=!1)},this._changeRatio=function(t){console.log("Player","change ratio:",t,s.is_old?"old":"new"),e.changeRatio?e.changeRatio(t):(i=t,o._changeRatioOld(t))},this._settingsAudio=function(audio_info){var t=[];if(B&&B.audioTracks&&B.audioTracks.length?t=B.audioTracks:e.audioTracks&&e.audioTracks.length&&(t=e.audioTracks),console.log("Player","vid tracks:",e.audioTracks?e.audioTracks.length+"":"-"),console.log("Player","hls tracks:",B?"program":"system",B?B.audioTracks.length+"":"-"),t.length>1){M.hide(),$(".player-icon-sound",a).show();var i,n=[],r=function(e){n=[],p=0,name;for(var o=0;o<t.length;o++){var a=t[o];var name;if(audio_info)name=audio_info[a.index||a.id||0];e&&"undefined"!==a.groupId&&-1==e.indexOf(a.groupId)||(name=p+1+" / "+(a.language||a.name||"未知")+" "+(a.label||""),p++,audio_info&&(name=audio_info[a.index||a.id||0]),n.push({i:o,title:name||l,selected:B?B.audioTrack==(a.index||a.id):a.enabled,index:a.index||a.id||0}),a.enabled&&(i=name))}};r(),i||(i=n[0].title);var l=D.show().find(".selector").unbind().addClass("work").text(h.substr(i,20)),c=function(i){z.params.activate_audio=i,e.audioTracksToggle?e.audioTracksToggle(i.index):B&&(B.audioTrack=i.index);for(var o=0;o<t.length;o++)t[o].enabled=!1,n[o]&&(n[o].selected=!1);i.selected=!0,l.text(h.substr(i.title,20)),t[i.i].enabled=!0};if(l.on("hover:enter",function(){o.last_select_setting=$(this),B&&r(B.levels[B.currentLevel].audioGroupIds||[]),s.Drop.open("曲目",n,c,"player_settings")}),z.params.activate_audio)try{c(z.params.activate_audio)}catch(e){}}},this._settingsSubs=function(subs_info){var t=[];if(e.subtitlesStr&&e.subtitlesStr.length?t=e.subtitlesStr:e.textTracks&&e.textTracks.length&&(t=e.textTracks),t.length){M.hide(),$(".player-icon-subs",a).show();var i=[{i:-1,title:"已禁用",selected:!0}];for(var n=0;n<t.length;n++){var r=t[n],l=n+1+" / "+(r.language||r.label||"未知");if(l=="undefined")l="未知";if(subs_info){sub_name=subs_info[r.index]||l}else sub_name=l;i.push({i:n,title:sub_name,index:r.index})}var c=H.show().find(".selector").unbind().addClass("work").text("已禁用"),d=function(n){z.params.activate_subs=n,e.textTracksToggle&&e.textTracksToggle(n.index);for(var o=0;o<t.length;o++)t[o].mode="disabled",i[o].selected=!1;n.selected=!0,c.text(n.title),b.toggleClass("hide",-1==n.i),a.toggleClass("subtitles-visible",-1!==n.i),t[n.i]&&(t[n.i].mode="showing"),e.playerSubs&&e.playerSubs.change(n.i)};if(c.on("hover:enter",function(){o.last_select_setting=$(this),s.Drop.open("字幕",i,d,"player_settings")}),z.params.activate_subs)try{d(z.params.activate_subs)}catch(e){}}},this._settingsQuality=function(){var t=[];if(B?t=B.levels:o.window_player&&e.levels&&(t=e.levels),t.length>1){M.hide();for(var i,n=[],a=0;a<t.length;a++){var r=t[a],l=r.qu?r.qu:r.width+"x"+r.height;n.push({i:a,title:l,selected:a==(B||e).currentLevel}),a==(B||e).currentLevel&&(i=l)}var c=U.show().find(".selector").unbind().addClass("work").text(i),d=function(t){z.params.activate_quality=t;for(var i=0;i<n.length;i++)n[i].selected=!1;t.selected=!0,c.text(t.title),B?B.currentLevel=t.i:"undefined"!==e.currentLevel&&(e.currentLevel=t.i)};if(c.on("hover:enter",function(){o.last_select_setting=$(this),s.Drop.open("质量",n,d,"player_settings")}),z.params.activate_quality)try{d(z.params.activate_quality)}catch(e){}}},this._settingsQualityName=function(e){U.find(".selector").text(e)},this._settingsRatio=function(){if(!o.tizen_player){M.hide();var e=s.Settings.get("player_ratio");j.show().find(".selector").unbind().addClass("work").text(K[e]||"auto").on("hover:enter",function(){o.last_select_setting=$(this);var t=d.getKeys(K),i=t.indexOf(e),n=t.length;e=t[i=++i>=n?0:i],s.Settings.change("player_ratio",e),o._changeRatio(e),$(this).text(K[e])})}},this.setSubtitles=function(e){b.html(e)},this._loadSettings=function(){this.settings_loaded=!0;this.last_select_setting=false;console.log("Player","setting video start load");this._settingsRatio();if(z.params.audioinfo_url){s.Reguest.silent(z.params.audioinfo_url,function(data){o._settingsAudio(data.audio_info);o._settingsSubs(data.subs_info)})}else{o._settingsAudio();o._settingsSubs()}this._settingsQuality()},this._clearSettings=function(){this.settings_loaded=!1,this.last_select_setting=!1,M.show(),D.hide(),H.hide(),j.hide(),U.hide(),b.addClass("hide").text(""),g.find(".work").removeClass("work"),a.toggleClass("subtitles-visible",!1),$(".player-icon-subs,.player-icon-sound",a).hide()},this._bindPlaylist=function(e){f.empty();var t=s.Template.get("swipe_horizontal",{});t.addClass("b-swipe--to-bottom");var i=function(e,i,n){var r=s.Template.get("swipe_slide",{}),l=s.Template.get("select",{name:e.title});i&&r.append(s.Template.get("file_category",{title:i})),l.on("hover:enter",function(){$(".e-player__name",a).text(e.title),o._pause(),o._clearSettings(),o.hide_panel_wait=!0,o.togglePlay(!0),o.togglePanel(!0),o.toggleSettings(!1),o.togglePlaylist(!1),z.params.subtitles=e.subtitles,o._source(e.stream_url,function(){o._play()}),t.find(".active").removeClass("active"),$(this).addClass("active"),z.params.ident=e.ident,z.params.timeline=e.timeline,z.params.url=e.stream_url,z.params.name=e.title,o._ident({timeline:e.timeline,ident:e.ident}),s.Controller.toggle("player")}).attr("sn",n).attr("ep",e.index),e.stream_url==z.params.url&&l.addClass("active"),r.append(l),t.find(".b-swipe__wrap").append(r)};$.each(e,function(e,t){if(t.submenu)for(var n=0;n<t.submenu.length;n++)i(t.submenu[n],0==n?t.title:"",t.index);else i(t,"",0)}),f.append(t),this.playlist_swipe=new r.Swipe(t,{}),s.Hover.update()},this._hoverPlaylist=function(){var e=$(".selector",f),t=e.filter(".hover");o.playlist_swipe.slideTo(e.index(t))},this._exitPlaylist=function(e){e||this.togglePanel(!0),this.togglePlaylist(!1),s.Controller.toggle("player")},this._exitSettings=function(e){e||this.togglePanel(!0),this.toggleSettings(!1),s.Controller.toggle("player")},this._ident=function(e,t){clearTimeout(this._timelneSend),clearInterval(this._timelneSend),z.continued=!1,z.params.otside_player=t,m.hide();var i=s.Settings.get("player_continue");e.timeline&&"nov"!==i&&!t&&("olw"==i?setTimeout(function(){s.Drop.open("继续观看",[{title:"继续 "+(e.timeline.current+"").toHHMMSS(),conti:!0},{title:"Нет"}],function(t){t.conti&&(z.continued_need=e.timeline.current)},"player")},1e3):"ask"==i?(m.show().find("span").text((e.timeline.current+"").toHHMMSS()),z.continued=Date.now(),F.continued=setTimeout(function(){m.hide(),z.continued=!1},2e4)):(console.log("Player","set time start: "+e.timeline.current),z.continued_need=e.timeline.current)),e.ident&&s.auth&&(t?F.ident_wait=setTimeout(this._timelneSend,3e4):F.ident_interval=setInterval(this._timelneSend,3e5))},this._timelneSend=function(){var t=z.params.ident;if(z.params.ident&&s.auth){var i=Math.round(z.params.otside_player?60:e.currentTime);i>=20&&s.Reguest.silent(s.domain_url+"/timeline/watch?ident="+t+"&current="+i+"&time="+Math.round(z.params.otside_player?60:e.duration)+"&webplayer="+(z.params.otside_player?"false":"true"),function(e){z.params.timeline=e,h.updateAllTimeline(t,e)})}},this.togglePanel=function(e){e&&clearTimeout(o.panel_timer),a.toggleClass("show-panel",e),O.toggleClass("active",e),q=e},this.toggleLoader=function(e){a.toggleClass("show-loader",e)},this.togglePlay=function(e){a.toggleClass("played",e)},this.togglePlaylist=function(e){a.toggleClass("show-playlist",e)},this.toggleSettings=function(e){a.toggleClass("show-settings",e)},this.setTime=function(e,t){l.text(h.secondsToTime(e)+" / "+h.secondsToTime(t));var i=e&&t?e/t*100:0;u.css({width:Math.min(100,Math.max(0,i))+"%"})},this.rewind=function(t){if(e.duration){var i=Date.now(),n=e.duration/1800,a=i-(F.rewind||0)>50?20:60;0==V&&(V=e.currentTime),t?V+=Math.min(a,30*n):V-=Math.min(a,30*n),o._startRewind(V)}},this._rewind=function(t){clearTimeout(F.rewind_call),F.rewind_call=setTimeout(function(){e.currentTime=V,V=0,o._play(),o.togglePlay(!0)},t?0:1e3)},this._startRewind=function(t,i){e.duration&&(V=Math.max(0,Math.min(t,e.duration)),o._pause(),0==V?e.currentTime=0:V==e.duration&&(e.currentTime=e.duration),this.setTime(V,e.duration),this.togglePanel(!0),this.togglePlay(!1),o.hide_panel_wait=!0,F.rewind=Date.now(),this._rewind(i))},this.runNative=function(e){v.attr("href",e),v[0].click()},this._playlistVimu=function(e){var t=[],i=0,n=function(e){e.sort(function(e,t){return e.index-t.index})},o=function(e){z.params.url==e.stream_url&&(i=e.index),e.stream_url=e.stream_url,t.push(e)};return n(e),$.each(e,function(e,t){if(t.submenu){n(t.submenu);for(var i=0;i<t.submenu.length;i++)o(t.submenu[i])}else o(t)}),{playlist:t,index:i}},this._prepare=function(e,i,n){t=!1,z.params=e,z.playlist=!1;var r=e.android_player_choosen||s.Settings.get(e.torrent_player?"android_player_torrent":"android_player");if(!s.is_android||"inner"===r||e.window||e.need_parse)if("undefined"==typeof process||"inner"===r||e.window||e.need_parse){if("undefined"!=typeof webOS&&"webos"==r&&!e.window&&!e.need_parse)return s.AVTransport.play({url:e.webos_url||e.url,name:h.nameToLatin(e.name)},z.params.from),void this._ident(e,!0);this._ident(e),s.is_touch&&k.removeClass("hide"),this.playlist_swipe=!1,this.settings_loaded=!1,this.hide_panel_wait=!0,f.empty(),this._clearSettings(),N.removeClass("active"),I.removeClass("active"),i(),clearInterval(o.static_timer),s.Controller.toggle("player"),a.removeClass("vast"),$(".pl-connect",a).text("0 / 0"),$(".pl-speed",a).text("0.00"),c.addClass("hide"),w.addClass("hide"),O.toggleClass("hide",!s.Settings.get("player_time"));var l=[];e.tags.map(function(e){l.push("<li>"+e+"</li>")}),$(".e-player__poster",a).hide(),$(".e-player__name",a).text(e.name),$(".e-player__tags",a).empty().append(l.join("")),e.poster&&$(".e-player__poster",a).attr("src",e.poster).show(),_.css({width:"0%"}),z.playlist&&z.playlist.length&&(N.addClass("active"),I.addClass("active")),this.togglePanel(!0),this.toggleLoader(!0),this.togglePlay(!0),this.setTime(0,0),n()}else{if("vlc"==r){console.log("Player","run vlc player");new(require("./node_modules/vlc-simple-player"))(e.url)}else{var d=s.Settings.get("custom_player");if(console.log("Player","run custom player:",d),d)(0,require("child_process").spawn)(d,[e.url]);else $.notify("在设置中指定播放器路径",{className:"error"})}this._ident(e,!0)}else{if("undefined"!=typeof androidApp&&androidApp.play){console.log("Player","use android lauch",r);var u=z.params.vimu_playlist||z.params.playlist,p=o._playlistVimu(s.Settings.get("player_next")&&u.length>=1&&(u[0].playlist_url=="submenu"||u.playlist_url=="submenu")?u:[]);console.log(u);if("undefined"!==typeof androidApp.version()&&androidApp.version()>=3){var g=JSON.stringify({player:e.android_player_choosen||r,url:e.url,title:e.name,poster:e.poster,position:"undefined"==typeof z.params.timeline||z.params.timeline==null?0:z.params.timeline.current*1e3,playlist:p.playlist.length>1?p.playlist:[]})}else{var g=JSON.stringify({player:r,url:e.url,title:e.name,poster:e.poster,playlist:p.playlist.length>1?p.playlist:[]})}console.log("Player","android playlist",p.playlist.length);try{androidApp.play(g,p.index);h.setWath(!0,z.params.ident)}catch(t){console.log("Player","run android play fail"),v.attr("href",e.url),v[0].click()}}else v.attr("href",e.url),v[0].click();window.time_response=function(data){data=JSON.parse(data);var current=Math.round(data.current/1e3),time=Math.round(data.time/1e3);if(data.current!=-1){webplayer=data.time!=1?"true":"false";s.Reguest.silent(s.domain_url+"/timeline/watch?ident="+z.params.ident+"&current="+current+"&time="+time+"&webplayer="+webplayer,function(e){h.updateAllTimeline(z.params.ident,{ident:z.params.ident,current:current,time:time,webplayer:data.time!=-1?!0:false});s.Console.add("Timeline updated!")})}}}},this._start=function(e){this._source(e.url,function(){o._play()})},this.play=function(e){e.likeplay="play",this._prepare(e,function(){e.playlist&&e.playlist.length&&(z.playlist=e.playlist,o._bindPlaylist(e.playlist))},function(){c.removeClass("hide"),o._start(e),o._getStatics(e.hash)})},this.video=function(e,t){e.likeplay="video",e.playlist=t,this._prepare(e,function(){z.playlist=t;t&&o._bindPlaylist(t)},function(){o._start(e)})},this.show=function(){this.resize(),a.show().addClass("opened")},this.exit=function(){this._timelneSend(),o.tizen_player?(o.tizen_player.destroy(),o.tizen_player=!1):o.window_player?(o.window_player.destroy(),o.window_player=!1):o._clearSource(),y.empty(),clearInterval(o.static_timer),clearInterval(F.ident_interval),clearTimeout(F.ident_wait),clearTimeout(F.continued),clearTimeout(F.rewind_call),clearTimeout(F.volume),clearTimeout(F.error),a.hide().removeClass("opened").removeClass("vast"),P.hide(),s.Controller.toggle(z.params.from||"content")},this.left=function(){this.rewind(!1)},this.right=function(){this.rewind(!0)},this.volume=function(t){var i=e.volume+t;i=Math.max(0,Math.min(1,i)),e.volume=i,R.show().text(Math.round(100*i)+"%"),s.Settings.change("player_volume",i),clearTimeout(F.volume),F.volume=setTimeout(function(){R.hide()},1500)},this.down=function(e){var t=a.hasClass("show-panel");this.togglePanel(!1),t&&!e||(this.toggleSettings(!0),s.Controller.toggle("player_settings"))},this.up=function(){this.enable_panel&&this.playlist_swipe?s.Controller.toggle("player_playlist"):(this.enable_panel=!0,this.togglePanel(!0))},this.enter=function(){if(z.continued){var i=Date.now();i-z.continued<800?(z.continued_need=z.params.timeline.current,t=!0,z.continued=!1):z.continued=i}e.paused?(o._play(),this.togglePanel(!1)):(o._pause(),this.togglePanel(!0)),this.togglePlay(!e.paused)},this.resize=function(){$(a).width(window.innerWidth).height(window.innerHeight),a.hasClass("opened")&&this._resizeRation(s.Settings.get("player_ratio"))},s.Controller.add("player",{toggle:function(){s.History.fake("player"),s.Player.show()},up:function(){s.Player.up()},down:function(){s.Player.down()},left:function(){s.Player.left()},right:function(){s.Player.right()},back:function(){s.Player.exit()},enter:function(){s.Player.enter()},"long":function(){},playpause:function(){s.Player.enter()},pause:function(){o._pause()},play:function(){o._play()},rewindBack:function(){o.rewind()},rewindForward:function(){o.rewind(!0)},info:function(){o.enable_panel?o.down():o.up()},stop:function(){s.Player.exit()},touchUp:function(){s.Player.down()},touchDown:function(){s.Player.up()},wheelUp:function(){s.is_browser&&o.volume(.05)},wheelDown:function(){s.is_browser&&o.volume(-.05)}}),s.Controller.add("player_playlist",{toggle:function(){s.History.fake("player_playlist"),o.togglePanel(!1),o.togglePlaylist(!0);var e=$(".selector",f).toArray();s.SpatialNavigator.setCollection(e),s.SpatialNavigator.focus($(".selector.active",f).toArray()[0]),o._hoverPlaylist()},up:function(){o._exitPlaylist()},down:function(){o._exitPlaylist(!0)},left:function(){s.SpatialNavigator.move("left"),o._hoverPlaylist()},right:function(){s.SpatialNavigator.move("right"),o._hoverPlaylist()},back:function(){o._exitPlaylist(!0)},touchUp:function(){o._exitPlaylist(!0)},touchDown:function(){o._exitPlaylist()},touchLeft:function(){s.Controller.trigger("left")},touchRight:function(){s.Controller.trigger("right")},wheelUp:function(){s.Controller.trigger("left")},wheelDown:function(){s.Controller.trigger("right")}}),s.Controller.add("player_settings",{toggle:function(){s.History.fake("player_settings"),o.toggleSettings(!0);var e=$(".work",g).toArray();s.Hover.reset(),e.length?(s.SpatialNavigator.setCollection(e),s.SpatialNavigator.focus(o.last_select_setting?o.last_select_setting[0]:$(".work",g).toArray()[0])):s.SpatialNavigator.setCollection()},up:function(){o._exitSettings()},down:function(){o._exitSettings(!0)},left:function(){s.SpatialNavigator.move("left")},right:function(){s.SpatialNavigator.move("right")},back:function(){o._exitSettings(!0)},touchUp:function(){o._exitSettings(!0)},touchDown:function(){o._exitSettings(!1)}})},r.PlayerSubs=function(e,t){var i,n=this,o=$(".e-player__subtitles"),a=function(e){var t=/(\d+):(\d{2}):(\d{2}),(\d{3})/.exec(e);if(null===t)return 0;for(var i=1;i<5;i++)t[i]=parseInt(t[i],10),isNaN(t[i])&&(t[i]=0);return 36e5*t[1]+6e4*t[2]+1e3*t[3]+t[4]};this.change=function(e){i=!1;var a=t[e];o.addClass("hide").empty(),a&&this._load(a[1],function(e){if(console.log("Player","loaded sub"),e){console.log("Player","start parse sub"),o.removeClass("hide");try{n._parse(e,!0)}catch(e){console.log("Player","parse sub error:",e.message),o.addClass("hide")}}})},this.update=function(e){var t=1e3*e;if(i){for(var n="",a=0;a<i.length;a++){var s=i[a];if(t>s.startTime&&t<s.endTime){n=s.text.replace("\n","<br>");break}}o.html(n)}},this._load=function(e,t){console.log("Player","load sub: ",e),$.get(e,t)},this._parse=function(e,t){i=[];var n=!!t;if(e.indexOf("WEBVTT")!=-1){e=e.replace("WEBVTT\n","");(e=(e=e.replace(/\r/g,"")).split(/(\d{2}:\d{2}:\d{2}\.\d{3}) --> (\d{2}:\d{2}:\d{2}\.\d{3})/g)).shift();for(var o=[],s=0;s<e.length;s+=3)o.push({id:s/3,startTime:n?a(e[s].trim().replace(".",",")):e[s].trim(),endTime:n?a(e[s+1].trim().replace(".",",")):e[s+1].trim(),text:e[s+2].replace("\n\n/d+/g","").trim()})}else{(e=(e=e.replace(/\r/g,"")).split(/(\d+)\n(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})/g)).shift();for(var o=[],s=0;s<e.length;s+=4)o.push({id:e[s].trim(),startTime:n?a(e[s+1].trim()):e[s+1].trim(),endTime:n?a(e[s+2].trim()):e[s+2].trim(),text:e[s+3].trim()})}console.log("Sub log",o);i=o}},r.Loader=function(){this.visible=!1,this.elem=$("#loader"),this.show=function(){s.Settings.get("snimation")?this.elem.fadeIn(300):this.elem.show(),this.visible=!0},this.hide=function(){s.Settings.get("snimation")?this.elem.fadeOut(300):this.elem.hide(),this.visible=!1}},r.Detect=function(){var e=this,t=$(".e-mouse-layer"),i={};this.mouse=!1,this.keybord=!0,this.inputKeydord=function(){t.show(),clearTimeout(i.mouse_wait),i.mouse=!1,e.keybord=!0,e.mouse=!1},this.inputMouse=function(){i.mouse||(i.mouse=!0,i.mouse_wait=setTimeout(function(){i.mouse=!1,t.hide(),e.keybord=!1,e.mouse=!0},600))}},r.Layer=function(){var e,t,i=$("body"),n=$("#tv-only"),o=$("#info"),a=$("#content");this.change=function(){i.toggleClass("noanimate",!s.Settings.get("animation")),i.removeClass("text-size-less text-size-medium text-size-bigger").addClass("text-size-"+s.Settings.get("text_size")),i.removeClass("subs-size-less subs-size-medium subs-size-bigger").addClass("subs-size-"+s.Settings.get("player_subs_size")),this.resize()},this.resize=function(){clearTimeout(e),$(".lr-width").text(screen.width>100?screen.width:window.innerWidth),$(".lr-height").text(screen.height>100?screen.height:window.innerHeight),$(".lr-agent").text(navigator.userAgent);var t=s.Settings.get("interface_size")/100;i.addClass("resiseble").css({fontSize:Math.max(window.innerWidth/90*t,10.6)+"px"}).toggleClass("trigger--interface-two","two"==s.Settings.get("interface_type")).toggleClass("trigger--interface-vertical",!!s.Settings.get("interface_vertical")),e=setTimeout(function(){i.removeClass("resiseble")},600),$(".b-swipe--full-height").each(function(){var e=$(this),t=$("> .b-swipe__wrap > .b-swipe__item",e),i=t.filter(".swipe-viewed"),n=$("> .b-swipe__wrap",e);if(e.is(":visible")&&(t.css({height:"auto"}),t.filter(":not(.auto-height)").css({height:e.height()+"px"})),i.length){var o={slide:i.offset(),box:e.offset(),wrap:n.offset()},a="translateY("+Math.round(o.wrap.top+o.box.top-o.slide.top-o.box.top)+"px)";n.css({transform:a})}}),n.toggleClass("show",window.innerHeight>window.innerWidth),s.is_old&&a.css({height:window.innerHeight-a.offset().top+"px"}),$(".layer-offset-height").each(function(){$(this).is(":visible")&&$(this).css({height:window.innerHeight-$(this).offset().top+"px"})}),this.dispatchEvent({type:"resize"})},this.info=function(e){clearTimeout(t),o.text(e).show(),t=setTimeout(function(){o.hide()},5e3)},$(window).on("resize",this.resize.bind(this));var r="undefined"!=typeof PROTOCOL?PROTOCOL:"http";$(".lr-connect").text("https"==r?"受保护":"不受保护"),$(".lr-iframe").text(h.inIframe()?"窗口":"直通")},r.Menu=function(){var e=$(".e-menu"),t=$(".e-menu__body");this.is_open=!1,this.created=!1;var i,n=0,o=0,a=0;this.open=function(){this.is_open||$(".wrap").addClass("trigger--menu-open"),this.is_open=!0},this.close=function(){this.is_open&&$(".wrap").removeClass("trigger--menu-open"),this.is_open=!1},this.create=function(n){n.channels.reverse();for(var o=0;o<n.channels.length;o++){var a=n.channels[o];t.prepend(s.Template.get("menu_item",a))}t.prepend(s.Template.get("menu_item",{ico:"bookmarks",playlist_url:s.Settings.get("bookmarks_type")?s.domain_url+"/bookmarks/bookmark_list":s.domain_url+"/cat_bookmarks",title:"书签"})),t.prepend(s.Template.get("menu_item",{ico:"torrents_old",playlist_url:"torrents",title:"我的种子"})),t.prepend(s.Template.get("menu_item",{ico:"main",playlist_url:s.main_url,title:"首页"}));var l=$(".e-menu__item",e);l.on("hover:enter",function(){var e=$(this).attr("data-url"),t=$(this).attr("data-ico");e&&("bookmarks"!=t&&"clock"!=t||s.auth?"torrents_old"==t?s.Upload.showMyTorrents():(l.removeClass("active"),$(this).addClass("active"),s.Interface.load(e,!0)):s.Modal.open(s.Template.get("noauth_faq"),"需要注册或登录","content"))}).on("hover:active",function(){i=$(this)[0],h.scrollUpdate($(this),!0)}),this.created=!0,new r.Scrollbox($(".scrollbar-inner",e)).wheel(!0),s.Hover.update()},this.load=function(){s.Reguest.quiet(s.main_url,this.create.bind(this),function(){++o<4&&s.Menu.load()})},this.toggle=function(){var e=$(".e-menu .selector").toArray();s.SpatialNavigator.setCollection(e),s.SpatialNavigator.focus(i||e[0])},this.click=function(){$(".wrap").hasClass("trigger--menu-open")?s.Controller.toggle("content"):s.Controller.toggle("menu")},s.Controller.add("menu",{toggle:function(){n=0,a=0,s.Menu.toggle(),s.History.fakeClear()},up:function(){s.SpatialNavigator.canmove("up")?s.SpatialNavigator.move("up"):s.Controller.toggle("head"),a=0},left:function(){++n>=10&&(n=0,s.Controller.toggle("console"),s.Search.enableSpeechSearch())},down:function(){s.SpatialNavigator.move("down"),s.SpatialNavigator.canmove("down")?a=0:++a>15&&(a=0,s.Console.runDebug())},right:function(){s.Controller.toggle("content")},touchRight:function(){s.Controller.toggle("content")}}),$(".e-menu__item.go-back").on("hover:enter",function(){s.History.back()}),$(".elem-mobile-back").on("click",function(){s.History.back()}),$(".b-head__menu-toggle").on("click",this.click.bind(this))},r.Reguest=function(){var e,t,i=this,n=[];this.loading=false,this.need={timeout:6e4,disable_cache:!1},this.get=function(e,t,n,o){this.clear(),this._go({url:e,post_data:o,start:function(){i.loading=!0,i.dispatchEvent({type:"load:start"})},before_end:function(){i.dispatchEvent({type:"load:before_end"})},after_end:function(){i.dispatchEvent({type:"load:after_end"})},before_complite:function(){i.dispatchEvent({type:"load:before_complite"})},complite:function(e){i.loading=!1,t&&t(e)},after_complite:function(){i.dispatchEvent({type:"load:after_complite"})},before_error:function(){i.dispatchEvent({type:"load:before_error"})},error:function(e){i.loading=!1,n&&n(e)},after_error:function(){i.dispatchEvent({type:"load:after_error"})},end:function(){i.dispatchEvent({type:"load:end"})}})},this.quiet=function(e,t,n,o,a){i.need.disable_cache=!1;var s={};a&&(s=a);var r={url:e,post_data:o,complite:function(e){t&&t(e)},error:function(e){n&&n(e)}};d.extend(r,s,!0),this._go(r)},this.silent=function(e,t,o,a,s){var r={};s&&(r=s);var l={url:e,complite:t,error:o};n.push(l);var c={url:e,post_data:a,complite:function(e){-1!==n.indexOf(l)&&l.complite&&l.complite(e)},error:function(e){-1!==n.indexOf(l)&&l.error&&l.error(e)},end:function(){i.dispatchEvent({type:"load:end"})}};d.extend(c,r,!0),this._go(c)},this.last=function(t,n,o,a){e={url:t,complite:n,error:o},this._go({url:t,post_data:a,complite:function(t){e&&e.complite&&e.complite(t)},error:function(t){e&&e.error&&e.error(t)},end:function(){i.dispatchEvent({type:"load:end"})}})},this.clear=function(){n=[]},this.again=function(e){(e||t)&&this._go(e||t)},this.latest=function(){return t},this.errorDecode=function(e,t){return 0===e.status&&"timeout"!==t?"没有网络连接。":404==e.status?"找不到请求的页面。 [404]":401==e.status?"授权失败":500==e.status?"内部服务器错误。 [500]":"parsererror"===t?"请求的 JSON 解析失败。":"timeout"===t?"请求超时。":"abort"===t?"请求被中止。":"custom"===t?e.responseText:"未知错误: "+e.responseText},this._cache=function(e){if(!e)return d.decodeJson(f.get("reguest_cache"),{});f.set("reguest_cache",JSON.stringify(e))},this._go=function(e){i.dispatchEvent({type:"load:go"}),t=e,e.start&&e.start();var n=e.url;i.need.cache;(s.android_app&&androidApp.parseUrl||s.makeparse)&&-1==e.url.indexOf("failed=true")&&(e.url=h.addUrlParams(e.url,"inparse=true")),e.url.indexOf(s.domain_url)>=0&&s.auth&&(e.url=h.addUrlParams(e.url,"token="+encodeURIComponent(s.auth))),console.log("Reguest","send:",e.url);var o={dataType:e.dataType||"json",url:e.url,timeout:i.need.timeout,crossDomain:!0,success:function(t){console.log("Reguest","result:",t),function(t){setTimeout(function(){if(e.before_end&&e.before_end(),e.before_complite&&e.before_complite(t),e.complite)try{e.complite(t)}catch(e){console.log("Reguest","complite error:",e.message+"\n\n"+e.stack,e.line||e.lineno,e.col||e.colno),s.Console.add(e.message+"<br><br>"+e.stack.split("\n").join("<br>"),e.line||e.lineno,e.col||e.colno)}e.after_complite&&e.after_complite(t),e.after_end&&e.after_end(),e.end&&e.end()},s.Settings.get("animation")?t&&t.from_cache?0:300:0)}(t)},error:function(t,n){console.log("Reguest","error:",i.errorDecode(t,n),t,n),e.before_end&&e.before_end(),e.before_error&&e.before_error(t,n),e.error&&e.error(t,n),e.after_error&&e.after_error(t,n),e.after_end&&e.after_end(),e.end&&e.end()},beforeSend:function(e){var t=s.Settings.get("server_use"),i=s.Settings.get(t);i&&n.indexOf(i)>-1&&s.Settings.get("server_auth")&&e.setRequestHeader("Authorization","Basic "+c.encode(s.Settings.get("server_login")+":"+s.Settings.get("server_pass")))}};e.post_data&&(o.type="POST",o.data=e.post_data),$.ajax(o),i.need.timeout=6e4,i.need.cache=!1},this._cache({})},r.Keybord=function(){var e,t,i=this,n=window.SimpleKeyboard["default"],o={},a=$("#virtual-keybord");this.opened=!1,this.open=function(e,i){o={},t=e,i&&(o=i),this._init()},this._init=function(){if(t.removeClass("kfocus").attr("readonly","true").putCursorAtEnd().blur(),s.Settings.get("virtual_keyboard")){try{i._build()}catch(e){s.Console.add(e.message+"<br><br>"+e.stack.split("\n").join("<br>"),e.line||e.lineno,e.col||e.colno)}s.Controller.toggle("keybord")}else t.removeAttr("readonly").focus().putCursorAtEnd()},this._build=function(){this.opened=!0,t.addClass("kfocus"),(e=new n({display:{"{bksp}":"⌫","{enter}":"↵","{shift}":"⇧","{space}":"Space","{RU}":"RU","{EN}":"EN","{abc}":"ABC"},layout:{en:["1 2 3 4 5 6 7 8 9 0 - + = {bksp}","{RU} q w e r t y u i o p [ ]","{abc} a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / : < >",".com @ {space}"],"en-shift":["1 2 3 4 5 6 7 8 9 0 - + = {bksp}","{RU} Q W E R T Y U I O P [ ]","{abc} A S D F G H J K L ; ' {enter}","{shift} Z X C V B N M , . / : < >",".com @ {space}"],abc:["1 2 3 4 5 6 7 8 9 0 - + = {bksp}","{EN} ! @ # $ % ^ & * ( ) [ ]","{RU} - _ = + \\ | [ ] { } {enter}","; : ' \" , . < > / ?","{space}"],"default":["1 2 3 4 5 6 7 8 9 0 - + = {bksp}","{EN} й ц у к е н г ш щ з х ъ","{abc} ф ы в а п р о л д ж э {enter}","{shift} 对不起。 : < >",".com @ {space}"],"ru-shift":["1 2 3 4 5 6 7 8 9 0 - + = {bksp}","{EN} Й Ц У К Е Н Г Ш Щ З Х Ъ","{abc} Ф Ы В А П Р О Л Д Ж Э {enter}","{shift} I S M I T L B Y : < >",".com @ {space}"]},onChange:function(e){t[0].value=e},onKeyPress:function(e){"{shift}"===e||"{abc}"===e||"{EN}"===e||"{RU}"===e?i._handle(e):"{enter}"===e?(s.Hover.reset(),s.SpatialNavigator.setCollection(),o.enter&&o.enter(),i.close()):t.trigger("change"),t.attr("readonly","true").blur()}})).setInput(t[0].value)},this._layout=function(){var t=a.show().find(".hg-button").addClass("selector");s.Hover.update(),s.SpatialNavigator.setCollection(t.toArray()),s.SpatialNavigator.focus(t[0]),t.eq(0).addClass("hovered"),a.find(".hg-button").addClass("selector").on("hover:enter",function(i,n){t.removeClass("hovered"),$(this).addClass("hovered"),s.SpatialNavigator.focus($(this)[0]),n||e.handleButtonClicked($(this).attr("data-skbtn"),i)}).on("hover:active",function(){t.removeClass("hovered"),$(this).addClass("hovered")})},this._handle=function(t){var n=e.options.layoutName,o="default";"{shift}"==t?"default"==n?o="ru-shift":"ru-shift"==n?o="default":"en"==n?o="en-shift":"en-shift"==n&&(o="en"):"{abc}"==t?o="abc":"{EN}"==t?o="en":"{RU}"==t&&(o="default"),e.setOptions({layoutName:o}),i._layout()},this._destroy=function(){try{e.destroy()}catch(e){}},this._getRowKeys=function(){return a.find(".hovered").parent().find(".selector")},this._getRows=function(){return a.find(".hg-row")},this.close=function(){this._destroy(),a.hide(),this.opened=!1},a.on("click",function(e){$(e.target).closest($(".e-keydord__panel")).length||i.opened&&s.History.back()}),s.Controller.add("keybord",{toggle:function(){s.History.fake("keybord"),i._layout()},up:function(){s.SpatialNavigator.canmove("up")?s.SpatialNavigator.move("up"):s.SpatialNavigator.focus(i._getRows().last().find(".selector").last()[0])},down:function(){s.SpatialNavigator.canmove("down")?s.SpatialNavigator.move("down"):s.SpatialNavigator.focus(i._getRows().first().find(".selector").eq(7)[0])},left:function(){s.SpatialNavigator.canmove("left")?s.SpatialNavigator.move("left"):s.SpatialNavigator.focus(i._getRowKeys().last()[0])},right:function(){s.SpatialNavigator.canmove("right")?s.SpatialNavigator.move("right"):s.SpatialNavigator.focus(i._getRowKeys().first()[0])},back:function(){s.Hover.reset(),s.SpatialNavigator.setCollection(),i.close(),o.back?o.back():s.Controller.toggle("content")}})},r.Search=function(){var e,t,i,n,o,a=this,l=$(".b-search"),c=$(".b-search__field"),u=$(".b-search__results"),p=$(".b-search__last"),g=$(".b-search__last-scroll"),v=$(".b-search__mic"),m=!1,_=[],y="",w=[],b=window.SpeechRecognition||window.webkitSpeechRecognition;this.enableSpeechSearch=function(){n||(n=!0,s.is_android?this._bindAndroidSpeech():this._bindBrowserSpeech())},this._bindBrowserSpeech=function(){if(b){s.Console.add("Search voice enable"),v.show().addClass("selector"),v.parent().addClass("mic-enable"),(o=new b).continuous=!0,v.on("hover:enter",function(){v.hasClass("active")?o.stop():o.start()}),c.on("keydown",function(e){37==e.keyCode&&!c.val()&&n&&s.Settings.get("voice_search")&&s.Controller.toggle("search_voice")}),o.addEventListener("start",function(){v.addClass("active"),console.log("Search","voice activated, SPEAK")}),o.addEventListener("end",function(){v.removeClass("active"),console.log("Search","speech recognition service disconnected")}),o.addEventListener("result",function(e){var t=e.resultIndex,i=e.results[t][0].transcript;"stop recording"===i.toLowerCase().trim()||(c.val("")?"go"===i.toLowerCase().trim()||("reset input"===i.toLowerCase().trim()?c.val(""):c.val(i)):c.val(i)),o.stop()}),o.addEventListener("error",function(e){console.log("Search","speech error:",e.error),o.stop()})}else v.remove()},this._bindAndroidSpeech=function(){v.show().addClass("selector"),v.parent().addClass("mic-enable"),v.on("hover:enter",function(){androidApp.voiceStart()}),c.on("keydown",function(e){37==e.keyCode&&!c.val()&&n&&s.Settings.get("voice_search")&&s.Controller.toggle("search_voice")}),window.voiceResult=function(e){console.log("Search","voice result:",e),e&&c.val(e)},o=!0},this._resultEmpty=function(){d.walk(_,"remove"),u.empty(),_=[]},this._loadHints=function(e){if(y!=e&&(y=e,p.hide(),e.length>=3)){a._resultEmpty(),s.Reguest.clear();var t=s.Template.get("cards_load",{}).addClass("anim-in");u.append(t),s.Reguest.silent(s.search_url+encodeURIComponent(e),a._bindResults.bind(a),function(){t.remove()})}},this._bindResults=function(e){if(this._resultEmpty(),e.channels.length){var t=s.Template.get("swipe_horizontal",{});u.append(t),i=new r.Swipe(t,{}),$.each(e.channels,function(e,t){var n=s.Template.get("swipe_slide",{}),o=new r.Card(t.details);o.template.find(".selector").on("hover:enter",function(){s.History.push(s.search_url+encodeURIComponent(c.val().trim())),a._clearTimers(),h.animOut(l),s.Controller.toggle("content"),s.Interface.load(t.playlist_url)}).on("hover:active",function(){i.slideTo(e)}).attr("data-image",""),n.append(o.template),u.find(".b-swipe__wrap").append(n),o.visibility(),_.push(o)}),i.update(),s.Hover.update(),"search_voice"==s.Controller.active_name&&s.SpatialNavigator.focus(v[0]),t.on("mousenter touchstart",function(){c.blur().attr("readonly","true"),s.Controller.once("search_results")})}},this._startListening=function(){clearInterval(t),t=setInterval(function(){a._loadHints(c.val().trim())},2e3)},this._clearTimers=function(){clearInterval(t)},this._pushHistory=function(e){-1==w.indexOf(e)&&(d.insert(w,0,e),w.length>5&&w.pop(),f.set("search_history",JSON.stringify(w)))},this._enter=function(e){setTimeout(function(){a._resultEmpty(),c.blur().attr("readonly","true"),s.History.back(),h.animOut(l),s.Controller.toggle("content"),a._clearTimers();var t=(e||c.val()).trim();if(t&&t.length>=3){a._pushHistory(t);var i=s.search_url+encodeURIComponent(t);s.Reguest.silent(s.search_url+encodeURIComponent(t),function(e){"list"==e.type&&e.channels.length?s.Interface.load(i):$.notify("否为您的请求找到了结果",{className:"info"})},!1)}else $.notify("请求必须超过 3 个字符",{className:"info"})},100)},this._down=function(){if(!c.val()&&w.length)c.blur().attr("readonly","true"),s.Controller.toggle("search_history");else{if(!_.length)return!0;c.blur().attr("readonly","true"),s.Controller.toggle("search_results"),a._pushHistory(c.val().trim())}},this.exit=function(){c.blur().attr("readonly","true"),h.animOut(l),a._clearTimers(),s.Controller.toggle("content")},this._showLast=function(){p.show();var e=$("#search-keys").empty(),t=function(t,i){var n=$('<div class="b-search__last-item selector">'+t+"</div>");return n.on("hover:enter",function(){i()}).on("hover:active",function(){h.scrollUpdate($(this),!0)}),e.append(n),n};$.each(w,function(e,i){t(i,function(){a._enter(i)})}),t("清除",function(){w=[],f.set("search_history",JSON.stringify(w)),s.Controller.toggle("search")}).addClass("clear"),s.Hover.update()},s.Controller.add("search_results",{toggle:function(){var e=$(".selector",u).toArray();s.SpatialNavigator.setCollection(e),s.SpatialNavigator.focus(e[0])},back:function(){h.animOut(l),a._clearTimers(),s.Controller.toggle("content")},enter:function(){s.Hover.enter()},up:function(){s.Controller.toggle("search")},left:function(){s.SpatialNavigator.move("left")},right:function(){s.SpatialNavigator.move("right")},touchLeft:function(){s.Controller.trigger("left")},touchRight:function(){s.Controller.trigger("right")},wheelUp:function(){s.Controller.trigger("left")},wheelDown:function(){s.Controller.trigger("right")}}),s.Controller.add("search_history",{toggle:function(){var e=$("#search-keys > div").toArray();s.SpatialNavigator.setCollection(e),s.SpatialNavigator.focus(e[0])},back:function(){h.animOut(l),a._clearTimers(),s.Controller.toggle("content")},enter:function(){s.Hover.enter()},up:function(){s.SpatialNavigator.canmove("up")?s.SpatialNavigator.move("up"):s.Controller.toggle("search")},down:function(){s.SpatialNavigator.move("down")},wheelUp:function(){s.Controller.trigger("left")},wheelDown:function(){s.Controller.trigger("right")}}),s.Controller.add("search",{toggle:function(){a.enableSpeechSearch(),v.toggle(s.Settings.get("voice_search")),v.parent().toggleClass("mic-enable",s.Settings.get("voice_search")),s.Keybord.open(c,{back:function(){a._down()&&a.exit()},enter:function(){a._enter()}}),_.length||a._showLast()},back:function(){a.exit()},down:a._down,whellDown:a._down,enter:function(){a._enter()}}),s.Controller.add("search_voice",{toggle:function(){c.blur(),s.SpatialNavigator.setCollection(v.toArray()),s.SpatialNavigator.focus(v[0])},back:function(){a.exit()},right:function(){s.Controller.toggle("search")},down:a._down,whellDown:a._down}),$(".e-search").on("hover:enter",function(){m=!1,y="",clearTimeout(e),e=setTimeout(function(){m=!0},300),s.History.fake("search"),h.animIn(l),c.removeAttr("readonly").val("").attr("autocomplete",h.uid()),a._resultEmpty(),o&&!s.is_browser?(_.length||a._showLast(),s.Controller.toggle("search_voice")):s.Controller.toggle("search"),a._startListening()}),$(".b-search__cancel").on("click",function(){h.animOut(l),a._clearTimers(),s.Controller.toggle("content")}),c.on("keydown",function(e){13==e.keyCode&&m&&s.Controller.active.enter(),13==e.keyCode&&(m=!0)}).on("keyup",function(){a._startListening()}).on("click",function(){s.Controller.once("search")});try{w=JSON.parse(f.get("search_history")||"[]")}catch(e){}new r.Scrollbox(g).wheel(!0)},r.Hover=function(){var e,t=this,i=[],n=$(".e-hover").hide(),o={times:0};this.reset=function(){e=!1,this.update()},this.update=function(){$(".selector").removeClass("hover enter");n.css("background","transparent");i=$(".selector").unbind(".hover");$(".selector").on("click.hover",function(e){var time=$(this).data("click-time")||0;if(time+100<Date.now()){i.removeClass("hover enter");if(13!==e.keyCode)$(this).addClass("enter").trigger("hover:enter",[!0])}$(this).data("click-time",Date.now())});t.bindMouseAndTouchLong();t._draw();t.dispatchEvent({type:"update"})},this.focus=function(e,n){i.removeClass("hover enter").trigger("hover:disable"),t.dispatchEvent({type:"hover:active",is_mouse:n,elem:e.addClass("hover").trigger("hover:active",[n])})},this.enter=function(){e&&t.dispatchEvent({type:"hover:enter",elem:e.addClass("enter").trigger("hover:enter")})},this["long"]=function(){e&&t.dispatchEvent({type:"hover:long",elem:e.addClass("long").trigger("hover:long")})},this.draw=function(){this._draw()},this.drawInstantly=function(){this._drawTime()},this._draw=function(){clearInterval(o.time),o.times=0,o.time=setInterval(function(){o.times++,t._drawTime(),o.times>8&&clearInterval(o.time)},100),t._drawTime()},this._rint=function(e){var t=parseInt(e);return t=isNaN(t)?0:t},this._drawTime=function(){if(e){if(e.data("hover-noselect")||s.is_touch)return n.hide();var t=e.offset(),i=e[0].getBoundingClientRect();n.css({transform:"translateX("+t.left+"px) translateY("+t.top+"px)",width:i.width,height:i.height,"border-bottom-left-radius":this._rint(e.css("border-bottom-left-radius")),"border-bottom-right-radius":this._rint(e.css("border-bottom-right-radius")),"border-top-left-radius":this._rint(e.css("border-top-left-radius")),"border-top-right-radius":this._rint(e.css("border-top-right-radius")),background:e.data("hover-background")||"rgba(255,255,255,0.2)"}).show()}},this._keyMove=function(){t.dispatchEvent({type:"hover:keymove"})},this.bindMouseAndTouchLong=function(){$(".selector").each(function(){var selector=$(this);var timer;var position=0;var trigger=function(){clearTimeout(timer);timer=setTimeout(function(){var time=selector.data("time-long")||0;if(time+100<Date.now()){var mutation=Math.abs(position-(selector.offset().top+selector.offset().left));if(mutation<30)selector.trigger("hover:long",[true])}selector.data("long-time",Date.now())},800);position=selector.offset().top+selector.offset().left};selector.on("mousedown.hover touchstart.hover",trigger).on("mouseout.hover mouseup.hover touchend.hover touchmove.hover",function(e){clearTimeout(timer)})})},this.bindMouseOrTouch=function(name){$(".selector").on(name+".hover",function(e){if($(this).hasClass(".selector")){$(".selector").removeClass("hover enter");n.css("background","transparent");$(".selector").unbind(".hover")}});if(name=="mouseenter")$(".selector").on("mouseleave.hover",function(){$(this).removeClass("hover")})},this.addEventListener("hover:active",function(i){e=i.elem,t._draw()})},r.Swipe=function(e,t){var i=this,n={},o=!0;this.elem_box=e,this.elem_wrap=$("> .b-swipe__wrap",this.elem_box),this.elem_items=$("> .b-swipe__item",this.elem_wrap),this.elem_navigation=$('<div class="b-swipe__navigation"></div>').appendTo(e),$(".b-swipe",this.elem_items).on("mouseenter",function(){o=!1}).on("mouseleave",function(){o=!0}),d.extend(t,{orintation:"horisontal",scroll:!1,hideout:!0}),this.position=0,this.total=this.elem_items.length,this.isStart=!0,this.isEnd=!1,this.slideNext=function(){this._moveTo(this.position+1)},this.slidePrev=function(){this._moveTo(this.position-1)},this.slideTo=function(e){this._moveTo(e)},this.toLast=function(){this.slideTo(this.total-1)},this.toFirst=function(){this.slideTo(0)},this.update=function(){this.elem_items=$("> .b-swipe__item",this.elem_wrap),this.total=this.elem_items.length,t.hideout&&this.elem_items.addClass("hideout")},this.reset=function(){this.update(),this.slideTo(0)},this._initial=function(){t.scroll&&this.elem_box.on("mousewheel",function(e){if(o){if(e.preventDefault(),n.scroll)return;n.scroll=!0,setTimeout(function(){n.scroll=!1},300),e.originalEvent.wheelDelta>0||e.originalEvent.detail<0?i.slideNext():i.slidePrev()}}),t.hideout&&this.elem_items.addClass("hideout"),"horisontal"==t.orintation&&s.Hover.addEventListener("hover:active",function(e){e.elem.closest(i.elem_wrap).length&&i.position-i.elem_items.index(e.elem.parents(".b-swipe__item"))}),t.effect&&this.elem_box.addClass("b-swipe--"+t.effect),this.slideTo(0)},this._draw=function(){var e=this.elem_items.index(this.elem_items.filter(".swipe-viewed"));e!==this.position&&(this.elem_items.removeClass("swipe-active anim-in swipe-viewed").eq(this.position),this.elem_items.removeClass("swipe-viewed"));var i=this.elem_items.eq(this.position).addClass("swipe-viewed");if("scaled"==t.effect&&window.innerWidth>950)e!==this.position&&i.addClass("swipe-active anim-in");else if(i.length){var n={slide:i.offset(),box:this.elem_box.offset(),wrap:this.elem_wrap.offset()},o="";o="horisontal"==t.orintation?"translateX("+Math.round(n.wrap.left+n.box.left-n.slide.left-n.box.left)+"px)":"translateY("+Math.round(n.wrap.top+n.box.top-n.slide.top-n.box.top)+"px)",this.elem_wrap.css({transform:o})}},this._drawNavigation=function(){if(t.navigation&&(this.elem_navigation.empty(),this.total>1))for(var e=0;e<this.total;e++)this.elem_navigation.append("<div"+(e==this.position?' class="active"':"")+"></div>")},this._hideout=function(e){t.hideout&&this.elem_items.removeClass("novisible").slice(0,this.position).addClass("novisible")},this._moveTo=function(e){this.position=Math.max(0,Math.min(this.total-1,e)),0!=this.position||this.isStart?this.position!=this.total-1||this.isEnd||(this.isEnd=!0,this.dispatchEvent({type:"end"})):(this.isStart=!0,this.dispatchEvent({type:"start"})),this.position>0&&(this.isStart=!1),this.position<this.total-1&&(this.isEnd=!1),this._drawNavigation(),this.dispatchEvent({type:"move"}),this._draw(),this._hideout(this.position-e)},this._initial()},Object.assign(r.Swipe.prototype,u.prototype),r.Cards=function(e,t){var i=this,n=!1;d.extend(t,{title:""}),this.items=[],this.slides=[],this.index=0,this.templates={},this.templates.content=s.Template.get("cards",{title:h.substr(t.title,82)}),this.templates.wrap=$(".b-swipe__wrap",this.templates.content).addClass("cards-line"),this.templates.foot=$(".b-cards__foot",this.templates.content),this.templates.head=$(".b-cards__head",this.templates.content),this.templates.load=s.Template.get("cards_load",{}),this.templates.pagination=s.Template.get("pagination",{}),this.templates.sort=s.Template.get("btn_sort",{}).addClass("b-cards__btn-all"),t.is_category;var o=function(e){s.Interface.last().indexOf(e)>-1&&void 0!==t.id&&(i.templates.bookmark=$('<div class="btn-handle btn selector">已添加书签</div>'),i.templates.bookmark.on("hover:enter",function(){t.viewed?(t.viewed=!1,s.Reguest.silent(s.domain_url+"/"+e+"/bookmarks/remove?id="+t.id),$.notify("已添加书签",{className:"white"}),$(this).text("已添加书签")):(t.viewed=!0,s.Reguest.silent(s.domain_url+"/"+e+"/bookmarks/add?id="+t.id),$.notify("已添加书签",{className:"white"}),$(this).text("删除"))}),t.viewed&&i.templates.bookmark.text("删除"),i.templates.head.append(i.templates.bookmark))};o("compilations"),o("actors"),this.mousenter=function(){this.templates.wrap.on("mouseenter touchstart",function(){i.toggle()})},this.item=function(e){var t=new r.Card(e.details),n=s.Template.get("cards_slide",{});n.append(t.template),e.details.watched?n.find(".e-card").append("<style>.id_"+e.details.id+'.e-card__progress:after {content: "";display: block;background: #fff;opacity: 1;height: 100%;border-radius: 1px;transition: width .2s ease-out;width:'+e.details.current/e.details.time*100+"%} </style>"):n.find(".e-card__progress").addClass("hide"),e.details.newepisode?n.find(".e-card__date").append('<span class="elem-labe">新电视剧</span>'):e.details.nowatch&&n.find(".e-card__date").append('<span class="elem-labe">新</span>'),e.details.is_tv?n.find(".e-card__date").append('<span class="elem-labe">电视剧</span>'):true,"compilations"==i._typelist&&t.template.addClass("compilation").addClass("nochang"),this.templates.wrap.append(n);if(e.details.tags){e.details.tags.map(function(tag,key){if(tag=="camrip")n.find(".e-card__acens").append('<div class="e-card__tag" style="top: '+parseFloat(2+key*2.5)+'em"><img src="'+s.domain_web+'/img/icons/camrip_black.svg"</div>');else n.find(".e-card__acens").append('<div class="e-card__tag" style="top: '+parseFloat(2+key*2.5)+'em">'+tag+"</div>")})}$(".selector",t.template).on("hover:active",function(t){i.dispatchEvent({type:"card:hover"});if(!e.details.is_torrent){i.templates.descr=s.Template.get("cards_descr",e.details);e.details.iscast&&i.templates.descr.find(".e-create").remove();e.details.rating_imdb&&i.templates.descr.find(".b-cards-desc__line").append(h.stars(e.details.rating_imdb,e.details.rating_kp));"compilations"!==i._typelist&&i.templates.foot.show().empty().append(i.templates.descr)}else i.templates.foot.find(".b-cards-desc").hide();i.last=$(this);i._pagination($(this))}).on("hover:enter",function(){s.Interface.load(e.playlist_url)}).on("hover:long",function(){if(!s.auth)return s.Modal.open(s.Template.get("noauth_faq"),"您必须注册或登录","content");s.Reguest.silent(s.domain_url+"/user/card_details?id="+e.details.id,function(result){s.Drop.open("操作 "+(e.details.is_tv?"电视剧":"电影")+' "'+e.details.name+'"',[{title:result.is_bookmark?"从书签中删除":"书签",action:s.domain_url+"/bookmarks/"+(result.is_bookmark?"remove":"add")+"?id="+e.details.id},{title:"标记"+(result.is_watched?" 未观看":" 已查看"),action:s.domain_url+"/timeline/"+(result.is_watched?"unwatch":"watch")+"?ident="+e.details.id+"&all=true"},{title:"返回"}],function(callback){if(callback.action)s.Reguest.silent(callback.action)},"content")})}).data("page",this.page?this.page.current:1),this.slides.push(n),this.items.push(t)},this.loadComplite=function(e,o){e.page&&(this.page=e.page),t.from_cache||i.templates.load.find(".e-card").removeClass("anim-in").addClass("anim-out"),t.from_cache=!1,this._typelist=e.type,setTimeout(function(){i.templates.load.detach(),n=!1,i._appendItems(e.channels),o&&o()},s.Settings.get("animation")?e.from_cache?0:300:0)},this.loadNext=function(e){var t=e||i.page.next;t&&(i.templates.wrap.append(i.templates.load),i.templates.load.find(".e-card").addClass("anim-in"),s.Reguest.silent(t,this.loadComplite.bind(this)))},this.firstLoad=function(e,n){t.from_cache||(i.templates.wrap.append(i.templates.load),i.templates.load.find(".e-card").addClass("anim-in")),s.Reguest.need.cache=!0,s.Reguest.silent(e,function(e){i.loadComplite(e,function(){if(e.channels.length)n();else{var o=s.Template.get("cards_empty",{});o.find(".e-card__acens").addClass("selector"),o.find(".selector").on("hover:active",function(){i.dispatchEvent({type:"card:hover"})}),i.templates.pagination.remove(),t.is_category=!1,i.templates.wrap.append(o)}})})},this.toggleHead=function(){s.Controller.add("cards_head",{toggle:function(){s.SpatialNavigator.setCollection($(".selector",i.templates.head).toArray()),i.last_head?s.SpatialNavigator.focus(i.last_head.toArray()[0]):s.SpatialNavigator.focus($(".selector",i.templates.head).toArray()[0])},up:function(){i.dispatchEvent({type:"move:up"})},down:function(){i.toggle()},left:function(){s.SpatialNavigator.move("left")},right:function(){s.SpatialNavigator.move("right")}}),s.Controller.toggle("cards_head")},this.visibility=function(){d.walkReverse(i.items.slice(i.swipe.position,i.swipe.position+10),"visibility")},this.toggle=function(){var e=function(){s.SpatialNavigator.canmove("left")?(i.swipe.slidePrev(),s.SpatialNavigator.move("left")):s.Controller.toggle("menu"),i.dispatchEvent({type:"move:left"})},t=function(){i.swipe.position>=i.swipe.total-6&&!n&&(n=!0,i.loadNext()),i.swipe.slideNext(),s.SpatialNavigator.move("right"),i.dispatchEvent({type:"move:right"}),i.visibility()};s.Controller.add("cards",{toggle:function(){s.Hover.update(),s.SpatialNavigator.setCollection($(".selector",i.templates.wrap).toArray()),i.last?s.SpatialNavigator.focus(i.last.toArray()[0]):i.slides[0]?s.SpatialNavigator.focus(i.slides[0].find(".selector").toArray()[0]):s.SpatialNavigator.focus($(".selector",i.templates.wrap).toArray()[0]),i.visibility(),setTimeout(function(){i.swipe._draw()},s.Settings.get("animation")?300:0)},up:function(){i.dispatchEvent({type:"move:up"})},down:function(){i.dispatchEvent({type:"move:down"})},left:e,right:t,wheelUp:function(e){$(e.target).parents(".cards-line").length||$(e.target).hasClass("cards-line")?s.SpatialNavigator.canmove("left")&&(i.swipe.slidePrev(),s.SpatialNavigator.move("left"),i.dispatchEvent({type:"move:left"})):i.dispatchEvent({type:"move:up"})},wheelDown:function(e){$(e.target).parents(".cards-line").length||$(e.target).hasClass("cards-line")?t():s.Controller.trigger("down")},touchRight:t,touchLeft:e,touchUp:function(e){i.dispatchEvent({type:"move:up"})},touchDown:function(e){i.dispatchEvent({type:"move:down"})},back:function(){s.Controller.toggle("menu")},touchspeed:!0}),s.Controller.toggle("cards")},this.remove=function(){d.walkReverse(this.items,"remove"),this.items=null,this.slides=null},this._pagination=function(e){var i=e.data("page");if(s.State.set(t.playlist_url,{page:i}),t.is_category){var n=Math.max(1,i-2);$(".btn:first-child",this.templates.pagination).attr("data-url",t.playlist_url),$(".pg",this.templates.pagination).removeClass("active").each(function(e){var o=$(this),a=n+e;o.text(a).attr("data-url",h.addUrlParams(t.playlist_url,"page="+a)).attr("data-page",a),i==a&&o.addClass("active")}),$(".btn:last-child",this.templates.pagination).attr("data-url",h.addUrlParams(t.playlist_url,"page="+(i+1)))}},this._appendItems=function(e){for(var t=0;t<e.length;t++)this.item(e[t]);this.swipe.update(),this.dispatchEvent({type:"append:items"})},this._replaceItems=function(e){this.templates.wrap.empty(),this.slides=[],this.items=[],this.last=!1,this.page=e.page,this.swipe.reset(),this.loadComplite(e,function(){i.last=!1,i.swipe.reset(),i.dispatchEvent({type:"replace:items"})})},this._initialItems=function(){if(t.items){if(this.page=t.page,t.items.length)this._appendItems(t.items);else{var e=s.Template.get("cards_empty",{});this.templates.wrap.append(e)}setTimeout(function(){i.dispatchEvent({type:"append:items"}),i._toLastSelect()},10)}else{var o=s.State.get(t.playlist_url,{}).page;this.firstLoad(h.addUrlParams(t.playlist_url,"page="+(o||1)),function(){i._toLastSelect(),i.swipe.position>=i.swipe.total-6&&!n&&(n=!0,i.loadNext())})}},this._toLastSelect=function(){var e=i._prefix(),t=s.State.get(s.Interface.last(),{})[e];if(t)return d.walkReverse(i.items.slice(0,t+10),"visibility"),i.swipe.slideTo(t),i.swipe.update(),i.last=$(".selector",i.templates.wrap).eq(t),s.SpatialNavigator.focus(i.last[0]),!0},this._prefix=function(){return this.index+"_cd"},this._initialSwipe=function(){this.swipe=new r.Swipe($(".b-swipe",this.templates.content),{mousewheel:!0}),this.swipe.addEventListener("move",function(){var e=Math.floor(i.swipe.position/15),t={};t[i._prefix()]=i.swipe.position-15*e,s.State.set(s.Interface.last(),t)})},this._initial=function(){this._initialSwipe(),this._initialItems(),$(".selector",this.templates.head).on("hover:active",function(e,t){i.last_head=$(this)}).on("hover:enter",function(){$(this).attr("data-url")&&(s.Reguest.clear(),s.Loader.show(),s.Reguest.silent($(this).attr("data-url"),function(e){if(0==e.channels.length)return $.notify("列表为空",{className:"white"});i.templates.foot.hide(),i._replaceItems(e)}))})},this._initial()},Object.assign(r.Cards.prototype,u.prototype),r.Present=function(e,t){var i=this;d.extend(t,{title:""}),this.items=[],this.slides=[],this.index=0,this.templates={},this.templates.content=s.Template.get("swipe_vertival",{}),this.templates.wrap=$(".b-swipe__wrap",this.templates.content),this.templates.foot=$("<div></div>"),this.templates.head=$("<div></div>"),this.templates.load=$("<div></div>"),this.mousenter=function(){this.templates.wrap.on("mouseenter touchstart",function(){i.toggle()})},this.item=function(e){e.details.name=h.substr(e.details.name,82);var t=s.Template.get("present",e.details),n=s.Template.get("swipe_slide",{});n.append(t),e.details.rating_imdb&&t.find(".b-present__rating").append(h.stars(e.details.rating_imdb,e.details.rating_kp)),$(".b-present__entii",t).append(e.details.genre.split(",").map(function(e){return"<li>"+e+"</li>"}).join("")),this.templates.wrap.append(n),t.on("hover:active",function(e){i.last=$(this),i.dispatchEvent({type:"card:hover"})}).on("hover:enter",function(){s.Interface.load(e.playlist_url)}).attr("data-image",h.bg(e.details)),this.slides.push(n),this.items.push(t)},this.toggle=function(){var e=function(){i.swipe.position<1?s.Controller.toggle("menu"):(i.swipe.slidePrev(),s.Hover.focus(i.items[i.swipe.position])),i._customRotate(),i.dispatchEvent({type:"move:left"})},t=function(){i.swipe.slideNext(),s.Hover.focus(i.items[i.swipe.position]),i._customRotate(),i.dispatchEvent({type:"move:right"})};s.Controller.add("cards",{toggle:function(){s.Hover.update(),s.SpatialNavigator.setCollection($(".selector",i.templates.wrap).toArray()),i.last?s.SpatialNavigator.focus(i.last.toArray()[0]):i.slides[0]?s.SpatialNavigator.focus(i.slides[0].find(".selector").toArray()[0]):s.SpatialNavigator.focus($(".selector",i.templates.wrap).toArray()[0]),setTimeout(function(){i.swipe._draw()},s.Settings.get("animation")?300:0)},up:function(){i.dispatchEvent({type:"move:up"})},down:function(){i.dispatchEvent({type:"move:down"})},left:e,right:t,wheelUp:function(e){i.dispatchEvent({type:"move:up"})},wheelDown:function(e){i.dispatchEvent({type:"move:down"})},touchRight:t,touchLeft:e,touchUp:function(e){i.dispatchEvent({type:"move:up"})},touchDown:function(e){i.dispatchEvent({type:"move:down"})},back:function(){s.Controller.toggle("menu")},touchspeed:!0}),s.Controller.toggle("cards")},this.visibility=function(){},this.remove=function(){this.items=null,this.slides=null},this._appendItems=function(e){for(var t=0;t<e.length;t++)this.item(e[t]);this.swipe.update(),this.swipe.slideTo(0),this._initialRotate(),this.dispatchEvent({type:"append:items"})},this._firstLoad=function(e,t){s.Reguest.silent(e,function(e){i._appendItems(e.channels)})},this._customRotate=function(){clearInterval(s.intervals.main),clearTimeout(s.timers.main),s.timers.main=setTimeout(function(){i._initialRotate()},2e4)},this._initialSwipe=function(){this.swipe=new r.Swipe(this.templates.content,{mousewheel:!0,orintation:"vertical",effect:"scaled",navigation:!0}),this.templates.content.addClass("b-swipe--present")},this._initialItems=function(){if(t.items)if(t.items.length)this._appendItems(t.items);else{var e=s.Template.get("cards_empty",{});this.templates.wrap.append(e)}else this._firstLoad(t.playlist_url)},this._initialRotate=function(){clearInterval(s.intervals.main),s.intervals.main=setInterval(function(){i.swipe.isEnd?i.swipe.slideTo(0):i.swipe.slideNext(),s.Hover.focus(i.items[i.swipe.position])},15e3)},this._initial=function(){this._initialSwipe(),this._initialItems()},this._initial()},Object.assign(r.Present.prototype,u.prototype),r.Card=function(e){var t=this,i=new Image;i.crossOrigin="Anonymous",d.extend(e,{director:"",name_short:h.breakText(h.substr(e.name,35)),about:"",country:"未知",genre:"未知",released:""}),e.director=e.director.split(",")[0]||"未知",e.about=h.substr(e.about,250),e.about||(e.about="无描述");var n=!e.poster;n&&(e.poster=s.domain_web+"/img/icons/img-torrent-empty.svg"),e.poster||"two"!=s.Settings.get("interface_type")||(e.poster=s.domain_web+"/img/icons/img-torrent-empty.svg"),this.template=s.Template.get("card",e);this._initial=function(){this.template.addClass("anim-in"),setTimeout(function(){t.template.removeClass("anim-in")},s.Settings.get("animation")?300:0),i.onload=function(){t.template.find(".e-card__img")[0].src=i.src},i.onerror=function(n){t.template.find(".e-card__img")[0].src=e.ignore_cors?i.src:s.domain_web+"/img/icons/img-broken.svg"},n||e.nobackground?this.template.find(".e-card__img").css({background:h.stringToHslColor(e.name+Math.random(),80,65)}):$(".selector",this.template).attr("data-image",h.bg(e))},this.remove=function(){i.src=""},this.visibility=function(){this.visible||(this.visible=!0,i.src="two"==s.Settings.get("interface_type")?h.poster(e,"w400"):e.poster,this.template.addClass("loaded"))},this._initial()},Object.assign(r.Cards.prototype,u.prototype),r.Background=function(){var e,t,i,n=this,o={one:{background:$("#bg-one"),canvas:$("#bg-one .e-background__canvas"),img:$("#bg-one .e-background__img"),ctx:$("#bg-one .e-background__canvas")[0].getContext("2d")},two:{background:$("#bg-two"),canvas:$("#bg-two .e-background__canvas"),img:$("#bg-two .e-background__img"),ctx:$("#bg-two .e-background__canvas")[0].getContext("2d")}},a="one",r={},l=document.createElement("canvas"),c=l.getContext("2d");l.width=30,l.height=17,this.img_opacity=.2,this.stop_rotate=!1,this._rgb=function(e){return"rgba("+e.join(",")+",0.5)"},this.palette=function(e){for(var t={bright:[0,0,0],dark:[255,255,255]},i=0,n=0,o=0,a=e.length,s=0,r=765,l=0;l<e.length;l++){var c=e[l],d=c[0]+c[1]+c[2];i+=c[0],n+=c[1],o+=c[0],d>s&&(s=d,t.bright=c),d<r&&(r=d,t.dark=c)}return t.average=[Math.round(i/a),Math.round(n/a),Math.round(o/a)],t},this._bg=function(){return o[a].background.removeClass("visible"),o[a="one"==a?"two":"one"]},this._drawCanvas=function(e){var t=n._bg(),i=n["static"]&&!s.Settings.get("background_view");t.canvas[0].width=t.canvas.width(),t.canvas[0].height=t.canvas.height();var o=-45*Math.PI/180,a=t.canvas[0].width*Math.cos(o),r=t.canvas[0].height*Math.sin(o),l=e.palette;t.ctx.filter=e.img.width>1e3||i?"":"blur(14px)";var c=t.ctx.createLinearGradient(0,0,a,r);c.addColorStop(1,n._rgb(l.bright)),c.addColorStop(0,n._rgb(l.dark)),c.addColorStop(.5,n._rgb(l.average)),t.ctx.fillStyle=c,s.Settings.get("background_gradient")&&t.ctx.fillRect(0,0,t.canvas[0].width,t.canvas[0].height);var d=Math.max(t.canvas[0].width/e.img.width,t.canvas[0].height/e.img.height);t.ctx.globalAlpha=n.img_opacity;var u=e.img.width*d,p=e.img.height*d;i||t.ctx.drawImage(e.img,-(u-t.canvas[0].width)/2,-(p-t.canvas[0].height)/2,u,p),t.ctx.globalAlpha=1,n["static"]&&(t.ctx.globalCompositeOperation="destination-out",(c=t.ctx.createLinearGradient(0,0,0,t.canvas[0].height)).addColorStop(.5,"rgba(255, 255, 255, 0)"),c.addColorStop(1,"rgba(255, 255, 255, 0.9)"),t.ctx.fillStyle=c,t.ctx.fillRect(0,0,t.canvas[0].width,t.canvas[0].height)),"two"==s.Settings.get("interface_type")&&(t.ctx.globalCompositeOperation="destination-out",(c=t.ctx.createLinearGradient(0,t.canvas[0].height,t.canvas[0].width,0)).addColorStop(.3,"rgba(255, 255, 255, 1)"),c.addColorStop(.8,"rgba(255, 255, 255, 0)"),t.ctx.fillStyle=c,t.ctx.fillRect(0,0,t.canvas[0].width,t.canvas[0].height)),t.background.addClass("visible")},this._startRotate=function(){s.timers.bg_rotate=setInterval(this._drawRotate.bind(this),7e3)},this._drawRotate=function(){if(_rotate)if(d.isObject(_rotate)){if(n.stop_rotate||$("#player").is(":visible"))return;_rotate.ids?(null==_rotate.pos&&(_rotate.pos=0),n.setStatic(_rotate.pattern.replace("{quality}","w1280").replace("{id}",_rotate.ids[_rotate.pos])),_rotate.pos++,_rotate.pos>=_rotate.ids.length&&(_rotate.pos=0)):n.setStatic(_rotate.backdrop)}else n.setStatic(_rotate),_rotate=!1},this._getPalette=function(e){var t=Math.max(l.width/e.width,l.height/e.height),i=e.width*t,n=e.height*t;c.drawImage(e,-(i-l.width)/2,-(n-l.height)/2,i,n);var o=c.getImageData(0,0,l.width,l.height);return h.getColors(o,500,1)},this.draw=function(){if(r[i])this._drawCanvas(r[i]);else if(i){var e=i,t=new Image;t.crossOrigin="Anonymous",t.onload=function(){var i;try{i=n._getPalette(t)}catch(e){i=[[200,200,200],[100,100,100],[10,10,10]]}r[e]={img:t,palette:n.palette(i)},n._drawCanvas(r[e])},t.src=i}},this.set=function(a){return a&&(a=a.replace("https://","https://")),clearTimeout(e),clearTimeout(t),!1,a?i!=a&&s.Settings.get("background")?void(e=setTimeout(function(){i=a,n.draw()},1e3)):this.clear():(o.one.background.removeClass("visible"),void o.two.background.removeClass("visible"))},this.setStatic=function(e){e&&(e=e.replace("https://","https://")),this["static"]=e,i=e,n.draw()},this.load=function(e){e.api?s.Reguest.last(e.api,function(t){t&&t.backdrop?n.set(t.backdrop):n.set(e.bg||e.poster)}):n.set(e.bg||e.poster)},this.rotate=function(e){var t=e.bg_poster;_rotate=!1,n._startRotate(),t&&s.Settings.get("background_view")?t.tmdbapi?s.Reguest.last(t.tmdbapi,function(i){i&&i.backdrop?_rotate=i:_rotate=t.backdrop?t:e.poster,n._drawRotate()}):(_rotate=t.backdrop?t:e.poster,n._drawRotate()):(_rotate=e.poster,n._drawRotate())},this.clear=function(){},this.reset=function(){this["static"]=!1,this.img_opacity="two"==s.Settings.get("interface_type")?.8:.2,this.stop_rotate=!1,this._loaded={},!1,i="",this.clear()}},r.Scrollbox=function(e){e.scrollbar();var t=false,$this=this,child=e.children()[0];e.on("mousewheel",function(e){t||e.preventDefault()}),this.update=function(elem,tocenter){var ofs_elem=elem.offset().top,ofs_box=child.offset().top,center=ofs_box+(tocenter?e.offset().top/2-elem.offset().top/2:0),scrl=Math.min(0,center-ofs_elem);scrl=$this.maxOffset(scrl);$this.reset();child.css("transform","translateY("+scrl+"px)")},this.maxOffset=function(offset){var w=e.height();offset=Math.min(0,offset);return offset},this.reset=function(offset){e.css("transform","translateY(0px)");e.css("margin","0px")};this.wheel=function(e){t=e}},r.Template=function(){this.get=function(e,t,i){var n=g[e];for(var o in t)n=n.replace(new RegExp("{"+o+"}","g"),t[o]);return n=n.replace(/{\@([a-z_-]+)}/g,function(e,t){return g[t]||""}),i?n:$(n)}},r.Splash=function(){var e,t,i,n,o=$("#screen"),a={one:$("#screen .b-screen__actum img").eq(0),two:$("#screen .b-screen__actum img").eq(1)},r="one",l={};this._bg=function(){return a[r="one"==r?"two":"one"]},this._draw=function(e){l.from||this._drawImage(e),l.from?(l.to=e,this._drawImage(e)):l.from=e},this._redraw=function(){},this.opened=function(){return n},this._drawImage=function(e){var t=a[r],s=this._bg();s[0].src=e.src,clearInterval(i),i=setTimeout(function(){s.addClass("visible"),t.removeClass("visible"),o.toggleClass("flip"),n&&o.fadeIn(300)},8e3)},this._getNewImg=function(e){var t=new Image;t.crossOrigin="Anonymous",t.onload=function(){e(t)};var i="https://source.unsplash.com/1600x900/?nature?r="+Math.random();s.Settings.get("screen_4k")&&(i="https://source.unsplash.com/3840x2160/?nature"),t.src=i},this._getFreImg=function(){return this._getNewImg(this._draw.bind(this))},this._rotate=function(){n&&this._getFreImg()},this._startRotate=function(){clearInterval(t),t=setInterval(this._rotate.bind(this),6e4)},this.show=function(){s.Settings.get("screen")&&(n=!0,this._getFreImg(),this._startRotate())},this.hide=function(){n=!1,o.fadeOut(300),clearInterval(t),clearTimeout(i)},this.reset=function(){clearTimeout(e),e=setTimeout(this.show.bind(this),3e5),this.hide()},this.draw=function(){},this.resize=function(){this._redraw()},this.reset()},r.State=function(){var e={};this.get=function(t,i){var n=e[t]||{};return d.extend(n,i),n},this.set=function(t,i){e[t]||(e[t]={}),d.extend(e[t],i,!0)},this.clear=function(t){t?delete e[t]:e={}}},r.Drop=function(){var e,t=this,i=$("#drop-box"),n=$("#drop-box-list"),o=$("#drop-box-name"),a="content";this._list=function(t){n.empty(),$(t).each(function(t,i){if(!i.hide){var o=s.Template.get("playlist_item",i);o.on("hover:enter",function(){s.History.back(),e&&e(i),e=!1}),i.selected&&o.addClass("select"),i.sortempty&&o.addClass("empty"),n.append(o)}}),scroll_element=new r.Scrollbox(n),s.Hover.update(),n.find(".select").length||n.find(".selected").eq(0).addClass("select")},this.open=function(t,n,r,l){a=l||"content",e=r,o.text(t),this._list(n),i.fadeIn(s.Settings.get("animation")?300:0),s.Controller.toggle("drop")},this.close=function(){i.fadeOut(s.Settings.get("animation")?300:0)},s.Controller.add("drop",{toggle:function(){s.History.fake("drop");var e=$(".selector",n),t=e.filter(".select");s.SpatialNavigator.setCollection(e.toArray()),s.SpatialNavigator.focus(t.toArray()[0]),h.scrollUpdate(n.find(".selector.hover"),!0)},up:function(){s.SpatialNavigator.move("up"),h.scrollUpdate(n.find(".selector.hover"),!0,s.Settings.get("animation")?true:false)},down:function(){s.SpatialNavigator.move("down"),h.scrollUpdate(n.find(".selector.hover"),!0,s.Settings.get("animation")?true:false)},back:function(){s.Controller.toggle(a),t.close()},wheelUp:function(){s.SpatialNavigator.move("up"),h.scrollUpdate(n.find(".selector.hover"),!0,s.Settings.get("animation")?true:false)},wheelDown:function(){s.SpatialNavigator.move("down"),h.scrollUpdate(n.find(".selector.hover"),!0,s.Settings.get("animation")?true:false)}}),i.on("click",function(e){$(e.target).closest($(".b-upload__body")).length||(s.Controller.toggle(a),t.close())})},r.Noti=function(){var e,t=this,i=$("#drop-box"),n=$("#drop-box-list"),o=$("#drop-box-name"),a="content";this._list=function(t){n.empty(),$(t).each(function(t,i){var o=s.Template.get("noti_"+i.type,i);o.on("hover:enter",function(){if(i.type!="info"){s.History.back(),setTimeout(function(){e&&e(i),e=!1},300)}}),i.selected&&o.addClass("select"),i.sortempty&&o.addClass("empty"),n.append(o)}),new r.Scrollbox(n),s.Hover.update(),n.find(".select").length||n.find(".selected").eq(0).addClass("select")},this.open=function(t,n,r,l){a=l||"content",e=r,o.text(t),this._list(n),i.fadeIn(s.Settings.get("animation")?300:0),s.Controller.toggle("noti")},this.close=function(){i.fadeOut(s.Settings.get("animation")?300:0)},s.Controller.add("noti",{toggle:function(){s.History.fake("noti");var e=$(".selector",n),t=e.filter(".select");s.SpatialNavigator.setCollection(e.toArray()),s.SpatialNavigator.focus(t.toArray()[0]),h.scrollUpdate(n.find(".selector.hover"),!0,s.Settings.get("animation")?true:false)},up:function(){s.SpatialNavigator.move("up"),h.scrollUpdate(n.find(".selector.hover"),!0,s.Settings.get("animation")?true:false)},down:function(){s.SpatialNavigator.move("down"),h.scrollUpdate(n.find(".selector.hover"),!0,s.Settings.get("animation")?true:false)},back:function(){s.Controller.toggle(a),t.close()},wheelUp:function(){s.SpatialNavigator.move("up"),h.scrollUpdate(n.find(".selector.hover"),!0,s.Settings.get("animation")?true:false)},wheelDown:function(){s.SpatialNavigator.move("down"),h.scrollUpdate(n.find(".selector.hover"),!0,s.Settings.get("animation")?true:false)}}),i.on("click",function(e){$(e.target).closest($(".b-upload__body")).length||(s.Controller.toggle(a),t.close())});$("#noty").on("hover:enter",function(){if(!s.auth)return s.Modal.open(s.Template.get("noauth_faq"),"需要注册或登录","content");s.Reguest.quiet(s.domain_url+"/notifications",function(result){if(result.length==0)return $.notify("通知列表为空!",{className:"white"});s.Noti.open("通知",result,function(action){if(action.type=="card")s.Interface.load(action.playlist_url)},"content",true)})})},r.Modal=function(){var $this=this,modal=$("#modal-box"),modal_body=$("#modal-body"),modal_title=$("#modal-title"),to_back="content";this._append_content=function(template){modal_body.empty().append(template);s.Hover.update()},this.open=function(template,title,back){back_toggle=back||"content";modal_title.text(title);this._append_content(template);modal.fadeIn(s.Settings.get("animation")?300:0);s.Controller.toggle("modal")},this.close=function(){modal.fadeOut(s.Settings.get("animation")?300:0)},s.Controller.add("modal",{toggle:function(){s.History.fake("modal")},back:function(){s.Controller.toggle(to_back);$this.close()},enter:function(){s.Controller.toggle(to_back);$this.close()}}),modal.on("click",function(){s.Controller.toggle(to_back);$this.close()})},r.YouTube=function(id){var player=false,body=$(".youtube-player"),$this=this,qualities=[],timer;this.create=function(){player=new YT.Player("youtube-player",{height:window.innerHeight,width:window.innerWidth,playerVars:{controls:0,showinfo:0,autohide:1,modestbranding:1,autoplay:1},videoId:id,events:{onReady:function(event){event.target.playVideo();body.show();s.Controller.toggle("youtube");$this.update()},onStateChange:function(state){if(state.data==0){$this.exit()}}}})};this.getQualities=function(){if(qualities.length==0){var api_qualities=player.getAvailableQualityLevels();for(var i=0;i<api_qualities.length;i++){var quality_title=function(){if(api_qualities[i]=="highres")return"最高";else if(api_qualities[i]=="hd1080")return"1080p";else if(api_qualities[i]=="hd720")return"720p";else if(api_qualities[i]=="large")return"高";else if(api_qualities[i]=="medium")return"中";else if(api_qualities[i]=="small")return"差";else return api_qualities[i]};qualities.push({title:quality_title(),id:api_qualities[i]})}}};this.setQuality=function(){$this.getQualities();console.log(qualities);s.Drop.open("选择质量",qualities,function(action){player.setPlaybackQuality(action.id)},"youtube")};this.exit=function(){body.hide();player.destroy();clearTimeout(timer);$("#youtube-player__progress").css("width","0%");s.Controller.toggle("content")};this.play=function(){s.Controller.add("youtube",{toggle:function(){s.History.fake("youtube")},up:function(){$this.setQuality()},right:function(){player.seekTo(player.getCurrentTime()+10,true)},left:function(){player.seekTo(player.getCurrentTime()-10,true)},wheelUp:function(){player.seekTo(player.getCurrentTime()-10,true)},wheelDown:function(){player.seekTo(player.getCurrentTime()+10,true)},gone:function(){$this.exit()},playpause:function(){player.getPlayerState()==1?player.pauseVideo():player.playVideo()},back:function(){$this.exit()}});$this.create()};this.update=function(){timer=setTimeout(function(){var progress=player.getCurrentTime()/player.getDuration()*100;$("#youtube-player__progress").css("width",progress+"%");$this.update()},400)}},r.Console=function(){var e=this,t=$("#console"),i=$("#console-list"),n=[],is_enabled=false;this.add=function(e,t,n){var o=new Date,a=void 0!==t&&void 0!==n?t+":"+n:o.getMinutes()+":"+o.getSeconds();try{i.prepend("<li><span>"+e+"</span><span>"+a+"</span></li>")}catch(e){i.prepend("<li><span>Failed to print line</span></li>")}$("> li",i).slice(15).remove()},this.decodeData=function(e){if(d.isObject(e)||d.isArray(e))e=JSON.stringify(e);else if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)e+="";else{var t=[];for(var i in e)t.push(i+": "+e[i]);e=JSON.stringify(t)}return e=h.substr(e,600)},this.runDebug=function(){$.notify("Debug error activated",{className:"white"}),s.debug_error=!0,window.console.log=function(){for(var t=[];arguments.length;){var i=[].shift.call(arguments);t.push(e.decodeData(i))}n.length&&-1==n.indexOf(t[0])||(t[0]='<span style="color: '+h.stringToHslColor(t[0],50,65)+'">'+t[0]+"</span>",e.add(t.join(" ")))},is_enabled?(t.hide().removeClass("debug"),is_enabled=false):(t.show().addClass("debug"),is_enabled=true)},window.addEventListener("error",function(i){return s.Loader.hide(),e.add((i.error||i).message+"<br><br>"+(i.error?i.error.stack:i.stack||"").split("\n").join("<br>"),i.line||i.lineno,i.col||i.colno),s.debug_error&&(t.show(),s.Controller.toggle("console")),!1}),s.Controller.add("console",{toggle:function(){s.History.fake("console"),t.show()},enter:function(){},back:function(){t.hide(),s.Controller.toggle("menu")}}),window.Console=this,e.timer=setTimeout(function(){},1e4)},r.AVPlay=function(e,t){var i,n,o,a=new u;t.width(window.innerWidth),t.height(window.innerHeight),Object.defineProperty(t,"src",{set:function(e){if(e){i=e,webapis.avplay.open(e),webapis.avplay.setDisplayRect(0,0,window.innerWidth,window.innerHeight),webapis.avplay.setDisplayMethod("PLAYER_DISPLAY_MODE_LETTER_BOX");try{webapis.avplay.setSilentSubtitle(!1)}catch(e){}}},get:function(){}}),Object.defineProperty(t,"currentTime",{set:function(e){webapis.avplay.seekTo(1e3*e)},get:function(){return webapis.avplay.getCurrentTime()/1e3}}),Object.defineProperty(t,"duration",{set:function(){},get:function(){return webapis.avplay.getDuration()/1e3}}),Object.defineProperty(t,"paused",{set:function(){},get:function(){return"PAUSED"==webapis.avplay.getState()}}),Object.defineProperty(t,"audioTracks",{set:function(){},get:function(){for(var e=webapis.avplay.getTotalTrackInfo(),t=[],i=0;i<e.length;i++){var n=e[i];if("AUDIO"==n.type){var o=n.extra_info;d.isObject(o)||(o=JSON.parse(n.extra_info)),t.push({index:n.index,language:o.language,label:""})}}return t}}),Object.defineProperty(t,"textTracks",{set:function(){},get:function(){for(var e=webapis.avplay.getTotalTrackInfo(),t=[],i=0;i<e.length;i++){var n=e[i];if("TEXT"==n.type){var o=n.extra_info;d.isObject(o)||(o=JSON.parse(n.extra_info)),t.push({index:n.index,language:o.track_lang,label:""})}}return t}});var s=function(e){try{"contain"==e?webapis.avplay.setDisplayMethod("PLAYER_DISPLAY_MODE_LETTER_BOX"):webapis.avplay.setDisplayMethod("PLAYER_DISPLAY_MODE_FULL_SCREEN");var t=$("#player"),i=function(){for(var e=webapis.avplay.getCurrentStreamInfo(),t={},i=0;i<e.length;i++){var n=e[i];"VIDEO"==n.type&&(t=JSON.parse(n.extra_info))}return t}();$(".sixx",t).length||$(".e-player__tags",t).append('<li class="sixx">'+i.Width+"x"+i.Height+"</li>")}catch(t){o=e}};t.audioTracksToggle=function(e){console.log("Player","toggle audio ["+e+"]");try{webapis.avplay.setSelectTrack("AUDIO",e)}catch(e){console.log("Player","no change audio:",e.message)}},t.textTracksToggle=function(e){console.log("Player","toggle text ["+e+"]");try{webapis.avplay.setSelectTrack("TEXT",e)}catch(e){console.log("Player","no change text:",e.message)}},t.changeRatio=function(e){s(e)},t.canPlayType=function(){return!0},t.addEventListener=a.addEventListener.bind(a);var r={onbufferingstart:function(){console.log("Player","buffering start"),a.dispatchEvent({type:"waiting"}),a.dispatchEvent({type:"tizen_progress_start"})},onbufferingprogress:function(e){a.dispatchEvent({type:"tizen_progress",percent:e})},onbufferingcomplete:function(){console.log("Player","buffering complete"),a.dispatchEvent({type:"playing"}),a.dispatchEvent({type:"tizen_progress_end"})},onstreamcompleted:function(){console.log("Player","stream completed"),webapis.avplay.stop(),a.dispatchEvent({type:"ended"})},oncurrentplaytime:function(e){a.dispatchEvent({type:"timeupdate"}),o&&(s(o),o=!1)},onerror:function(e){a.dispatchEvent({type:"tizen_error",error:e})},onevent:function(e,t){console.log("Player","event type:",e,"data:",t)},onsubtitlechange:function(t,i,n,o){e.setSubtitles(i)},ondrmevent:function(e,t){}};webapis.avplay.setListener(r),t.load=function(){if(i){webapis.avplay.prepareAsync(function(){n=!0,webapis.avplay.play();try{webapis.avplay.setSilentSubtitle(!1)}catch(e){}a.dispatchEvent({type:"canplay"}),a.dispatchEvent({type:"playing"})},function(e){a.dispatchEvent({type:"tizen_error",error:"code ["+e.code+"] "+e.message})})}},t.play=function(){n&&webapis.avplay.play()},t.pause=function(){n&&webapis.avplay.pause()},this.destroy=function(){webapis.avplay.close()}},r.WindowPlayer=function(e,t){var i,n,o=new u;t.width(window.innerWidth),t.height(window.innerHeight);var a={time:0,duration:0},s={duration:0,time:0,timer:function(){return Math.round(s.duration-s.time)}},r=!0,l=function(e){n.postMessage(e,"*")},c=function(t){var i=t.data;if("time"==i.event){for(var n in i)a[n]=i[n];o.dispatchEvent({type:"timeupdate"})}"init"==i.event&&l({api:"play"}),"paused"==i.event&&(r=!0),"vast_duration"==i.event&&(s.duration=i.data),"vast_time"==i.event&&(s.time=i.data,s.block&&s.block.find("span").text(s.timer())),"quality"==i.event&&e._settingsQualityName(i.data),"vast_start"==i.event&&(s.block||(s.block=$('<div class="elem-vast"><span>'+s.timer()+"</span></div>"),$("#player").append(s.block).addClass("vast"))),"vast_finish"==i.event&&(s.block.remove(),$("#player").removeClass("vast"),l({api:"play"})),"play"==i.event&&(r=!1,l({api:"unmute"}),l({api:"volume",set:1}),l({api:"playlist_folders"})),"start"==i.event&&(l({api:"quality",set:2}),o.dispatchEvent({type:"canplay"}),o.dispatchEvent({type:"playing"}))};Object.defineProperty(t,"src",{set:function(e){e&&(i=e)},get:function(){}}),Object.defineProperty(t,"currentTime",{set:function(e){a.time=e,l({api:"seek",set:e})},get:function(){return a.time}}),Object.defineProperty(t,"duration",{set:function(){},get:function(){return a.duration}}),Object.defineProperty(t,"paused",{set:function(){},get:function(){return r}}),Object.defineProperty(t,"currentLevel",{set:function(e){l({api:"quality",set:e})},get:function(){return 2}}),Object.defineProperty(t,"audioTracks",{set:function(){},get:function(){for(var e=[],t=0;t<10;t++)e.push({index:t,language:"",label:""});return e}}),Object.defineProperty(t,"textTracks",{set:function(){},get:function(){return[]}}),t.audioTracksToggle=function(e){l({api:"audiotrack",set:e})},t.textTracksToggle=function(e){},t.changeRatio=function(){},t.canPlayType=function(){return!0},t.load=function(){t.find("iframe").attr("src",i),n=t.find("iframe")[0].contentWindow},t.play=function(){r=!1,l({api:"play"})},t.pause=function(){r=!0,l({api:"pause"})},t.levels=[{qu:"360p"},{qu:"480p"},{qu:"720p"},{qu:"1080p"},{qu:"2060p"}],t.addEventListener=o.addEventListener.bind(o),window.addEventListener("message",c),this.destroy=function(){s.block&&s.block.remove(),window.removeEventListener("message",c),t.remove()}},r.Kinopub=function(){var e,t=this,i=$(".settings-kp-one"),n=$(".settings-kp-two"),o=$(".settings-kp-three"),a=$(".settings-kp-check"),r=$(".settings-kp-cancel"),l=$(".settings-kp-code"),c=$(".settings-kp-start-check"),u=$(".settings-kp-uri"),p=$(".settings-kp-params"),f=0,g=function(e){if(e.name&&"kp_"==e.name.substr(0,3)){var t=e.name.substr(3);s.Reguest.silent(s.domain_url+"/kinopub/device/set?"+t+"="+e.value+"&id="+f)}};this._getParams=function(){s.Reguest.silent(s.domain_url+"/kinopub/device",function(e){if(e.device){f=e.device.id;var t=e.device.settings;for(var i in t){var o="kp_"+i,a=t[i];if(s.Settings.params[o]){var l={};if(d.isArray(a.value)){for(var c=0;c<a.value.length;c++){var u=a.value[c];l[u.id]=u.label,u.selected&&s.Settings.change(o,u.id)}s.Settings.params[o]=l}else s.Settings.change(o,a.value);s.Settings.updateValue(o)}}n.find(".st-selector").addClass("selector"),p.removeClass("hide"),s.Settings._setCollect(n),s.SpatialNavigator.focus(r[0]),s.Settings.addEventListener("change",g)}})},c.on("hover:enter",function(){n.addClass("hide"),i.addClass("hide"),o.addClass("hide"),p.addClass("hide"),a.removeClass("selector"),r.removeClass("selector"),s.SpatialNavigator.setCollection(),n.find(".st-selector").removeClass("selector"),s.Settings.removeEventListener(g),e="",s.Reguest.silent(s.domain_url+"/kinopub/tied",function(d){d.success?(n.removeClass("hide"),r.addClass("selector"),s.Settings._setCollect(n),s.SpatialNavigator.focus(r[0]),t._getParams(),s.Controller.toggle("settings_kp")):s.auth?s.Reguest.silent(s.domain_url+"/kinopub/oauth2?grant_type=device_code",function(t){i.removeClass("hide"),l.text(t.user_code),a.addClass("selector"),s.Settings._setCollect(i),s.SpatialNavigator.focus(a[0]),e=t.code,u.text(t.verification_uri),s.Controller.toggle("settings_kp")}):(o.removeClass("hide"),s.Settings._setCollect(o),s.SpatialNavigator.focus(c[0]))})}),r.on("hover:enter",function(){s.Drop.open("静音设备",[{title:"验证",selected:!0,confirm:!0},{title:"取消"}],function(e){e.confirm&&s.Reguest.silent(s.domain_url+"/kinopub/remove",function(e){e.status=="200"?c.click():$.notify("无法删除设备")})},"settings")}),a.on("hover:enter",function(){s.Reguest.silent(s.domain_url+"/kinopub/oauth2?grant_type=device_token&code="+e,function(e){c.click()})}),s.Controller.add("settings_kp",{toggle:function(){s.History.fake("settings_kp")},left:function(){s.Controller.toggle("settings")},back:function(){s.Controller.toggle("settings")},down:function(){s.SpatialNavigator.move("down"),h.scrollUpdate(n.find(".selector.hover"),!0)},up:function(){s.SpatialNavigator.move("up"),h.scrollUpdate(n.find(".selector.hover"),!0)}})},r.Filter=function(){for(var e,t,i=this,n=$("#filter-box"),o=n.find(".b-filter__emper .selector"),a=n.find(".b-filter__slide"),r={rating:["任意","от 1","от 2","от 3","от 4","от 5","от 6","от 7","от 8","от 9"],year:["任意","2020-2010","2010-2000","2000-1990","1990-1980","1980-1970","1970-1960","1960-1950"],genre:["Все","传记","操作","西部","军事","侦探","纪录片","戏剧","外国","历史","喜剧","犯罪","情节剧","音乐剧","卡通","音乐剧","冒险","家庭","电视电影","惊悚","恐怖","小说","奇幻"],country:["澳大利亚","奥地利","阿塞拜疆","阿尔巴尼亚","阿尔及利亚","安哥拉","安道尔","南极洲","阿根廷","亚美尼亚","阿富汗","白俄罗斯","比利时","保加利亚","玻利维亚","波斯尼亚和黑塞哥维那","巴西","英国","匈牙利","委内瑞拉","东德","越南","危地马拉","几内亚","德国","香港","格陵兰","希腊","格鲁吉亚","丹麦","埃及","以色列","印度","印度尼西亚","伊拉克","伊朗","爱尔兰","冰岛","西班牙","意大利","哈萨克斯坦","柬埔寨","喀麦隆","加拿大","中国","哥伦比亚","古巴","吉尔吉斯共和国","拉脱维亚","黎巴嫩","立陶宛","墨西哥","摩纳哥","荷兰","新西兰","挪威","阿拉伯联合酋长国","巴基斯坦","巴布亚新几内亚","巴拉圭","秘鲁","波兰","葡萄牙","俄罗斯","沙特阿拉伯","朝鲜","塞尔维亚","塞尔维亚和黑山","新加坡","阿拉伯叙利亚共和国","斯​​洛伐克","斯洛文尼亚","苏联","美利坚合众国","塔吉克斯坦","土耳其","乌兹别克斯坦","乌克兰","乌拉圭","芬兰","法国","克罗地亚","黑山","捷克斯洛伐克","捷克共和国","智利","瑞士","瑞典","厄瓜多尔","爱沙尼亚","南斯拉夫","韩国","日本"],langua:["任何","俄语","乌克兰语"],sort:["未排序","按受欢迎程度","按添加日期","分级"],type:["任何","电影","电视节目","卡通","卡通","纪录片","Doc. Series","TV Shows","Anime"],show4k:["Нет","Да"]},l={year:[],genre:[],country:[],langua:[],rating:[],sort:[],show4k:[],type:[]},c=["year","rating","sort","type","show4k"],u={rating:["1","2","3","4","5","6","7","8","9"],sort:["popular","new","rating"],type:["movie","serial","multfilm","multserial","documovie","docuserial","tvshow","anime"],show4k:["true"]},p={},f=(new Date).getFullYear(),g=0;g<30;g++)r.year.push(f-g);this.open=function(){e=!1,t=!1,a.empty(),o.removeClass("view"),s.History.fake("filter"),h.animIn(n),s.Controller.toggle("filter")},this.close=function(){h.animOut(n),s.Controller.toggle("content")},this._scroll=function(t){var i=e.offset().top;a.css({transform:"translateY(0px)"});var n=t.offset().top;a.css({transform:"translateY("+(i-n)+"px)"})},this._bindlist=function(){$.each(r[t],function(n,o){var s=$('<div><div class="selector b-filter__select">'+o+"</div></div>");s.find(".selector").on("hover:enter",function(){i._scroll(s),a.find(".hovered").removeClass("hovered"),$(this).addClass("hovered"),p[t]=n,0==n?(l[t]=[],a.find(".selected").removeClass("selected")):c.indexOf(t)>-1?(l[t]=[n],a.find(".selected").removeClass("selected"),$(this).addClass("selected")):-1==l[t].indexOf(n)?(l[t].push(n),$(this).addClass("selected")):(d.remove(l[t],n),$(this).removeClass("selected")),e.find("span").text(0==n?"":l[t].length).toggleClass("visible",0!==n)}).on("hover:active",function(){a.find(".hovered").removeClass("hovered"),$(this).addClass("hovered"),i._scroll(s),p[t]=n}),l[t].indexOf(n)>-1&&s.find(".selector").addClass("selected"),a.append(s)}),p[t]?i._scroll(a.find(".selector").eq(p[t])):i._scroll(a.find(".selector").eq(0))},s.Controller.add("filter",{toggle:function(){var t=$(".filter-close, .b-filter__aribu .selector").toArray();s.SpatialNavigator.setCollection(t),s.SpatialNavigator.focus(e?e[0]:t[0])},back:function(){i.close()},up:function(){s.SpatialNavigator.move("up")},down:function(){s.SpatialNavigator.move("down")},right:function(){s.Hover.update(),s.Controller.toggle("filter-select")}}),s.Controller.add("filter-select",{toggle:function(){var e=a.find(".selector");s.SpatialNavigator.setCollection(e),s.SpatialNavigator.focus(p[t]?e[p[t]]:e[0])},up:function(){s.SpatialNavigator.move("up")},down:function(){s.SpatialNavigator.move("down")},left:function(){s.Controller.toggle("filter")},back:function(){i.close()},right:function(){s.SpatialNavigator.move("right")},left:function(){s.SpatialNavigator.canmove("left")?s.SpatialNavigator.move("left"):s.Controller.toggle("filter")},wheelUp:function(){s.SpatialNavigator.move("up")},wheelDown:function(){s.SpatialNavigator.move("down")},touchUp:function(){s.SpatialNavigator.move("up")},touchDown:function(){s.SpatialNavigator.move("down")}}),$(".b-head__filter").on("hover:enter",function(){i.open()}),n.find(".filter-close").on("hover:enter",function(){i.close()}),$(".filter-enter,.filter-close",n).on("hover:active",function(){a.empty()}),o.on("hover:active hover:enter",function(){o.removeClass("view"),e=$(this).addClass("view"),a.empty(),t=$(this).attr("data-type"),i._bindlist()}),$(".filter-enter",n).on("hover:enter",function(){var e=s.domain_url+"/list?",t=[];for(var n in l){var o=l[n];if(o.length){for(var a=[],c=0;c<o.length;c++){var d=o[c],p=r[n][d]+"";if(u[n]&&(p=u[n][d-1]),"year"==n&&p.indexOf("-")>-1)for(var h=p.split("-").reverse(),f=parseInt(h[0]),g=parseInt(h[1]),v=f;v<=g;v++)a.push(v);else a.push(encodeURIComponent(p))}t.push(n+"="+a.join(","))}}e+=t.join("&"),i.close(),s.Interface.load(e)}),$(".filter-reset",n).on("hover:enter",function(){for(var e in p={},l)l[e]=[];o.find("span").removeClass("visible")}),a.on("mouseenter touchstart",function(){t&&(s.Hover.update(),s.Controller.toggle("filter-select"))})},r.Socket=function(){var e,t,i=this,auth_code,n=[];this.connect=function(){clearInterval(t);console.log("Socket","try connect");try{e=new WebSocket("ws:vokino.tv:2095")}catch(e){return void console.log("Socket","not work")}e.addEventListener("open",function(e){console.log("Socket","open"),s.auth,i.send("start",{}),setTimeout(function(){s.Account.synch()},1e3),t=setInterval(function(){i.send("ping",{})},5e3)});e.addEventListener("close",function(e){console.log("Socket","close",e.code),setTimeout(i.connect.bind(i),5e3)});e.addEventListener("error",function(t){console.log("Socket","error",t.message,t.code),e.close()},false);e.addEventListener("message",function(e){var t=JSON.parse(e.data);if(t.method=="devices"){n=t.data}else{s.Splash.reset()}if(t.method=="code"){s.Account.append_code(t.code)}if(t.method=="auth"){s.Account.socket_auth(t.data)}if(t.method=="open"){s.Interface.load(t.data)}if(t.method=="play"){t.data.from=i._activeState();s.Player.play(t.data)}if(t.method=="video"){t.data.from=i._activeState();s.Player.video(t.data,t.data.playlist)}if(t.method=="parse"){h.parseUrl(t.data,function(e){i.send("parse",{result:e})},function(e){i.send("parse",{result:e})})}})};this.update=function(){e.close(),this.connect()};this._activeState=function(){return"player"==s.Controller.active_name?"content":s.Controller.active_name};this.send=function(method,data){data.device_id=h.hashCode(navigator.userAgent);data.useragent=navigator.userAgent;data.name=s.Settings.get("devicename");data.method=method;data.canparse=!!(s.android_app&&androidApp.parseUrl||s.makeparse);data.version=2.1;e.readyState==1&&e.send(JSON.stringify(data))};this._drop=function(e,t){if(n.length){for(var i=0;i<n.length;i++){var o=n[i];o.title=o.name,o.selected=!1,0==i&&(o.selected=!0)}s.Drop.open("Show on device",n,function(t){t.url=s.Interface.last(),e(t)},t)}else $.notify("No devices connected",{className:"white"})};this.play=function(e,t){i._drop(function(n){i.send(e,{uuid:n.uuid,params:t})},"player")};$(".b-head__brodcast").on("hover:enter",function(){i._drop(function(e){i.send("open",e)},"head")})};r.AD=function(){var e,t,i,n=this,o={files:[{img:"https://cdn.advg.agency/static/offer/676/banners/27590/728x90-mr.png",url:"https://r.advg.agency/t/46a89/"}],side:[{img:"http://cdn.vplay.one/ad/side/ff_1.jpg",url:"https://r.advg.agency/t/w7dtr/"},{img:"http://cdn.vplay.one/ad/side/ff_2.jpg",url:"https://r.advg.agency/t/w7dtr/"},{img:"http://cdn.vplay.one/ad/side/wf_1.jpg",url:"https://r.advg.agency/t/zgd7x/"},{img:"http://cdn.vplay.one/ad/side/wf_2.jpg",url:"https://r.advg.agency/t/zgd7x/"},{img:"http://cdn.vplay.one/ad/side/skf_1.jpg",url:"https://r.advg.agency/t/yk36d/"},{img:"http://cdn.vplay.one/ad/side/skf_2.jpg",url:"https://r.advg.agency/t/yk36d/"},{img:"http://cdn.vplay.one/ad/side/la_1.jpg",url:"https://r.advg.agency/t/jxbng/"},{img:"http://cdn.vplay.one/ad/side/la_2.jpg",url:"https://r.advg.agency/t/jxbng/"},{img:"http://cdn.vplay.one/ad/side/aa_1.jpg",url:"https://r.advg.agency/t/9c8be/"},{img:"http://cdn.vplay.one/ad/side/aa_2.jpg",url:"https://r.advg.agency/t/9c8be/"},{img:"http://cdn.vplay.one/ad/side/ar_1.jpg",url:"https://r.advg.agency/t/46a89/"}]},a={files:Math.round(Math.random()*o.files.length),side:Math.round(Math.random()*o.side.length)},r=$("#browser"),l=$(".b-browser__btn"),c=$(".b-browser__url");e=!0,this.enable=function(t){e=t},this.show=function(t,i){var n=this._data(i);if(n&&e&&this._showing()){var o=s.Template.get("ad_"+i,n);o.data("data",n),this._event(o),t.append(o)}},this.prepare=function(){},this._showing=function(){if("undefined"!=typeof process||s.agent.indexOf("windows")>-1||s.agent.indexOf("mac os")>-1)return!0;try{if(window.matchMedia("(display-mode: standalone)").matches)return!0}catch(e){}return!1},this._data=function(e){var t=o[e].length,i=a[e]>=t?0:a[e],n=o[e][i];return a[e]++,n},this._event=function(e){e.on("hover:enter",function(){t=e.data("data"),c.text(t.url),s.Controller.toggle("browser")})},this._exit=function(){h.animOut(r),s.Controller.toggle(s.Controller.prev_name||"content")},this._open=function(){if(n._exit(),"undefined"!=typeof webOS)webOS.service.request("luna://com.webos.applicationManager",{method:"launch",parameters:{id:"com.webos.app.browser",params:{target:t.url}},onSuccess:function(){$.notify("浏览器启动成功",{className:"white"})},onFailure:function(e){$.notify(e.errorText,{className:"error"})}});else if("undefined"!=typeof process){require("nw.gui").Shell.openExternal(t.url)}else if("undefined"!=typeof tizen){var e=new tizen.ApplicationControl("http://tizen.org/appcontrol/operation/view",t.url);tizen.application.launchAppControl(e,null,function(){$.notify("浏览器启动成功",{className:"white"})},function(e){$.notify(e.message,{className:"error"})})}else $("#open-link-native").attr("href",t.url),$("#open-link-native")[0].click()},l.on("hover:enter",function(){n._open()}),r.on("click",function(e){$(e.target).closest(".b-browser__btn").length||n._exit()}),s.Controller.add("browser",{toggle:function(){var e=r.find(".selector").toArray();s.SpatialNavigator.setCollection(e),s.SpatialNavigator.focus(e[0]),h.animIn(r),i=Date.now(),s.History.fake("browser")},back:function(){n._exit()},finish:function(){Date.now()-i>1e3&&n._open()}})},s.create.forEach(function(e){Object.assign(r[e].prototype,u.prototype),s[e]=new r[e]});var v=new function(e){this.state=e.init,this.setState=function(t){for(var i,n,o=0;o<e.transitions.length;o++){var a=e.transitions[o];if(a.name==t)if(i=a,d.isArray(a.from)){for(var s=0;s<i.from.length;s++)if(this.state==a.from[s]){n=i;break}}else this.state!=i.from&&"*"!=i.from||(n=i)}n&&(e.methods[n.name](),n.to&&(this.state=n.to))}}({init:"ready",transitions:[{name:"idle",from:["ready","idle","menu"],to:"idle"},{name:"menu",from:"idle",to:"menu"},{name:"menu_mouse",from:"idle",to:"menu"},{name:"load_start",from:"*"},{name:"load_end",from:"*"},{name:"load_complite",from:"*",to:"ready"},{name:"load_error",from:"*"}],methods:{idle:function(){s.Background.clear(),s.Menu.close()},menu:function(){s.Menu.open()},load_start:function(){s.Loader.show(),$(".wrap").removeClass("trigger--content-in").addClass("trigger--content-out")},load_end:function(){$(".wrap").removeClass("trigger--content-out").addClass("trigger--content-in")},load_complite:function(){s.Menu.is_open&&v.setState("menu")},load_error:function(){}}});s.Hover.addEventListener("hover:active",function(e){v.setState("idle"),e.elem.hasClass("e-menu__item")&&v.setState("menu"),e.elem.attr("data-image")&&s.Background.load(JSON.parse(decodeURI(e.elem.attr("data-image"))))}),s.SpatialNavigator.addEventListener("focus",function(e){s.Hover.focus($(e.elem))}),s.Reguest.addEventListener("load:go",function(){}),s.Reguest.addEventListener("load:start",function(){v.setState("load_start")}),s.Reguest.addEventListener("load:after_end",function(){v.setState("load_end")}),s.Reguest.addEventListener("load:end",function(){s.Loader.hide()}),s.Reguest.addEventListener("load:before_complite",function(){for(var e in s.timers)clearTimeout(s.timers[e]);for(var e in s.intervals)clearInterval(s.intervals[e]);s.Background.reset(),s.Controller.reset(),s.Interface.remove(),s.Hover.reset(),$("#content").empty()}),s.Reguest.addEventListener("load:after_complite",function(){v.setState("load_complite"),s.Hover.update(),s.Layer.resize()}),s.Reguest.addEventListener("load:after_error",function(){v.setState("load_error"),s.Loader.hide()}),s.Interface.addEventListener("startload",function(e){s.History.push(e.url),f.set("interface_url",e.url)}),s.Interface.addEventListener("load",function(e){clearTimeout(s.Console.timer)}),s.History.addEventListener("back",function(e){s.Controller.back(),e.url&&(s.Reguest.need.fromcache=!0,s.Loader.hide(),s.Interface.load(e.url))}),s.History.addEventListener("push",function(e){s.Reguest.need.fromcache=!1}),s.Layer.addEventListener("resize",function(e){s.Hover.draw(),s.Background.draw(),s.Player.resize(),s.Splash.resize()}),s.Settings.addEventListener("change",function(e){s.Layer.change()});var m,_=0;var Key_Timer,Key_longpress,Key_isInput;if($(".b-head .selector").on("hover:active",function(){m=$(this)}),s.Controller.add("head",{toggle:function(){_=0;var e=$(".b-head .selector").toArray();s.SpatialNavigator.setCollection(e),s.SpatialNavigator.focus((m||e)[0]),s.History.fakeClear()},left:function(){s.SpatialNavigator.canmove("left")?s.SpatialNavigator.move("left"):s.Controller.toggle("menu")},down:function(){s.Controller.toggle("content")},right:function(){s.SpatialNavigator.move("right")},touchDown:function(){s.Controller.toggle("content")},wheelDown:function(){s.Controller.toggle("content")},up:function(){++_>10&&(_=0,$.notify("Canvas disabled",{className:"white"}),s.Background.rotate=function(){},s.Background.set=function(){},s.Background.setStatic=function(){},s.Background.draw=function(){},s.Background.clear=function(){},s.Background.reset=function(){},$("#bg-one,#bg-two").remove())}}),s.Controller.add("donate",{toggle:function(){s.History.fake("donate"),h.animIn($("#donate"))},back:function(){h.animOut($("#donate")),s.Controller.toggle("head")}}),$("#donate-toggle").on("hover:enter",function(){s.Controller.toggle("donate")}),$("#donate-close").on("click",function(){s.History.back()}),s.Controller.add("donate_vokino",{toggle:function(){s.History.fake("donate_vokino"),h.animIn($("#donate_vokino"))},back:function(){h.animOut($("#donate_vokino")),s.Controller.toggle("head")}}),$("#donate_vokino-toggle").on("hover:enter",function(){s.Controller.toggle("donate_vokino")}),$("#donate_vokino-close").on("click",function(){s.History.back()}),$("#webos-plug").on("hover:enter",function(){var e=$(this).data("state");e?s.AVTransport.deleteInput():s.AVTransport.setInput(),$(this).data("state",!e)}),window.addEventListener("keydown",function(e){if(s.Splash.opened()&&"player"!==s.Controller.active_name)return s.Splash.reset();var t;s.Splash.reset();h.fixBodyScroll();window.event?t=e.keyCode:e.which&&(t=e.which);if(s.Reguest.loading||s.Loader.visible||s.show_ad)e.preventDefault();Key_isInput=$("input").is(":focus");s.body.removeClass("mouse");if(!Key_isInput)s.is_touch=false;s.Layer.info("Keypress: "+t+" ["+s.Controller.active_name+"]");if(t==37||t==4)s.Controller.move("left");if(t==38||t==29460)s.Controller.move("up");if(t==39||t==5)s.Controller.move("right");if(t==40||t==29461)s.Controller.move("down");if(t==33||t==427)s.Controller.move("toup");if(t==34||t==428)s.Controller.move("todown");if((t==13||t==29443||t==117||t==65385)&&!Key_isInput){if(!Key_Timer){Key_Timer=setTimeout(function(){Key_longpress=true;s.Controller["long"]()},800)}}if(Key_isInput&&(t==10009||t==461))s.History.back();if((t==8||t==27||t==461||t==10009||t==88)&&!Key_isInput){e.preventDefault();s.History.back()}if(t==32||t==179)s.Controller.trigger("playpause");if(t==415||t==71)s.Controller.trigger("play");if(t==413)s.Controller.trigger("stop");if(t==412||t==69||t==177)s.Controller.trigger("rewindBack");if(t==418||t==417||t==72||t==176)s.Controller.trigger("rewindForward");if(t==19||t==74)s.Controller.trigger("pause");if(t==457)s.Controller.trigger("info");if(t==10146)e.preventDefault();if(t==10133){s.History.fake("settings");s.Controller.toggle("settings")}if(!$(e.target).is("input")){e.preventDefault()}}),window.addEventListener("keyup",function(e){var t=window.event?e.keyCode:e.which;clearTimeout(Key_Timer);Key_Timer=null;if(!Key_longpress){if((t==13||t==29443||t==117||t==65385)&&!Key_isInput){s.Controller.enter()}if((t==13||t==29443||t==63585)&&!s.Keybord.opened){s.Controller.finish()}}else Key_longpress=false}),window.addEventListener("message",function(e){"tizen"==e.data.api&&(console.log("Media","keycode:",e.data.key),"MEDIA_PLAY"==e.data.key&&s.Controller.trigger("play"),"MEDIA_STOP"==e.data.key&&s.Controller.trigger("stop"),"MEDIA_PAUSE"==e.data.key&&s.Controller.trigger("pause"),"MEDIA_NEXT"==e.data.key&&s.Controller.trigger("rewindForward"),"MEDIA_REWIND"==e.data.key&&s.Controller.trigger("rewindBack"))}),window.addEventListener("touchstart",function(e){s.is_touch=true,s.Splash.reset(),s.Player.interfaceToggle("touch"),s.body.removeClass("mouse"),h.fixBodyScroll()}),window.addEventListener("mousemove",function(e){s.Splash.reset(),s.Player.interfaceToggle("mouse"),s.is_touch||s.body.addClass("mouse")}),window.addEventListener("click",function(e){h.fixBodyScroll()}),"undefined"!=typeof tizen)try{var y={onpressed:function(e){window.postMessage({api:"tizen",key:e},"*")}};tizen.mediakey.setMediaKeyEventListener(y)}catch(e){}window.addEventListener("appcontrol",s.Interface.loadTizenRecomend),"undefined"!=typeof process&&(s.makeparse=!0,window.androidApp={callbackData:"",parseUrl:function(e,t,i,n,o){androidApp.callbackData="";var a=require("request"),s={url:t,method:e,headers:{}},r=JSON.parse(i);for(var l in r)s.headers[l]=r[l];"POST"==e&&(s.body=n,s.headers["Content-Type"]="application/x-www-form-urlencoded"),a(s,function(e,t,i){androidApp.callbackData=0==i.length?"error":i})},getResultData:function(){return androidApp.callbackData}}),"undefined"!=typeof webOS?(s.makeparse=!0,window.androidApp={callbackData:"",parseUrl:function(e,t,i,n,o){androidApp.callbackData="",console.log("Parse","start");webOS.service.request("luna://vokinotv.player",{method:"parse",parameters:{url:t,method:e,headers:i,post:n,need_download:o},onSuccess:function(e){console.log("Parse","response:",(e.responce||"").length),androidApp.callbackData=e.responce||""},onFailure:function(e){console.log("Parse","fail:",e)}})},getResultData:function(){return androidApp.callbackData}},$(".fullscreen-toggle").remove()):$("#webos-plug").remove(),window.history.pushState({url:"",started:!0},"",""),s.is_old=h.detectIsOldBrowser(),window.Player=s.Player,s.Reguest._cache({}),s.Layer.change(),s.Hover.reset(),s.Account.initial(),s.Controller.toggle("menu");var w=f.get("interface_url")||s.main_url;if(window.location.search&&window.location.search.indexOf("android")>-1){var b=new URLSearchParams(window.location.search).get("start_url");b&&(w=b)}"undefined"!=typeof STARTURL?STARTURL&&(w=STARTURL):s.Interface.loadTizenRecomend()&&(w=!1),w&&s.Interface.load(w),s.Console.add("Start load url: "+w),s.Menu.load(),s.Settings.serverCheckConnect(),s.auth&&s.Settings.getServerSettings(),s.Socket.connect();try{s.Platform.init()}catch(e){s.Console.add(e)}window.VoKino=s;var C=$("#welcome").addClass("view");setTimeout(function(){C.addClass("anim-fadeOut"),setTimeout(function(){C.hide();try{showAd()}catch(e){}},300)},2e3),new function(){var e=function(){var e=new Date,t=e.getTime();ofst=parseInt(s.Settings.get("time"));var i=["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],n=["一月","二月","三月","四月","Май","六月","七月","八月","九月","十月","十一月","十二月"];(t=[(e=new Date(t+1e3*ofst*60*60)).getHours(),e.getMinutes(),e.getSeconds()])[0]<10&&(t[0]="0"+t[0]),t[1]<10&&(t[1]="0"+t[1]),t[2]<10&&(t[2]="0"+t[2]);var o=[t[0],t[1]].join(":"),a=e.getDay(),r=e.getDate();$(".time-clock").text(o),$(".time-week").text(i[a]+"."),$(".time-day").text(r),$(".time-moth").text(n[e.getMonth()]),$(".time-full").text(i[a]+", "+r+" "+n[e.getMonth()].substr(0,3)+".")};setInterval(e,2e3),e()}($(".clock"),$(".day")),s.is_old&&($("body").addClass("is_old"),s.Console.add("Is old browser"));var S=0;$(".b-head__logo").click(function(){++S>10&&(S=0,s.Console.runDebug(),s.Search.enableSpeechSearch())}),$(".fullscreen-toggle").on("hover:enter click",function(){s.Player.toggleFullscreen()}),setTimeout(function(){window.___browserSync___&&window.___browserSync___.socket.disconnect()},2e3),s.device="none","undefined"!=typeof process&&(s.device="pc"),s.agent.indexOf("iphone")>-1&&(s.device="iphone"),("undefined"!=typeof webOS||s.agent.indexOf("webos")>-1||s.agent.indexOf("web0s")>-1)&&(s.device="webos"),("undefined"!=typeof tizen||s.agent.indexOf("tizen")>-1)&&(s.device="tizen"),("undefined"!=typeof androidApp&&"undefined"==typeof process||s.agent.indexOf("android")>-1||s.agent.indexOf("staros")>-1)&&(s.device="android");var k=0;$(".b-head__day").on("click",function(){++k>5&&window.location.reload()});if(s.android_app){if("undefined"!=androidApp.version()&&androidApp.version()>7){s.Reguest.silent(s.domain_url+"/android_update",function(result){if(androidApp.version()<result.v_code){setTimeout(function(){s.Drop.open("更新可用! 版本 "+result.version,[{title:"下载",download:true},{title:"跳过",download:false}],function(action){if(action.download)androidApp.startUpdateFrom("http://vokino.tv"+result.path)},"content")},5e3)}})}}if(s.auth){s.Account.check_auth()}try{s.AVTransport=new function(){var e="content",t={};this.play=function(i,n){if("undefined"!=typeof webOS){webOS.service.request("luna://com.webos.service.tv.systemproperty",{method:"getSystemInfo",parameters:{keys:["modelName","firmwareVersion","UHD","sdkVersion"]},onSuccess:function(inResponse){var webos_version=inResponse.sdkVersion.split(".")[0];var webos_player_type="";if(webos_version>5){webos_player_type="com.webos.app.mediadiscovery"}else if(webos_version<=5&&webos_version>=3){webos_player_type="com.webos.app.photovideo"}else{webos_player_type="com.webos.app.smartshare"}webOS.service.request("luna://com.webos.applicationManager",{method:"launch",parameters:{id:webos_player_type,params:{payload:[{fullPath:i.url,artist:"",subtitle:"",dlnaInfo:{flagVal:4096,cleartextSize:"-1",contentLength:"-1",opVal:1,protocolInfo:"http-get:*:video/x-matroska:DLNA.ORG_OP=01;DLNA.ORG_CI=0;DLNA.ORG_FLAGS=01700000000000000000000000000000",duration:0},mediaType:"VIDEO",thumbnail:"",deviceType:"DMR",album:"",fileName:i.name,lastPlayPosition:-1}]}},onSuccess:function(inResponse){console.log("The app is launched")},onFailure:function(inError){console.log("Failed to launch the app");console.log("["+inError.errorCode+"]: "+inError.errorText);return}})},onFailure:function(inError){console.log("Failed to launch the app (checkVersion)");console.log("["+inError.errorCode+"]: "+inError.errorText);return}})}},this.setInput=function(){webOS.service.request("luna://com.webos.service.eim",{method:"addDevice",parameters:{appId:"vokinotv",pigImage:"",type:"MVPD_IP",showPopup:!0,label:"VoKino",description:""},onSuccess:function(e){$.notify("VoKino 成功设置登录",{className:"white"})},onFailure:function(e){$.notify(e.errorText,{className:"error"})}})},this.deleteInput=function(){webOS.service.request("luna://com.webos.service.eim",{method:"deleteDevice",parameters:{appId:"vokinotv",showPopup:!0},onSuccess:function(e){$.notify("VoKino 成功退出登录",{className:"white"})},onFailure:function(e){$.notify(e.errorText,{className:"error"})}})}}}catch(e){s.AVTransport={server:!0,prepare:function(){},play:function(){},get:function(){},playOnDevice:function(){}}}if(s.Console.add("Referer: "+document.referrer),s.Console.add("Location: "+window.location.href),!s.is_android)try{var x=new Gamepad;x.register("FACE_1",function(){s.Controller.enter()}),x.register("FACE_2",function(){s.History.back()}),x.register("PAD_LEFT",function(){s.Controller.move("left")}),x.register("PAD_RIGHT",function(){s.Controller.move("right")}),x.register("PAD_UP",function(){s.Controller.move("up")}),x.register("PAD_DOWN",function(){s.Controller.move("down")})}catch(e){}});